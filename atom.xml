<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hexo</title>
  
  
  <link href="https://blog.jiascu.top/atom.xml" rel="self"/>
  
  <link href="https://blog.jiascu.top/"/>
  <updated>2022-03-04T07:03:25.026Z</updated>
  <id>https://blog.jiascu.top/</id>
  
  <author>
    <name>jia</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å¤šçº¿ç¨‹</title>
    <link href="https://blog.jiascu.top/2022/03/04/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    <id>https://blog.jiascu.top/2022/03/04/%E5%A4%9A%E7%BA%BF%E7%A8%8B/</id>
    <published>2022-03-04T07:02:48.860Z</published>
    <updated>2022-03-04T07:03:25.026Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h1><p>ç¬”è®°ï¼š</p><p><a href="https://www.cnblogs.com/pinghuimolu/p/15113413.html">ç‹‚ç¥è¯´Javaå¤šçº¿ç¨‹è¯¦è§£ - NotYourferry - åšå®¢å›­ (cnblogs.com)</a></p><p><a href="https://blog.csdn.net/weixin_44517301/article/details/121714319%EF%BC%88%E8%A1%A5%E5%85%85%EF%BC%89">https://blog.csdn.net/weixin_44517301/article/details/121714319ï¼ˆè¡¥å……ï¼‰</a></p><h2 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h2><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220218093513201.png" alt="image-20220218093513201"></p><h2 id="çº¿ç¨‹åˆ›å»º"><a href="#çº¿ç¨‹åˆ›å»º" class="headerlink" title="çº¿ç¨‹åˆ›å»º"></a>çº¿ç¨‹åˆ›å»º</h2><blockquote><p>ä¸‰ç§åˆ›å»ºæ–¹å¼</p></blockquote><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220218093542521.png" alt="image-20220218093542521"></p><h3 id="Thread"><a href="#Thread" class="headerlink" title="Thread"></a>Thread</h3><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220218113110958.png" alt="image-20220218113110958"></p><p>ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestThread1</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//runæ–¹æ³•çº¿ç¨‹æ–¹æ³•ä½“</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æˆ‘åœ¨çœ‹ä»£ç ----&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯¹è±¡</span></span><br><span class="line">        <span class="type">TestThread1</span> <span class="variable">testThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestThread1</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//startå¼€å¯çº¿ç¨‹</span></span><br><span class="line">        testThread.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¸»çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">200</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æˆ‘åœ¨å­¦ä¹ å¤šçº¿ç¨‹-----&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°Runnableï¼ˆæ¨èä½¿ç”¨ï¼ï¼ï¼ï¼‰"><a href="#å®ç°Runnableï¼ˆæ¨èä½¿ç”¨ï¼ï¼ï¼ï¼‰" class="headerlink" title="å®ç°Runnableï¼ˆæ¨èä½¿ç”¨ï¼ï¼ï¼ï¼‰"></a>å®ç°Runnableï¼ˆæ¨èä½¿ç”¨ï¼ï¼ï¼ï¼‰</h3><p>å®ç°åŸç†ï¼šé™æ€ä»£ç†</p><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220218113137489.png" alt="image-20220218113137489"></p><p>ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestRunable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//runæ–¹æ³•çº¿ç¨‹æ–¹æ³•ä½“</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æˆ‘åœ¨çœ‹ä»£ç ----&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯¹è±¡</span></span><br><span class="line">        <span class="type">TestRunable</span> <span class="variable">testRunable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestRunable</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(testRunable).start();</span><br><span class="line">        <span class="comment">//name1:çº¿ç¨‹åå­—</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(testRunable,<span class="string">&quot;name1&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¸»çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">200</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æˆ‘åœ¨å­¦ä¹ å¤šçº¿ç¨‹-----&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸¤ç§æ–¹æ³•çš„æ¯”è¾ƒ</p></blockquote><p>ç»§æ‰¿ Thread ç±»</p><ul><li>å­ç±»ç»§æ‰¿ Thread ç±»å…·å¤‡å¤šçº¿ç¨‹èƒ½åŠ›</li><li>å¯åŠ¨çº¿ç¨‹ï¼šå­ç±»å¯¹è±¡ .start()</li><li>ä¸å»ºè®®ä½¿ç”¨ï¼šé¿å… OOP å•ç»§æ‰¿å±€é™æ€§</li><li>å®ç° Runnable æ¥å£</li></ul><p>å®ç°æ¥å£ Runnable</p><ul><li>å…·æœ‰å¤šçº¿ç¨‹èƒ½åŠ›</li><li>å¯åŠ¨çº¿ç¨‹ï¼šä¼ å…¥ç›®æ ‡å¯¹è±¡ + Threadå¯¹è±¡.start()</li><li>æ¨èä½¿ç”¨ï¼šé¿å…å•ç»§æ‰¿å±€é™æ€§ï¼Œæ–¹ä¾¿åŒä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹ä½¿ç”¨ã€‚</li></ul><h3 id="å®ç°Callableæ¥å£ï¼ˆäº†è§£å³å¯ï¼‰"><a href="#å®ç°Callableæ¥å£ï¼ˆäº†è§£å³å¯ï¼‰" class="headerlink" title="å®ç°Callableæ¥å£ï¼ˆäº†è§£å³å¯ï¼‰"></a>å®ç°Callableæ¥å£ï¼ˆäº†è§£å³å¯ï¼‰</h3><p>å®ç°Callableæ¥å£ï¼Œé‡å†™callæ–¹æ³•ã€‚</p><ol><li>å®ç° Callable æ¥å£ï¼Œéœ€è¦è¿”å›å€¼ç±»å‹</li><li>é‡å†™ call æ–¹æ³•ï¼Œéœ€è¦æŠ›å‡ºå¼‚å¸¸</li><li>åˆ›å»ºç›®æ ‡å¯¹è±¡</li><li>åˆ›å»ºæ‰§è¡ŒæœåŠ¡ï¼šExecutorService &#x3D; Executor.newFixedThreadPool(1);</li><li>æäº¤æ‰§è¡Œï¼šFuture result1 &#x3D; ser.submit(1);</li><li>è·å–ç»“æœï¼šboolean r1 &#x3D; result.get()</li><li>å…³é—­æœåŠ¡ï¼šser.shutdownNow()</li></ol><p>ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestCallable</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;Boolean&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String url;  <span class="comment">//ç½‘ç»œå›¾ç‰‡åœ°å€</span></span><br><span class="line">    <span class="keyword">private</span> String name;  <span class="comment">// ä¿å­˜çš„æ–‡ä»¶å</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TestCallable</span><span class="params">(String url, String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.url = url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸‹è½½å›¾ç‰‡çº¿ç¨‹çš„æ‰§è¡Œä½“</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">call</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">WebDownloader</span> <span class="variable">webDownloader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebDownloader</span>();</span><br><span class="line">        webDownloader.downloader(url, name);</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸‹è½½äº†æ–‡ä»¶åä¸ºï¼š&quot;</span> + name);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="type">TestCallable</span> <span class="variable">testThread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestCallable</span>(<span class="string">&quot;https://img-blog.csdnimg.cn/20210531145950543.png&quot;</span>, <span class="string">&quot;2.png&quot;</span>);</span><br><span class="line">        <span class="type">TestCallable</span> <span class="variable">testThread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestCallable</span>(<span class="string">&quot;https://img-blog.csdnimg.cn/20210531145950543.png&quot;</span>, <span class="string">&quot;3.png&quot;</span>);</span><br><span class="line">        <span class="type">TestCallable</span> <span class="variable">testThread3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestCallable</span>(<span class="string">&quot;https://img-blog.csdnimg.cn/20210531145950543.png&quot;</span>, <span class="string">&quot;4.png&quot;</span>);</span><br><span class="line">        <span class="type">TestCallable</span> <span class="variable">testThread4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestCallable</span>(<span class="string">&quot;https://img-blog.csdnimg.cn/20210531145950543.png&quot;</span>, <span class="string">&quot;5.png&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//åˆ›å»ºæ‰§è¡ŒæœåŠ¡:</span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">service</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">4</span>);</span><br><span class="line">        <span class="comment">//æäº¤æ‰§è¡Œ:</span></span><br><span class="line">        Future&lt;Boolean&gt; r1 = service.submit(testThread1);</span><br><span class="line">        Future&lt;Boolean&gt; r2 = service.submit(testThread2);</span><br><span class="line">        Future&lt;Boolean&gt; r3 = service.submit(testThread3);</span><br><span class="line">        Future&lt;Boolean&gt; r4 = service.submit(testThread4);</span><br><span class="line">        <span class="comment">// è·å–ç»“æœ:</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">rs1</span> <span class="operator">=</span> r1.get();</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">rs2</span> <span class="operator">=</span> r2.get();</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">rs3</span> <span class="operator">=</span> r3.get();</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">rs4</span> <span class="operator">=</span> r4.get();</span><br><span class="line">        <span class="comment">//å…³é—­æœåŠ¡:</span></span><br><span class="line">        service.shutdownNow();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">WebDownloader</span> &#123;</span><br><span class="line">        <span class="comment">//ä¸‹è½½æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">downloader</span><span class="params">(String url, String name)</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                FileUtils.copyURLToFile(<span class="keyword">new</span> <span class="title class_">URL</span>(url), <span class="keyword">new</span> <span class="title class_">File</span>(name));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                System.out.println(<span class="string">&quot;IOå¼‚å¸¸ï¼Œdownleræ–¹æ³•å‡ºç°é—®é¢˜&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Lambdaè¡¨è¾¾å¼"><a href="#Lambdaè¡¨è¾¾å¼" class="headerlink" title="Lambdaè¡¨è¾¾å¼"></a>Lambdaè¡¨è¾¾å¼</h3><p><strong>Lambda è¡¨è¾¾å¼å±äºå‡½æ•°å¼ç¼–ç¨‹çš„æ¦‚å¿µ</strong></p><ul><li>Î» å¸Œè…Šå­—æ¯è¡¨ä¸­æ’åºç¬¬åä¸€ä½çš„å­—æ¯ï¼Œè‹±è¯­åç§°ä¸º Lambda</li><li>é¿å…åŒ¿åå†…éƒ¨ç±»å®šä¹‰è¿‡å¤š</li><li>å…¶å®è´¨å±äºå‡½æ•°å¼ç¼–ç¨‹çš„æ¦‚å¿µ</li><li>å»æ‰äº†ä¸€å †æ²¡æœ‰æ„ä¹‰çš„ä»£ç ,åªç•™ä¸‹æ ¸å¿ƒé€»è¾‘</li></ul><p><strong>å‡½æ•°å¼æ¥å£çš„å®šä¹‰</strong></p><p>â€ƒâ€ƒ1. ä»»ä½•æ¥å£ï¼Œå¦‚æœåªåŒ…å«å”¯ä¸€ä¸€ä¸ª<strong>æŠ½è±¡æ–¹æ³•</strong>ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ã€‚</p>   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€ƒâ€ƒ2. å¯¹äºå‡½æ•°å¼æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡lambda è¡¨è¾¾å¼æ¥åˆ›å»ºè¯¥æ¥å£çš„å¯¹è±¡ã€‚</p><p><strong>ä½¿ç”¨</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¾‹1</span></span><br><span class="line"><span class="comment">//1.å®šä¹‰ä¸€ä¸ªå‡½æ•°å¼æ¥å£</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ILike1</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">lambda1</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2.ç”¨lambdaç®€åŒ–ï¼Œ--&gt;å‡½æ•°å¼æ¥å£</span></span><br><span class="line"><span class="type">ILike1</span> <span class="variable">like1</span> <span class="operator">=</span> ()-&gt;&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;i like lambda1&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line">like1.lambda1();</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¾‹2</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ILike2</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">lambda2</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2.ç”¨lambdaç®€åŒ–ï¼Œ--&gt;å‡½æ•°å¼æ¥å£</span></span><br><span class="line"><span class="type">ILike2</span> <span class="variable">like2</span> <span class="operator">=</span> (a,b)-&gt;&#123;</span><br><span class="line">     System.out.println(<span class="string">&quot;i like lambda&quot;</span> + a + b);</span><br><span class="line">&#125;;</span><br><span class="line">like2.lambda2(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¾‹3 æ¨¡æ‹ŸRunnableä½¿ç”¨</span></span><br><span class="line"><span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;////&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">thread.start();</span><br></pre></td></tr></table></figure><p><strong>Lambdaè¡¨è¾¾å¼ç®€åŒ–(ç”±æ¥)ï¼š</strong></p><ul><li><p>æ¥å£å®ç°ç±» </p></li><li><p>é™æ€å†…éƒ¨ç±»</p></li><li><p>å±€éƒ¨å†…éƒ¨ç±»</p></li><li><p>åŒ¿åå†…éƒ¨ç±»,æ²¡æœ‰ç±»çš„åç§°,å¿…é¡»å€ŸåŠ©æ¥å£æˆ–è€…çˆ¶ç±»</p></li><li><p>lambdaç®€åŒ–</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLambda</span> &#123;</span><br><span class="line">    <span class="comment">//3.é™æ€å†…éƒ¨ç±»</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Like2</span> <span class="keyword">implements</span> <span class="title class_">ILike</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lambda</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;I like Lambda2!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ILike</span> <span class="variable">like</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Like</span>();</span><br><span class="line">        like.lambda();</span><br><span class="line"></span><br><span class="line">        <span class="type">Like2</span> <span class="variable">like1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Like2</span>();</span><br><span class="line">        like1.lambda();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.å±€éƒ¨å†…éƒ¨ç±»</span></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">Like3</span> <span class="keyword">implements</span> <span class="title class_">ILike</span> &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lambda</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;I like Lambda3!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Like3</span> <span class="variable">like3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Like3</span>();</span><br><span class="line">        like3.lambda();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.åŒ¿åå†…éƒ¨ç±»,æ²¡æœ‰ç±»çš„åç§°,å¿…é¡»å€ŸåŠ©æ¥å£æˆ–è€…çˆ¶ç±»</span></span><br><span class="line">        like = <span class="keyword">new</span> <span class="title class_">ILike</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lambda</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;I like Lambda4!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        like.lambda();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//lambdaç®€åŒ–</span></span><br><span class="line">        like = () -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;I like Lambda5!&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        like.lambda();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªå‡½æ•°å¼æ¥å£</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ILike</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">lambda</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Like</span> <span class="keyword">implements</span> <span class="title class_">ILike</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lambda</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;I like Lambda!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="çº¿ç¨‹çŠ¶æ€"><a href="#çº¿ç¨‹çŠ¶æ€" class="headerlink" title="çº¿ç¨‹çŠ¶æ€"></a>çº¿ç¨‹çŠ¶æ€</h2><p><strong>äº”å¤§çŠ¶æ€ï¼š</strong></p><ul><li>åˆ›å»ºçŠ¶æ€</li><li>å°±ç»ªçŠ¶æ€</li><li>é˜»å¡çŠ¶æ€</li><li>è¿è¡ŒçŠ¶æ€</li><li>æ­»äº¡çŠ¶æ€</li></ul><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220223113814022.png" alt="image-20220223113814022"></p><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220223113822643.png" alt="image-20220223113822643"></p><h3 id="çº¿ç¨‹çš„ä¸€äº›å¸¸ç”¨æ–¹æ³•"><a href="#çº¿ç¨‹çš„ä¸€äº›å¸¸ç”¨æ–¹æ³•" class="headerlink" title="çº¿ç¨‹çš„ä¸€äº›å¸¸ç”¨æ–¹æ³•"></a>çº¿ç¨‹çš„ä¸€äº›å¸¸ç”¨æ–¹æ³•</h3><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220223113856789.png" alt="image-20220223113856789"></p><h3 id="åœæ­¢çº¿ç¨‹çš„æ–¹å¼"><a href="#åœæ­¢çº¿ç¨‹çš„æ–¹å¼" class="headerlink" title="åœæ­¢çº¿ç¨‹çš„æ–¹å¼"></a>åœæ­¢çº¿ç¨‹çš„æ–¹å¼</h3><ul><li>ä¸æ¨èä½¿ç”¨ JDK æä¾›çš„ stop ()ã€destroy()æ–¹æ³•ã€‚ã€å·²å¼ƒç”¨ã€‘</li><li>æ¨èçº¿ç¨‹è‡ªå·±åœæ­¢ä¸‹æ¥</li><li>å»ºè®®ä½¿ç”¨ä¸€ä¸ªæ ‡å¿—ä½è¿›è¡Œç»ˆæ­¢å˜é‡ ï¼Œ å½“ flag &#x3D;&#x3D; falseï¼Œåˆ™ç»ˆæ­¢çº¿ç¨‹è¿è¡Œ</li></ul><p><strong>æ–¹æ³•ï¼š</strong></p><ol><li>å»ºè®®çº¿ç¨‹æ­£å¸¸åœæ­¢â€”-ã€‹åˆ©ç”¨æ¬¡æ•°ã€‚ä¸å»ºè®®æ­»å¾ªç¯</li><li>å»ºè®®ä½¿ç”¨æ ‡å¿—ä½â€”-ã€‹è®¾ç½®ä¸€ä¸ªæ ‡å¿—ä½</li><li>ä¸è¦ä½¿ç”¨stopæˆ–destory ç­‰è¿‡æ—¶æˆ–è€…JDK ä¸å»ºè®®ä½¿ç”¨çš„æ–¹æ³•</li></ol><p><strong>æ¡ˆä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestStop</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.è®¾ç½®ä¸€ä¸ªæ ‡å¿—ä½</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (flag) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;run...Thread-&gt;&quot;</span> + i++);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.è®¾ç½®ä¸€ä¸ªå…¬å¼€çš„æ–¹æ³•åœæ­¢çº¿ç¨‹ï¼Œè½¬æ¢æ ‡å¿—ä½</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.flag = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">TestStop</span> <span class="variable">testStop</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestStop</span>();</span><br><span class="line">        <span class="comment">//å¼€å¯çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(testStop).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;main&quot;</span> + i);</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">900</span>) &#123;</span><br><span class="line">                <span class="comment">//è°ƒç”¨stopæ–¹æ³•åˆ‡æ¢æ ‡å¿—ä½ï¼Œè®©çº¿ç¨‹åœæ­¢</span></span><br><span class="line">                testStop.stop();</span><br><span class="line">                System.out.println(<span class="string">&quot;è¯¥çº¿ç¨‹åœæ­¢äº†&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="çº¿ç¨‹ä¼‘çœ â€”â€”sleep"><a href="#çº¿ç¨‹ä¼‘çœ â€”â€”sleep" class="headerlink" title="çº¿ç¨‹ä¼‘çœ â€”â€”sleep()"></a>çº¿ç¨‹ä¼‘çœ â€”â€”sleep()</h3><ul><li>sleepï¼ˆæ—¶é—´ï¼‰æŒ‡å®šå½“å‰çº¿ç¨‹é˜»å¡çš„æ¯«ç§’æ•°</li><li>sleep å­˜åœ¨å¼‚å¸¸ InterruptedException</li><li>sleep æ—¶é—´è¾¾åˆ°åçº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€</li><li>sleep å¯ä»¥æ¨¡æ‹Ÿç½‘ç»œå»¶æ—¶ï¼Œå€’è®¡æ—¶ç­‰ ï¼ˆæ•…æ„è®¾ç½®å»¶æ—¶æ”¶ä¼˜åŒ–é’±ğŸ’´ï¼Œä¸é“å¾·ï¼Œæ¯”å¦‚æŸç›˜ï¼‰</li><li>sleep æ¯ä¸€ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªé”ï¼Œsleep ä¸ä¼šé‡Šæ”¾é”</li></ul><p><strong>æ¡ˆä¾‹1ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¯ä¸€ç§’è·å–å½“å‰æ—¶é—´</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestSleep2</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//è·å–ç³»ç»Ÿå½“å‰æ—¶é—´</span></span><br><span class="line">        <span class="type">Date</span> <span class="variable">startTime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis());</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                <span class="comment">//æ›´æ–°ç³»ç»Ÿæ—¶é—´</span></span><br><span class="line">                System.out.println(<span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;HH:mm:ss&quot;</span>).format(startTime));</span><br><span class="line">                startTime = <span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ¡ˆä¾‹2</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ¨¡æ‹Ÿå»¶æ—¶:æ”¾å¤§é—®é¢˜çš„å‘ç”Ÿæ€§</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestSleep</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="comment">//ç¥¨æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">ticketNums</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ticketNums &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//æ¨¡æ‹Ÿå»¶æ—¶</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">200</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;--&gt;æ‹¿åˆ°äº†ç¬¬&quot;</span> + ticketNums-- + <span class="string">&quot;ç¥¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">TestSleep</span> <span class="variable">ticket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestSleep</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(ticket, <span class="string">&quot;å°æ˜&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(ticket, <span class="string">&quot;è€å¸ˆ&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(ticket, <span class="string">&quot;é»„ç‰›&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="çº¿ç¨‹ç¤¼è®©â€”â€”yield"><a href="#çº¿ç¨‹ç¤¼è®©â€”â€”yield" class="headerlink" title="çº¿ç¨‹ç¤¼è®©â€”â€”yield()"></a>çº¿ç¨‹ç¤¼è®©â€”â€”yield()</h3><ul><li>ç¤¼è®©çº¿ç¨‹ï¼Œè®©å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æš‚åœï¼Œä½†ä¸é˜»å¡</li><li>å°†çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€è½¬ä¸ºå°±ç»ªçŠ¶æ€</li><li><strong>è®© CPU ä»æ–°è°ƒåº¦ï¼Œæœ‰å¯èƒ½è¿˜æ˜¯è°ƒåº¦è¯¥ç¤¼è®©çº¿ç¨‹ï¼Œç¤¼è®©ä¸ä¸€å®šæˆåŠŸ</strong></li></ul><p><strong>æ¡ˆä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//çº¿ç¨‹ç¤¼è®©ä¸ä¸€å®šæˆåŠŸï¼Œçœ‹cpuå¿ƒæƒ…</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestYield</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">MyYield</span> <span class="variable">myYield</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyYield</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(myYield, <span class="string">&quot;a&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(myYield, <span class="string">&quot;b&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyYield</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹å¼€å§‹è¿è¡Œï¼&quot;</span>);</span><br><span class="line">        Thread.yield();<span class="comment">//ç¤¼è®©</span></span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹ç»“æŸè¿è¡Œï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆå¹¶çº¿ç¨‹â€”â€”Join"><a href="#åˆå¹¶çº¿ç¨‹â€”â€”Join" class="headerlink" title="åˆå¹¶çº¿ç¨‹â€”â€”Join()"></a>åˆå¹¶çº¿ç¨‹â€”â€”Join()</h3><p>Join åˆå¹¶çº¿ç¨‹ï¼Œå¾…æ­¤çº¿ç¨‹æ‰§è¡Œå®Œæˆåï¼Œå†æ‰§è¡Œå…¶ä»–çº¿ç¨‹ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡ã€‚</p><p>å¯ä»¥æƒ³è±¡æˆæ’é˜Ÿã€‚</p><p><strong>æ¡ˆä¾‹ï¼š</strong>å¤šæ ¸è¾¾ä¸åˆ°é¢„æœŸæ•ˆæœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æµ‹è¯•joinæ–¹æ³•ï¼Œæƒ³è±¡ä¸ºæ’é˜Ÿ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestJoin</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;vipçº¿ç¨‹æ¥äº†&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">//çº¿ç¨‹å¯åŠ¨</span></span><br><span class="line">        <span class="type">TestJoin</span> <span class="variable">testJoin</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestJoin</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(testJoin);</span><br><span class="line">        thread.start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¸»çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">500</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">200</span>) &#123;</span><br><span class="line">                thread.join();<span class="comment">//æ’é˜Ÿ</span></span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;mainçº¿ç¨‹&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="çº¿ç¨‹çŠ¶æ€è§‚æµ‹"><a href="#çº¿ç¨‹çŠ¶æ€è§‚æµ‹" class="headerlink" title="çº¿ç¨‹çŠ¶æ€è§‚æµ‹"></a>çº¿ç¨‹çŠ¶æ€è§‚æµ‹</h3><p>Thread.State</p><p><strong>çº¿ç¨‹çŠ¶æ€</strong>ï¼šçº¿ç¨‹å¯ä»¥å¤„äºä»¥ä¸‹çŠ¶æ€ä¹‹ä¸€ï¼š</p><ul><li>NEWï¼šå°šæœªå¯åŠ¨çš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€ã€‚   <strong>åˆ›å»ºçŠ¶æ€</strong></li><li>RUNNABLEï¼šåœ¨ Java è™šæ‹Ÿæœºä¸­æ‰§è¡Œçš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€ã€‚  <strong>è¿è¡ŒçŠ¶æ€</strong></li><li>BLOCKEDï¼šè¢«é˜»å¡ç­‰å¾…ç›‘è§†å™¨é”å®šçš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€ã€‚   <strong>é˜»å¡çŠ¶æ€</strong></li><li>WAITINGï¼šæ­£åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç‰¹å®šåŠ¨ä½œçš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€ã€‚    <strong>å°±ç»ªçŠ¶æ€</strong></li><li>TERMINATEDï¼šå·²é€€å‡ºçš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€ã€‚  <strong>æ­»äº¡çŠ¶æ€</strong></li></ul><p>ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åœ¨ç»™å®šæ—¶é—´ç‚¹å¤„äºä¸€ä¸ªçŠ¶æ€ã€‚ è¿™äº›çŠ¶æ€æ˜¯ä¸åæ˜ ä»»ä½•æ“ä½œç³»ç»Ÿçº¿ç¨‹çŠ¶æ€çš„è™šæ‹ŸæœºçŠ¶æ€ã€‚</p><p>æ­»äº¡ä¹‹åçš„çº¿ç¨‹ä¸èƒ½å†æ¬¡å¯åŠ¨ï¼Œä¸€ä¸ªçº¿ç¨‹åªèƒ½å¯åŠ¨ä¸€æ¬¡</p><p> <strong>æ–¹æ³•</strong>ï¼šthread.getState()</p><p><strong>æ¡ˆä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestState</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(i);</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;////&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//è§‚å¯Ÿçº¿ç¨‹çŠ¶æ€</span></span><br><span class="line">        Thread.<span class="type">State</span> <span class="variable">state</span> <span class="operator">=</span> thread.getState();</span><br><span class="line">        System.out.println(state);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è§‚å¯Ÿå¯åŠ¨å</span></span><br><span class="line">        thread.start();</span><br><span class="line">        state = thread.getState();</span><br><span class="line">        System.out.println(state);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (state != Thread.State.TERMINATED) &#123;</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            state = thread.getState();</span><br><span class="line">            System.out.println(state);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="çº¿ç¨‹ä¼˜å…ˆçº§"><a href="#çº¿ç¨‹ä¼˜å…ˆçº§" class="headerlink" title="çº¿ç¨‹ä¼˜å…ˆçº§"></a>çº¿ç¨‹ä¼˜å…ˆçº§</h3><p>Java æä¾›ä¸€ä¸ªçº¿ç¨‹è°ƒåº¦å™¨æ¥ç›‘æ§ç¨‹åºä¸­å¯åŠ¨åè¿›å…¥å°±ç»ªçŠ¶æ€çš„æ‰€æœ‰çº¿ç¨‹ï¼Œçº¿ç¨‹è°ƒåº¦å™¨æŒ‰ç…§ä¼˜å…ˆçº§å†³å®šåº”è¯¥è°ƒåº¦å“ªä¸ªçº¿ç¨‹æ¥æ‰§è¡Œã€‚</p><p>ä¼˜å…ˆçº§é«˜çš„è·å¾—cpuçš„å‡ ç‡æ›´å¤§äº›ï¼Œä¸æ˜¯ä¼˜å…ˆçº§é«˜çš„å°±å…ˆæ‰§è¡Œå®Œï¼Œçº¿ç¨‹ä¼˜å…ˆçº§éšæœºç‰¹æ€§</p><ul><li>çº¿ç¨‹çš„ä¼˜å…ˆçº§ç”¨æ•°å­—è¡¨ç¤ºï¼ŒèŒƒå›´ä»<strong>1~10</strong><ul><li>Thread.MIN_PRIORITY&#x3D;1</li><li>Thread.MAX_PRIORITY&#x3D;10</li><li>Thread.NORM_PRIORITY&#x3D;5</li></ul></li><li>ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æ”¹å˜æˆ–è·å–ä¼˜å…ˆçº§<ul><li>getPriority().setPriority(int xxx)</li></ul></li></ul><p><strong>ä¼˜å…ˆçº§çš„è®¾å®šå»ºè®®åœ¨ start() è°ƒåº¦å‰</strong></p><p><strong>æ¡ˆä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æµ‹è¯•çº¿ç¨‹çš„ä¼˜å…ˆçº§</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestPriority</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸»çº¿ç¨‹é»˜è®¤ä¼˜å…ˆçº§</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;---&gt;&quot;</span> + Thread.currentThread().getPriority());</span><br><span class="line"></span><br><span class="line">        <span class="type">MyPriority</span> <span class="variable">myPriority</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyPriority</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(myPriority);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(myPriority);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(myPriority);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(myPriority);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(myPriority);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t6</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(myPriority);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//å…ˆè®¾ç½®ä¼˜å…ˆçº§ï¼Œ å†å¯åŠ¨</span></span><br><span class="line">        t1.start();</span><br><span class="line"></span><br><span class="line">        t2.setPriority(<span class="number">1</span>);</span><br><span class="line">        t2.start();</span><br><span class="line"></span><br><span class="line">        t3.setPriority(<span class="number">4</span>);</span><br><span class="line">        t3.start();</span><br><span class="line"></span><br><span class="line">        t4.setPriority(MAX_PRIORITY);<span class="comment">//MAX_PRIORITY=10</span></span><br><span class="line">        t4.start();</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        t5.setPriority(-1);</span></span><br><span class="line"><span class="comment">        t5.start();</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        t6.setPriority(11);</span></span><br><span class="line"><span class="comment">        t6.start();</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPriority</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;---&gt;&quot;</span> + Thread.currentThread().getPriority());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ˆæŠ¤ï¼ˆdaemonï¼‰çº¿ç¨‹"><a href="#å®ˆæŠ¤ï¼ˆdaemonï¼‰çº¿ç¨‹" class="headerlink" title="å®ˆæŠ¤ï¼ˆdaemonï¼‰çº¿ç¨‹"></a>å®ˆæŠ¤ï¼ˆdaemonï¼‰çº¿ç¨‹</h3><ul><li>çº¿ç¨‹åˆ†ä¸º<strong>ç”¨æˆ·çº¿ç¨‹</strong>å’Œ<strong>å®ˆæŠ¤çº¿ç¨‹</strong></li><li>è™šæ‹Ÿæœºå¿…é¡»ç¡®ä¿ç”¨æˆ·çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼šmain</li><li><strong>è™šæ‹Ÿæœºä¸ç”¨ç­‰å¾…å®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</strong>ï¼šgcåƒåœ¾å›æ”¶è¿›ç¨‹</li><li>å¦‚åå°è®°å½•æ“ä½œæ—¥å¿—ï¼Œç›‘æ§å†…å­˜åƒåœ¾å›æ”¶ç­‰å¾…</li></ul><p><strong>æ¡ˆä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æµ‹è¯•å®ˆæŠ¤çº¿ç¨‹</span></span><br><span class="line"><span class="comment">//ä¸Šå¸å®ˆæŠ¤ä½ </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestDaemon</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">God</span> <span class="variable">god</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">God</span>();</span><br><span class="line">        <span class="type">You</span> <span class="variable">you</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">You</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(god);</span><br><span class="line">        thread.setDaemon(<span class="literal">true</span>);<span class="comment">//é»˜è®¤çº¿ç¨‹æ˜¯ç”¨æˆ·çº¿ç¨‹</span></span><br><span class="line">        thread.start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(you).start();<span class="comment">//ä½ å¯åŠ¨</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸Šå¸</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">God</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ä¸Šå¸æ°¸è¿œä¿ä½‘ç€ä½ ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½ </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">You</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">36500</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ä½ å¼€å¿ƒçš„ç”Ÿæ´»æ¯ä¸€å¤©ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;=========goodbye,world!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="çº¿ç¨‹åŒæ­¥"><a href="#çº¿ç¨‹åŒæ­¥" class="headerlink" title="çº¿ç¨‹åŒæ­¥"></a>çº¿ç¨‹åŒæ­¥</h2><ul><li>å¹¶å‘ï¼š<strong>åŒä¸€å¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œ</strong>ï¼ˆæŠ¢ç¥¨ï¼‰</li><li>çº¿ç¨‹åŒæ­¥æ˜¯ä¸€ä¸ªç­‰å¾…æœºåˆ¶ï¼Œå¤šä¸ªéœ€è¦åŒæ—¶è®¿é—®æ¬¡å¯¹è±¡çš„çº¿ç¨‹è¿›å…¥è¿™ä¸ª<strong>å¯¹è±¡çš„ç­‰å¾…æ± </strong>å½¢æˆé˜Ÿåˆ—ï¼Œç­‰å¾…å‰ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨å®Œæ¯•ï¼Œä¸‹ä¸€ä¸ªçº¿ç¨‹æ‰èƒ½ä½¿ç”¨ã€‚</li></ul><p>å½¢æˆæ¡ä»¶ï¼š<strong>é˜Ÿåˆ—+é”</strong></p><ul><li>ç”±äºåŒä¸€è¿›ç¨‹çš„å¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€å—å­˜å‚¨ç©ºé—´ï¼Œåœ¨å¸¦æ¥æ–¹ä¾¿çš„åŒæ—¶ï¼Œä¹Ÿå¸¦æ¥äº†è®¿é—®å†²çªé—®é¢˜ï¼Œä¸ºäº†ä¿è¯æ•°æ®åœ¨æ–¹æ³•ä¸­è¢«è®¿é—®æ—¶çš„æ­£ç¡®æ€§ï¼Œåœ¨è®¿é—®æ—¶åŠ å…¥<strong>é”æœºåˆ¶ synchronized</strong>ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å¾—å¯¹è±¡çš„æ’å®ƒé”ï¼Œç‹¬å èµ„æºï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å¾…ï¼Œä½¿ç”¨åé‡Šæ”¾é”å³å¯.å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š<ul><li>ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ä¼šå¯¼è‡´å…¶ä»–æ‰€æœ‰éœ€è¦æ­¤é”çš„çº¿ç¨‹æŒ‚èµ·ï¼›</li><li>åœ¨å¤šçº¿ç¨‹ç«äº‰ä¸‹ï¼ŒåŠ é”ï¼Œé‡Šæ”¾é”ä¼šå¯¼è‡´æ¯”è¾ƒå¤šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œè°ƒåº¦å»¶æ—¶ï¼Œå¼•èµ·æ€§èƒ½é—®é¢˜ï¼›</li><li>å¦‚æœä¸€ä¸ªä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹ç­‰å¾…ä¸€ä¸ªä¼˜å…ˆçº§ä½çš„çº¿ç¨‹é‡Šæ”¾é”ä¼šå¯¼è‡´ä¼˜å…ˆçº§å€’ç½®ï¼Œå¼•èµ·æ€§èƒ½é—®é¢˜.</li></ul></li></ul><h3 id="çº¿ç¨‹ä¸å®‰å…¨ä¸¾ä¾‹"><a href="#çº¿ç¨‹ä¸å®‰å…¨ä¸¾ä¾‹" class="headerlink" title="çº¿ç¨‹ä¸å®‰å…¨ä¸¾ä¾‹"></a>çº¿ç¨‹ä¸å®‰å…¨ä¸¾ä¾‹</h3><p><strong>1. ä¸å®‰å…¨çš„å”®ç¥¨</strong>(å·²æ ¹æ®4.2æ”¹æˆå®‰å…¨)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//çº¿ç¨‹ä¸å®‰å…¨ï¼Œä¹°ç¥¨é‡å¤</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UnsafeBuyTicket</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">BuyTicket</span> <span class="variable">buyTicket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BuyTicket</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(buyTicket, <span class="string">&quot;æˆ‘&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(buyTicket, <span class="string">&quot;ä½ &quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(buyTicket, <span class="string">&quot;ä»–&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BuyTicket</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="comment">//ç¥¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">ticket</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    <span class="comment">//å¤–éƒ¨åœæ­¢æ ‡å¿—</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//ä¹°ç¥¨</span></span><br><span class="line">        <span class="keyword">while</span> (flag) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                buy();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//synchronized:åŒæ­¥æ–¹æ³•ï¼Œé”çš„æ˜¯this</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">buy</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">if</span> (ticket &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            flag = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ¨¡æ‹Ÿå»¶æ—¶</span></span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;ä¹°åˆ°&quot;</span> + ticket--);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2.ä¸å®‰å…¨å–é’±</strong>(å·²æ ¹æ®4.2æ”¹æˆå®‰å…¨)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å–é’±çº¿ç¨‹ä¸å®‰å…¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UnsafeBank</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//è´¦æˆ·</span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Account</span>(<span class="number">1000</span>, <span class="string">&quot;ç»“å©šåŸºé‡‘&quot;</span>);</span><br><span class="line">        <span class="type">Drawing</span> <span class="variable">you</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Drawing</span>(account, <span class="number">50</span>, <span class="string">&quot;ä½ &quot;</span>);</span><br><span class="line">        <span class="type">Drawing</span> <span class="variable">girlFriend</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Drawing</span>(account, <span class="number">100</span>, <span class="string">&quot;girlFriend&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        you.start();</span><br><span class="line">        girlFriend.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="comment">//è´¦æˆ·åç§°</span></span><br><span class="line">    String name;</span><br><span class="line">    <span class="comment">//è´¦æˆ·ä½™é¢</span></span><br><span class="line">    <span class="type">int</span> money;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Account</span><span class="params">(<span class="type">int</span> money, String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.money = money;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Drawing</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line"></span><br><span class="line">    Account account;<span class="comment">//é“¶è¡Œè´¦æˆ·</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> drawingMoney;<span class="comment">//å–äº†å¤šå°‘é’±</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> nowMoney;<span class="comment">//å‰©ä½™å¤šå°‘é’±</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Drawing</span><span class="params">(Account account, <span class="type">int</span> drawingMoney, String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.account = account;</span><br><span class="line">        <span class="built_in">this</span>.drawingMoney = drawingMoney;</span><br><span class="line">        <span class="built_in">super</span>.setName(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å–é’±</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//synchronizedå—ï¼šé”çš„æ˜¯å˜åŒ–çš„é‡</span></span><br><span class="line">        <span class="keyword">synchronized</span> (account) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (account.money - drawingMoney &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;å¡å†…ä½™é¢ä¸è¶³ï¼Œå–ä¸äº†ï¼&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¡å†…ä½™é¢ = ä½™é¢â€“ä½ å–çš„é’±</span></span><br><span class="line">            account.money = account.money - drawingMoney;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//ä½ æ‰‹é‡Œçš„é’±</span></span><br><span class="line">            nowMoney = nowMoney + drawingMoney;</span><br><span class="line">            System.out.println(account.name + <span class="string">&quot;ä½™é¢ä¸º:&quot;</span> + account.money);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//Thread.currentThread().getName() == this.getName()</span></span><br><span class="line">            System.out.println(<span class="built_in">this</span>.getName() + <span class="string">&quot;æ‰‹é‡Œçš„é’±&quot;</span> + nowMoney);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3.ä¸å®‰å…¨çš„é›†åˆ</strong>(å·²æ ¹æ®4.2æ”¹æˆå®‰å…¨)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//çº¿ç¨‹ä¸å®‰å…¨çš„é›†åˆ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UnsafeList</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (list) &#123;</span><br><span class="line">                    list.add(Thread.currentThread().getName());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(list.size());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŒæ­¥æ–¹æ³•åŠåŒæ­¥å—"><a href="#åŒæ­¥æ–¹æ³•åŠåŒæ­¥å—" class="headerlink" title="åŒæ­¥æ–¹æ³•åŠåŒæ­¥å—"></a>åŒæ­¥æ–¹æ³•åŠåŒæ­¥å—</h3><p>ç”±äºæˆ‘ä»¬å¯ä»¥é€šè¿‡å…³é”®å­— private å…³é”®å­—æ¥ä¿è¯æ•°æ®å¯¹è±¡åªèƒ½è¢«æ–¹æ³•è®¿é—®ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦é’ˆå¯¹æ–¹æ³•æå‡ºä¸€å¥—æœºåˆ¶ï¼Œè¿™å¥—æœºåˆ¶å°±æ˜¯ synchronized å…³é”®å­—ï¼Œ</p><p>å®ƒåŒ…æ‹¬ä¸¤ç§æ–¹æ³•ï¼šsynchronized æ–¹æ³•å’Œ synchronized å—.</p><p><strong>synchronized æ–¹æ³•:</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">(<span class="type">int</span> args)</span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>synchronized æ–¹æ³•æ§åˆ¶ â€œå¯¹è±¡â€ çš„è®¿é—®ï¼Œæ¯ä¸ªå¯¹è±¡å¯¹åº”ä¸€æŠŠé”ï¼Œæ¯ä¸ª synchronized æ–¹æ³•éƒ½å¿…é¡»è·å¾—è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡çš„é”æ‰èƒ½æ‰§è¡Œï¼Œå¦åˆ™çº¿ç¨‹ä¼šé˜»å¡ï¼Œæ–¹æ³•ä¸€æ—¦æ‰§è¡Œï¼Œå°±ç‹¬å è¯¥é”ï¼Œç›´åˆ°è¯¥æ–¹æ³•è¿”å›æ‰é‡Šæ”¾ï¼Œåé¢è¢«é˜»å¡çš„çº¿ç¨‹æ‰èƒ½è·å¾—è¿™ä¸ªé”ï¼Œç»§ç»­æ‰§è¡Œã€‚</p><p>ç¼ºé™·ï¼šè‹¥å°†ä¸€ä¸ªå¤§çš„æ–¹æ³•ç”³æ˜ä¸º synchronized å°†ä¼šå½±å“æ•ˆç‡ã€‚</p><p><strong>synchronized å—:</strong></p><p>åŒæ­¥å—ï¼šsynchronized(Obj){}</p><p>Obj ç§°ä¹‹ä¸ºåŒæ­¥ç›‘è§†å™¨</p><ul><li>Obj å¯ä»¥æ˜¯ä»»ä½•å¯¹è±¡ï¼Œä½†æ˜¯æ¨èä½¿ç”¨<strong>å…±äº«èµ„æº</strong>ä½œä¸ºåŒæ­¥ç›‘è§†å™¨</li><li><strong>åŒæ­¥æ–¹æ³•ä¸­æ— éœ€æŒ‡å®šåŒæ­¥ç›‘è§†å™¨ï¼Œå› ä¸ºåŒæ­¥æ–¹æ³•çš„åŒæ­¥ç›‘è§†å™¨å°±æ˜¯ this ï¼Œå°±æ˜¯è¿™ä¸ªå¯¹è±¡æœ¬èº«ï¼Œæˆ–è€…æ˜¯ class</strong></li><li>åŒæ­¥ç›‘è§†å™¨çš„æ‰§è¡Œè¿‡ç¨‹</li></ul><ol><li>ç¬¬ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œé”å®šåŒæ­¥ç›‘è§†å™¨ï¼Œæ‰§è¡Œå…¶ä¸­çš„ä»£ç </li><li>ç¬¬äºŒä¸ªçº¿ç¨‹è®¿é—®ï¼Œå‘ç°åŒæ­¥ç›‘è§†å™¨è¢«é”å®šï¼Œæ— æ³•è®¿é—®</li><li>ç¬¬ä¸€ä¸ªçº¿ç¨‹è®¿é—®å®Œæ¯•ï¼Œè§£é”åŒæ­¥ç›‘è§†å™¨</li><li>ç¬¬äºŒä¸ªçº¿ç¨‹è®¿é—®ï¼Œå‘ç°åŒæ­¥ç›‘è§†å™¨æ²¡æœ‰é”ï¼Œç„¶åé”å®šå¹¶è®¿é—®</li></ol><p>é”çš„æ˜¯å˜åŒ–çš„é‡</p><p><strong>JUCå®‰å…¨é›†åˆç±»å‹æ‰©å……</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestJUC</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        CopyOnWriteArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;String&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                list.add(Thread.currentThread().getName());</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(list.size());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ­»é”å’ŒLocké”"><a href="#æ­»é”å’ŒLocké”" class="headerlink" title="æ­»é”å’ŒLocké”"></a>æ­»é”å’ŒLocké”</h3><blockquote><p><strong>æ­»é”ï¼š</strong></p></blockquote><p>å¤šä¸ªçº¿ç¨‹å„è‡ªå æœ‰ä¸€äº›å…±äº«èµ„æºï¼Œå¹¶ä¸”äº’ç›¸ç­‰å¾…å…¶ä»–çº¿ç¨‹å æœ‰çš„èµ„æºæ‰èƒ½è¿è¡Œï¼Œè€Œå¯¼è‡´ä¸¤ä¸ªæˆ–è€…å¤šä¸ªçº¿ç¨‹éƒ½åœ¨ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºï¼Œéƒ½åœæ­¢æ‰§è¡Œçš„æƒ…å½¢ã€‚æŸä¸€ä¸ªåŒæ­¥å—åŒæ—¶æ‹¥â€œä¸¤ä¸ªä»¥ä¸Šå¯¹è±¡çš„é”â€æ—¶ï¼Œå°±å¯èƒ½ä¼šå‘ç”Ÿâ€œæ­»é”â€çš„é—®é¢˜ã€‚</p><p>äº§ç”Ÿæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼š</p><ol><li>äº’æ–¥æ¡ä»¶ï¼šä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ã€‚</li><li>è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼šä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚</li><li>ä¸å‰¥å¤ºæ¡ä»¶ï¼šè¿›ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœªä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å¼ºè¡Œå‰¥å¤ºã€‚</li><li>å¾ªç¯ç­‰å¾…æ¡ä»¶ï¼šè‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ã€‚</li></ol><p>ä¸Šè¿°å››ä¸ªæ¡ä»¶ï¼Œåªè¦ç ´åå…¶ä»»æ„ä¸€ä¸ªæˆ–å¤šä¸ªæ¡ä»¶å°±å¯é¿å…æ­»é”çš„å‘ç”Ÿã€‚</p><p><strong>æ¡ˆä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ­»é”:å¤šä¸ªçº¿ç¨‹äº’ç›¸æŠ±ç€å¯¹æ–¹éœ€è¦çš„èµ„æº,ç„¶åå½¢æˆåƒµæŒ</span></span><br><span class="line"><span class="comment"> * è§£å†³:ä¸€ä¸ªé”åªé”ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span>  <span class="keyword">class</span> <span class="title class_">DeadLock</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Makeup</span> <span class="variable">makeup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Makeup</span>(<span class="number">0</span>, <span class="string">&quot;ç°å§‘å¨˜&quot;</span>);</span><br><span class="line">        <span class="type">Makeup</span> <span class="variable">makeup1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Makeup</span>(<span class="number">1</span>, <span class="string">&quot;ç™½é›ªå…¬ä¸»&quot;</span>);</span><br><span class="line">        makeup.start();</span><br><span class="line">        makeup1.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å£çº¢</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Lipstick</span> &#123; &#125;</span><br><span class="line"><span class="comment">//é•œå­</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mirror</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Makeup</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="comment">//éœ€è¦çš„èµ„æºåªæœ‰ä¸€ä»½,ç”¨staticä¿è¯åªæœ‰ä¸€ä»½</span></span><br><span class="line">    <span class="keyword">static</span> <span class="type">Lipstick</span> <span class="variable">lipstick</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Lipstick</span>();</span><br><span class="line">    <span class="keyword">static</span> <span class="type">Mirror</span> <span class="variable">mirror</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Mirror</span>();</span><br><span class="line">    <span class="type">int</span> choice;<span class="comment">//é€‰æ‹©</span></span><br><span class="line">    String girlName;<span class="comment">//ä½¿ç”¨åŒ–å¦†å“çš„äºº</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Makeup</span><span class="params">(<span class="type">int</span> choice, String girlName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.choice = choice;</span><br><span class="line">        <span class="built_in">this</span>.girlName = girlName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//åŒ–å¦†</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            makeup();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">makeup</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">if</span> (choice == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lipstick) &#123;<span class="comment">//è·å¾—å£çº¢çš„é”</span></span><br><span class="line">                System.out.println(<span class="built_in">this</span>.girlName + <span class="string">&quot;è·å¾—å£çº¢çš„é”&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                <span class="keyword">synchronized</span> (mirror) &#123;<span class="comment">//ä¸€ç§’é’Ÿåæƒ³è·å¾—é•œå­</span></span><br><span class="line">                    System.out.println(<span class="built_in">this</span>.girlName + <span class="string">&quot;è·å¾—é•œå­çš„é”&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (mirror) &#123;<span class="comment">//è·å¾—å£çº¢é•œå­</span></span><br><span class="line">                System.out.println(<span class="built_in">this</span>.girlName + <span class="string">&quot;è·å¾—é•œå­çš„é”&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                <span class="keyword">synchronized</span> (lipstick) &#123;<span class="comment">//äºŒç§’é’Ÿåæƒ³è·å¾—çš„é”</span></span><br><span class="line">                    System.out.println(<span class="built_in">this</span>.girlName + <span class="string">&quot;è·å¾—å£çº¢çš„é”&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">// è§£å†³:ä¸€ä¸ªé”åªé”ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">makeup</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">if</span> (choice == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lipstick) &#123;<span class="comment">//è·å¾—å£çº¢çš„é”</span></span><br><span class="line">                System.out.println(<span class="built_in">this</span>.girlName + <span class="string">&quot;è·å¾—å£çº¢çš„é”&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">synchronized</span> (mirror) &#123;<span class="comment">//ä¸€ç§’é’Ÿåæƒ³è·å¾—é•œå­</span></span><br><span class="line">                System.out.println(<span class="built_in">this</span>.girlName + <span class="string">&quot;è·å¾—é•œå­çš„é”&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (mirror) &#123;<span class="comment">//è·å¾—å£çº¢é•œå­</span></span><br><span class="line">                System.out.println(<span class="built_in">this</span>.girlName + <span class="string">&quot;è·å¾—é•œå­çš„é”&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">synchronized</span> (lipstick) &#123;<span class="comment">//äºŒç§’é’Ÿåæƒ³è·å¾—çš„é”</span></span><br><span class="line">                System.out.println(<span class="built_in">this</span>.girlName + <span class="string">&quot;è·å¾—å£çº¢çš„é”&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>Lock(é”):</strong></p></blockquote><p>ä» JDK 5.0 å¼€å§‹ï¼ŒJava æä¾›äº†æ›´å¼ºå¤§çš„çº¿ç¨‹åŒæ­¥æœºåˆ¶â€”â€”é€šè¿‡æ˜¾ç¤ºå®šä¹‰åŒæ­¥é”å¯¹è±¡æ¥å®ç°åŒæ­¥ã€‚åŒæ­¥é”ä½¿ç”¨ Lockå¯¹è±¡å……å½“</p><p>java.util.concurrent.locks.Lock æ¥å£æ˜¯æ§åˆ¶å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºè¿›è¡Œè®¿é—®çš„å·¥å…·ã€‚é”æä¾›äº†å¯¹å…±äº«èµ„æºçš„ç‹¬å è®¿é—®ï¼Œæ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹ Lock å¯¹è±¡åŠ é”ï¼Œçº¿ç¨‹å¼€å§‹è®¿é—®å…±äº«èµ„æºä¹‹å‰åº”å…ˆè·å¾— Lockå¯¹è±¡ã€‚</p><p>ReentrantLock ç±»å®ç°äº† Lock ï¼Œå®ƒæ‹¥æœ‰ä¸ synchronized ç›¸åŒçš„å¹¶å‘æ€§å’Œå†…å­˜è¯­ä¹‰ï¼Œåœ¨å®ç°çº¿ç¨‹å®‰å…¨çš„æ§åˆ¶ä¸­ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ˜¯ ReentrantLock ï¼Œå¯ä»¥æ˜¾ç¤ºåŠ é”é‡Šæ”¾é”ã€‚</p><p><strong>synchronized ä¸ Lock çš„å¯¹æ¯”:</strong></p><ul><li>Lock æ˜¯æ˜¾ç¤ºé”ï¼ˆæ‰‹åŠ¨å¼€å¯å’Œå…³é—­ï¼‰ï¼Œsynchronized æ˜¯éšå¼é”ï¼Œå‡ºäº†ä½œç”¨åŸŸè‡ªåŠ¨é‡Šæ”¾</li><li>Lock åªæœ‰ä»£ç åŠ é”ï¼Œsynchronized æœ‰ä»£ç å—é”å’Œæ–¹æ³•é”</li><li>ä½¿ç”¨ Lock é”ï¼ŒJVM å°†èŠ±è´¹è¾ƒå°‘çš„æ—¶é—´æ¥è°ƒåº¦çº¿ç¨‹ï¼Œæ€§èƒ½æ›´å¥½ã€‚å¹¶å…·æœ‰æ›´å¥½çš„æ‰©å±•æ€§ï¼ˆæä¾›æ›´å¤šçš„å­ç±»ï¼‰</li><li>Lock &gt; åŒæ­¥ä»£ç å—ï¼ˆå·²ç»è¿›å…¥äº†æ–¹æ³•ä½“ï¼Œåˆ†é…äº†ç›¸åº”èµ„æºï¼‰&gt;åŒæ­¥æ–¹æ³•ï¼ˆåœ¨æ–¹æ³•ä½“ä¹‹å¤–ï¼‰</li></ul><p><strong>æ¡ˆä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æµ‹è¯•Locké”</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLock</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">TestLock2</span> <span class="variable">testLock2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestLock2</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(testLock2).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(testLock2).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(testLock2).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestLock2</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">ticketNums</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®šä¹‰locké”:å¯é‡å…¥é”</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                lock.lock();<span class="comment">//åŠ é”</span></span><br><span class="line">                <span class="keyword">if</span> (ticketNums &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    System.out.println(ticketNums--);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();<span class="comment">//è§£é”</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="çº¿ç¨‹é€šä¿¡"><a href="#çº¿ç¨‹é€šä¿¡" class="headerlink" title="çº¿ç¨‹é€šä¿¡"></a>çº¿ç¨‹é€šä¿¡</h2><p>åº”ç”¨åœºæ™¯ï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜</p><ul><li>å‡è®¾ä»“åº“ä¸­åªèƒ½å­˜æ”¾ä¸€ä»¶äº§å“ï¼Œç”Ÿäº§è€…å°†ç”Ÿäº§å‡ºæ¥çš„äº§å“æ”¾å…¥ä»“åº“ï¼Œæ¶ˆè´¹è€…å°†ä»“åº“ä¸­äº§å“å–èµ°æ¶ˆè´¹ã€‚</li><li>å¦‚æœä»“åº“ä¸­æ²¡æœ‰äº§å“ï¼Œåˆ™å°†ç”Ÿäº§è€…å°†äº§å“æ”¾å…¥ä»“åº“ï¼Œå¦åˆ™åœæ­¢ç”Ÿäº§å¹¶ç­‰å¾…ï¼Œç›´åˆ°ä»“åº“ä¸­çš„äº§å“è¢«æ¶ˆè´¹è€…å–èµ°ä¸ºæ­¢ã€‚</li><li>å¦‚æœä»“åº“ä¸­æ”¾æœ‰äº§å“ï¼Œåˆ™æ¶ˆè´¹è€…å¯ä»¥å°†äº§å“å–èµ°æ¶ˆè´¹ï¼Œå¦åˆ™åœæ­¢æ¶ˆè´¹ï¼Œç›´åˆ°ä»“åº“ä¸­å†æ¬¡æ”¾å…¥äº§å“ä¸ºæ­¢ã€‚<br><img src="/%E5%A4%9A%E7%BA%BF%E7%A8%8B.assets/20201118202428989.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li></ul><p><strong>è¿™æ˜¯ä¸€ä¸ªçº¿ç¨‹åŒæ­¥é—®é¢˜ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å…±äº«åŒä¸€ä¸ªèµ„æºï¼Œå¹¶ä¸”ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´ç›¸äº’ä¾èµ–ï¼Œäº’ä¸ºæ¡ä»¶ã€‚</strong></p><ul><li>å¯¹äºç”Ÿäº§è€…ï¼Œæ²¡æœ‰ç”Ÿäº§äº§å“ä¹‹å‰ï¼Œè¦é€šçŸ¥æ¶ˆè´¹è€…ç­‰å¾….è€Œç”Ÿäº§äº†äº§å“ä¹‹åï¼Œåˆéœ€è¦é©¬ä¸Šé€šçŸ¥æ¶ˆè´¹è€…æ¶ˆè´¹</li><li>å¯¹äºæ¶ˆè´¹è€…ï¼Œåœ¨æ¶ˆè´¹ä¹‹åï¼Œè¦é€šçŸ¥ç”Ÿäº§è€…å·²ç»ç»“æŸæ¶ˆè´¹ï¼Œéœ€è¦ç”Ÿäº§æ–°çš„äº§å“ä»¥ä¾›æ¶ˆè´¹.</li><li>åœ¨ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ä¸­ï¼Œä»…æœ‰synchronizedæ˜¯ä¸å¤Ÿçš„</li></ul><p><strong>synchronized ï¼š</strong>å¯é˜»æ­¢å¹¶å‘æ›´æ–°åŒä¸€ä¸ªå…±äº«èµ„æºï¼Œå®ç°äº†åŒæ­¥ï¼Œä¸èƒ½ç”¨æ¥å®ç°ä¸åŒçº¿ç¨‹ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’ï¼ˆé€šä¿¡ï¼‰</p><h3 id="è§£å†³çº¿ç¨‹é€šä¿¡çš„å‡ ä¸ªæ–¹æ³•"><a href="#è§£å†³çº¿ç¨‹é€šä¿¡çš„å‡ ä¸ªæ–¹æ³•" class="headerlink" title="è§£å†³çº¿ç¨‹é€šä¿¡çš„å‡ ä¸ªæ–¹æ³•"></a>è§£å†³çº¿ç¨‹é€šä¿¡çš„å‡ ä¸ªæ–¹æ³•</h3><p>æ³¨æ„ï¼šå‡æ˜¯ Object ç±»çš„æ–¹æ³•ï¼Œéƒ½åªèƒ½åœ¨åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥ä»£ç å—ä¸­ä½¿ç”¨ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ illegalMonitorStateException</p><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220225092914054.png" alt="image-20220225092914054"></p><h3 id="è§£å†³çº¿ç¨‹ä¹‹é—´é€šä¿¡çš„æ–¹å¼"><a href="#è§£å†³çº¿ç¨‹ä¹‹é—´é€šä¿¡çš„æ–¹å¼" class="headerlink" title="è§£å†³çº¿ç¨‹ä¹‹é—´é€šä¿¡çš„æ–¹å¼"></a>è§£å†³çº¿ç¨‹ä¹‹é—´é€šä¿¡çš„æ–¹å¼</h3><h4 id="ç®¡ç¨‹æ³•"><a href="#ç®¡ç¨‹æ³•" class="headerlink" title="ç®¡ç¨‹æ³•"></a>ç®¡ç¨‹æ³•</h4><p>å¹¶å‘å†™ä½œæ¨¡å‹â€â€ç”Ÿäº§è€…&#x2F;æ¶ˆè´¹è€…æ¨¡å¼â€â€â€“&gt;ç®¡ç¨‹æ³•</p><ul><li>ç”Ÿäº§è€…ï¼šè´Ÿè´£ç”Ÿäº§æ•°æ®çš„æ¨¡å—ï¼ˆå¯èƒ½æ˜¯æ–¹æ³•ï¼Œå¯¹è±¡ï¼Œçº¿ç¨‹ï¼Œè¿›ç¨‹ï¼‰</li><li>æ¶ˆè´¹è€…ï¼šè´Ÿè´£å¤„ç†æ•°æ®çš„æ¨¡å—ï¼ˆå¯èƒ½æ˜¯æ–¹æ³•ï¼Œå¯¹è±¡ï¼Œçº¿ç¨‹ï¼Œè¿›ç¨‹ï¼‰</li><li>ç¼“å†²åŒºï¼šæ¶ˆè´¹è€…ä¸èƒ½ç›´æ¥ä½¿ç”¨ç”Ÿäº§è€…çš„æ•°æ®ï¼Œä»–ä»¬ä¹‹é—´æœ‰ä¸ªç¼“å†²åŒº</li></ul><p>ç”Ÿäº§è€…å°†ç”Ÿäº§å¥½çš„æ•°æ®æ”¾å…¥ç¼“å†²åŒºï¼Œæ¶ˆè´¹è€…ä»ç¼“å†²åŒºæ‹¿å‡ºæ•°æ®</p><p><img src="/%E5%A4%9A%E7%BA%BF%E7%A8%8B.assets/20201118202428989-16457536282472.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>æ¡ˆä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æµ‹è¯•ï¼šç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹---ã€‹ç®¡ç¨‹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¶ˆè´¹è€…ï¼Œç”Ÿäº§è€…ï¼Œå•†å“ï¼Œç¼“å†²åŒº</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestPC</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">SyncContainer</span> <span class="variable">syncContainer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SyncContainer</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Customer</span>(syncContainer).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Producer</span>(syncContainer).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Customer</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºç¼“å†²åŒº</span></span><br><span class="line">    <span class="keyword">private</span> SyncContainer syncContainer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Customer</span><span class="params">(SyncContainer syncContainer)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.syncContainer = syncContainer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="type">Product</span> <span class="variable">pop</span> <span class="operator">=</span> syncContainer.pop();</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆè´¹äº†ç¬¬&quot;</span> + pop.getId() + <span class="string">&quot;å·äº§å“&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”Ÿäº§è€…</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Producer</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="comment">//åˆ›å»ºæ–°çš„ç¼“å†²åŒº</span></span><br><span class="line">    <span class="keyword">private</span> SyncContainer syncContainer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Producer</span><span class="params">(SyncContainer syncContainer)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.syncContainer = syncContainer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§äº†&quot;</span> + i + <span class="string">&quot;åªé¸¡ï¼&quot;</span>);</span><br><span class="line">            syncContainer.push(<span class="keyword">new</span> <span class="title class_">Product</span>(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å•†å“</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="type">int</span> id;<span class="comment">//äº§å“ç¼–å·</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Product</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼“å†²åŒº</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SyncContainer</span> &#123;</span><br><span class="line">    <span class="comment">//å®šä¹‰å®¹å™¨å¤§å°</span></span><br><span class="line">    Product[] products = <span class="keyword">new</span> <span class="title class_">Product</span>[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®¹å™¨è®¡æ•°å™¨</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”Ÿäº§è€…æ”¾å…¥äº§å“</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(Product product)</span> &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœå®¹å™¨æ»¡äº†ï¼Œå°±ç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line">        <span class="keyword">if</span> (count == products.length) &#123;</span><br><span class="line">            <span class="comment">//é€šçŸ¥æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œç”Ÿäº§ç­‰å¾…</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡æœ‰æ»¡ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸¢å…¥äº§å“</span></span><br><span class="line">        products[count] = product;</span><br><span class="line">        count++;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//é€šçŸ¥æ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¶ˆè´¹è€…æ¶ˆè´¹äº§å“</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> Product <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//é€šçŸ¥ç”Ÿäº§è€…ç”Ÿäº§ï¼Œæ¶ˆè´¹è€…ç­‰å¾…</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¦‚æœå¯ä»¥æ¶ˆè´¹</span></span><br><span class="line">        count--;</span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> products[count];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//é€šçŸ¥ç”Ÿäº§è€…æ¶ˆè´¹</span></span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¿¡å·ç¯æ³•"><a href="#ä¿¡å·ç¯æ³•" class="headerlink" title="ä¿¡å·ç¯æ³•"></a>ä¿¡å·ç¯æ³•</h4><p>é€šè¿‡æ ‡å¿—ä½è§£å†³</p><p><strong>æ¡ˆä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æµ‹è¯•ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜2ï¼šä¿¡å·ç¯æ³•ï¼Œé€šè¿‡æ ‡å¿—ä½è§£å†³</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestPC2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">TV</span> <span class="variable">tv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TV</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Player</span>(tv).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Watcher</span>(tv).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”Ÿäº§è€…--&gt;æ¼”å‘˜</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Player</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    TV tv;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Player</span><span class="params">(TV tv)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.tv = tv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.tv.play(<span class="string">&quot;å¿«ä¹å¤§æœ¬è¥æ’­æ”¾ä¸­&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.tv.play(<span class="string">&quot;æŠ–éŸ³ï¼šè®°å½•ç¾å¥½ç”Ÿæ´»&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¶ˆè´¹è€…--&gt;è§‚ä¼—</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Watcher</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    TV tv;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Watcher</span><span class="params">(TV tv)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.tv = tv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            tv.watch();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//äº§å“--&gt;èŠ‚ç›®</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TV</span> &#123;</span><br><span class="line">    <span class="comment">//æ¼”å‘˜è¡¨æ¼”ï¼Œè§‚ä¼—ç­‰å¾… T</span></span><br><span class="line">    <span class="comment">//è§‚ä¼—è§‚çœ‹ï¼Œæ¼”å‘˜ç­‰å¾… F</span></span><br><span class="line">    String voice; <span class="comment">// è¡¨æ¼”çš„èŠ‚ç›®</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//è¡¨æ¼”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">play</span><span class="params">(String voice)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¼”å‘˜è¡¨æ¼”äº†ï¼š&quot;</span> + voice);</span><br><span class="line">        <span class="comment">//é€šçŸ¥è§‚ä¼—è§‚çœ‹</span></span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">        <span class="built_in">this</span>.voice = voice;</span><br><span class="line">        <span class="built_in">this</span>.flag = !<span class="built_in">this</span>.flag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è§‚çœ‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">watch</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;è§‚çœ‹äº†ï¼š&quot;</span> + voice);</span><br><span class="line">        <span class="comment">//é€šçŸ¥æ¼”å‘˜è¡¨æ¼”</span></span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">        <span class="built_in">this</span>.flag = !<span class="built_in">this</span>.flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨çº¿ç¨‹æ± "><a href="#ä½¿ç”¨çº¿ç¨‹æ± " class="headerlink" title="ä½¿ç”¨çº¿ç¨‹æ± "></a>ä½¿ç”¨çº¿ç¨‹æ± </h3><ul><li>èƒŒæ™¯ï¼šç»å¸¸åˆ›å»ºå’Œé”€æ¯ã€ä½¿ç”¨é‡ç‰¹åˆ«å¤§çš„èµ„æºï¼Œæ¯”å¦‚å¹¶å‘æƒ…å†µä¸‹çš„çº¿ç¨‹ï¼Œå¯¹æ€§èƒ½å½±å“å¾ˆå¤§ã€‚</li><li>æ€è·¯ï¼šæå‰åˆ›å»ºå¥½å¤šä¸ªçº¿ç¨‹ï¼Œæ”¾å…¥çº¿ç¨‹æ± ä¸­ï¼Œä½¿ç”¨æ—¶ç›´æ¥è·å–ï¼Œä½¿ç”¨å®Œæ”¾å›æ± ä¸­ã€‚å¯ä»¥é¿å…é¢‘ç¹åˆ›å»ºé”€æ¯ã€å®ç°é‡å¤åˆ©ç”¨ã€‚ç±»ä¼¼ç”Ÿæ´»ä¸­çš„å…¬å…±äº¤é€šå·¥å…·ã€‚</li><li>ä¼˜ç‚¹ï¼š<ul><li>æé«˜å“åº”é€Ÿåº¦ï¼ˆå‡å°‘äº†åˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶é—´ï¼‰</li><li>é™ä½èµ„æºæ¶ˆè€—ï¼ˆé‡å¤åˆ©ç”¨çº¿ç¨‹æ± ä¸­çº¿ç¨‹ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½åˆ›å»ºï¼‰</li><li>ä¾¿äºçº¿ç¨‹ç®¡ç†â€¦<ul><li><strong>corePoolSizeï¼š</strong>æ ¸å¿ƒæ± çš„å¤§å°</li><li><strong>maximumPoolSizeï¼š</strong>æœ€å¤§çº¿ç¨‹æ•°</li><li><strong>keepAliveTimeï¼š</strong>çº¿ç¨‹æ²¡æœ‰ä»»åŠ¡æ—¶æœ€å¤šä¿æŒå¤šé•¿æ—¶é—´ä¼šç»ˆæ­¢</li></ul></li></ul></li></ul><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220225105803246.png" alt="image-20220225105803246"></p><p><strong>æ¡ˆä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æµ‹è¯•çº¿ç¨‹æ± </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestPool</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//1.åˆ›å»ºæœåŠ¡ï¼Œåˆ›å»ºçº¿ç¨‹æ± </span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">service</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line">        service.execute(<span class="keyword">new</span> <span class="title class_">MyThread</span>());</span><br><span class="line">        service.execute(<span class="keyword">new</span> <span class="title class_">MyThread</span>());</span><br><span class="line">        service.execute(<span class="keyword">new</span> <span class="title class_">MyThread</span>());</span><br><span class="line">        service.execute(<span class="keyword">new</span> <span class="title class_">MyThread</span>());</span><br><span class="line">        service.execute(<span class="keyword">new</span> <span class="title class_">MyThread</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.å…³é—­é“¾æ¥</span></span><br><span class="line">        service.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//for (int i = 0; i &lt; 100; i++) &#123;</span></span><br><span class="line">            System.out.println(Thread.currentThread().getName());</span><br><span class="line">        <span class="comment">//&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="çº¿ç¨‹æ€»ç»“"><a href="#çº¿ç¨‹æ€»ç»“" class="headerlink" title="çº¿ç¨‹æ€»ç»“"></a>çº¿ç¨‹æ€»ç»“</h2><p><strong>åˆ›å»ºçº¿ç¨‹çš„ä¸‰ç§æ–¹å¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadNew</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">MyThread1</span>().start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">MyThread2</span>()).start();</span><br><span class="line"></span><br><span class="line">        FutureTask&lt;Integer&gt; futureTask = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;Integer&gt;(<span class="keyword">new</span> <span class="title class_">MyThread3</span>());</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">integer</span> <span class="operator">=</span> futureTask.get();</span><br><span class="line">            System.out.println(integer);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.ç»§æ‰¿Threadç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread1</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyThread1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°Runnableæ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread2</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyThread2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°Callableæ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread3</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyThread3&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å¤šçº¿ç¨‹&quot;&gt;&lt;a href=&quot;#å¤šçº¿ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;å¤šçº¿ç¨‹&quot;&gt;&lt;/a&gt;å¤šçº¿ç¨‹&lt;/h1&gt;&lt;p&gt;ç¬”è®°ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/pinghuimolu/p/15113413</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼</title>
    <link href="https://blog.jiascu.top/2022/03/04/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    <id>https://blog.jiascu.top/2022/03/04/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</id>
    <published>2022-03-04T06:59:14.547Z</published>
    <updated>2022-03-04T06:59:47.654Z</updated>
    
    <content type="html"><![CDATA[<h1 id="23ç§è®¾è®¡æ¨¡å¼ï¼ˆGoF-23ï¼‰"><a href="#23ç§è®¾è®¡æ¨¡å¼ï¼ˆGoF-23ï¼‰" class="headerlink" title="23ç§è®¾è®¡æ¨¡å¼ï¼ˆGoF 23ï¼‰"></a>23ç§è®¾è®¡æ¨¡å¼ï¼ˆGoF 23ï¼‰</h1><p>æœ‰äººæ¨èéŸ©é¡ºå¹³çš„</p><p>æ–‡æ¡£ç¬”è®°ï¼š<a href="https://blog.csdn.net/qq_42411307/article/details/114497948">(5æ¡æ¶ˆæ¯) (ç‹‚ç¥)åˆè¯†è®¾è®¡æ¨¡å¼ç¬”è®°_æ„¿ä½ æ‹¥æœ‰å¤§é£ä¸çƒˆé…’,ä¹Ÿèƒ½äº«å—å­¤ç‹¬ä¸è‡ªç”±-CSDNåšå®¢_ç‹‚ç¥è®¾è®¡æ¨¡å¼ç¬”è®°</a></p><blockquote><p>è®¾è®¡æ¨¡å¼åˆ†ç±»</p></blockquote><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220215151103903.png" alt="image-20220215151103903"></p><ul><li>åˆ›å»ºå‹æ¨¡å¼ï¼ˆnewå¯¹è±¡ï¼‰ï¼šæè¿°æ€ä¹ˆåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä½¿å¾—åˆ›å»ºå¯¹è±¡å’Œä½¿ç”¨å¯¹è±¡åˆ†ç¦»ï¼Œå°±æ˜¯ä¸åœ¨ä¸€ä¸ªä»£ç å—é‡Œé¢</li><li>ç»“æ„å‹æ¨¡å¼ï¼šæè¿°æ€ä¹ˆæ¥è®¾è®¡ç±»çš„ç»“æ„</li><li>è¡Œä¸ºå‹æ¨¡å¼ï¼šæè¿°ç±»æˆ–å¯¹è±¡ä¹‹é—´æ€ä¹ˆç›¸äº’åä½œï¼Œå»å®Œæˆå•ä¸ªå¯¹è±¡ä¸èƒ½å®Œæˆçš„ä»»åŠ¡</li></ul><blockquote><p>OOPä¸ƒå¤§åŸåˆ™</p></blockquote><p><img src="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.assets/image-20220215151902204.png" alt="image-20220215151902204"></p><h2 id="å•ä¾‹æ¨¡å¼-éœ€è¡¥å……ï¼Œå¹¶å‘ä¸ä¼š"><a href="#å•ä¾‹æ¨¡å¼-éœ€è¡¥å……ï¼Œå¹¶å‘ä¸ä¼š" class="headerlink" title="å•ä¾‹æ¨¡å¼(éœ€è¡¥å……ï¼Œå¹¶å‘ä¸ä¼š)"></a>å•ä¾‹æ¨¡å¼(éœ€è¡¥å……ï¼Œå¹¶å‘ä¸ä¼š)</h2><blockquote><p>é¥¿æ±‰å¼å•ä¾‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¥¿æ±‰å¼å•ä¾‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hungry</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¯èƒ½ä¼šæµªè´¹ç©ºé—´</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] data1 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] data2 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] data3 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] data4 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Hungry</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">Hungry</span> <span class="variable">HUNGRY</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Hungry</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Hungry <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> HUNGRY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åŒé‡æ£€æµ‹é”æ¨¡å¼çš„ æ‡’æ±‰å¼å•ä¾‹ DCLæ‡’æ±‰å¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‡’æ±‰å¼å•ä¾‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LazyMan</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LazyMan</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//System.out.println(Thread.currentThread().getName() + &quot;ok&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> LazyMan lazyMan;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åŒé‡æ£€æµ‹é”æ¨¡å¼çš„ æ‡’æ±‰å¼å•ä¾‹ DCLæ‡’æ±‰å¼</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LazyMan <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (lazyMan == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (LazyMan.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (lazyMan == <span class="literal">null</span>) &#123;</span><br><span class="line">                    lazyMan = <span class="keyword">new</span> <span class="title class_">LazyMan</span>();<span class="comment">//ä¸æ˜¯ä¸€ä¸ªåŸå­æ€§æ“ä½œ</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lazyMan;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1. åˆ†é…å†…å­˜ç©ºé—´</span></span><br><span class="line"><span class="comment">     * 2. æ‰§è¡Œæ„é€ æ–¹æ³•ï¼Œåˆå§‹åŒ–å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * 3. æŠŠè¿™ä¸ªå¯¹è±¡æŒ‡å‘è¿™ä¸ªç©ºé—´</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 123</span></span><br><span class="line"><span class="comment">     * 132 A</span></span><br><span class="line"><span class="comment">     *     B // æ­¤æ—¶lazyManè¿˜æ²¡æœ‰å®Œæˆæ„é€ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// // å¤šçº¿ç¨‹å¹¶å‘</span></span><br><span class="line">    <span class="comment">// public static void main(String[] args) &#123;</span></span><br><span class="line">    <span class="comment">//     for (int i = 0; i &lt; 10; i++) &#123;</span></span><br><span class="line">    <span class="comment">//         new Thread(()-&gt;&#123;</span></span><br><span class="line">    <span class="comment">//             LazyMan.getInstance();</span></span><br><span class="line">    <span class="comment">//         &#125;).start();</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å·¥å‚æ¨¡å¼"><a href="#å·¥å‚æ¨¡å¼" class="headerlink" title="å·¥å‚æ¨¡å¼"></a>å·¥å‚æ¨¡å¼</h2><blockquote><p>ç®€å•(é™æ€)å·¥å‚æ¨¡å¼</p></blockquote><p>ä¸æ»¡è¶³å¼€é—­åŸåˆ™</p><img src="è®¾è®¡æ¨¡å¼.assets/image-20220215170929478.png" alt="image-20220215170929478" style="zoom:80%;" /><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é™æ€å·¥å‚æ¨¡å¼</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ–¹æ³•ä¸€</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Car <span class="title function_">getCar</span><span class="params">(String car)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (car.equals(<span class="string">&quot;äº”è±&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WuLing</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (car.equals(<span class="string">&quot;ç‰¹æ–¯æ‹‰&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Tesla</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ–¹æ³•äºŒ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Car <span class="title function_">getWuling</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WuLing</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Car <span class="title function_">getTesla</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Tesla</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å·¥å‚æ–¹æ³•æ¨¡å¼</p></blockquote><p>æ»¡è¶³å¼€é—­åŸåˆ™</p><img src="è®¾è®¡æ¨¡å¼.assets/image-20220215170856729.png" alt="image-20220215170856729" style="zoom:80%;" /><p>ä»£ç ç»“æ„ï¼š</p><p><img src="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.assets/image-20220215171051003.png" alt="image-20220215171051003"></p><blockquote><p>æ¯”è¾ƒ</p></blockquote><p>ç»“æ„å¤æ‚åº¦: simple</p><p>ä»£ç å¤æ‚åº¦: simple</p><p>ç¼–ç¨‹å¤æ‚åº¦: simple</p><p>ç®¡ç†ä¸Šçš„å¤æ‚åº¦: simple</p><p>æ ¹æ®è®¾è®¡åŸåˆ™:å·¥å‚æ–¹æ³•æ¨¡å¼!</p><p>æ ¹æ®å®é™…ä¸šåŠ¡:ç®€å•å·¥å‚æ¨¡å¼!</p><h2 id="æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="æŠ½è±¡å·¥å‚æ¨¡å¼"></a>æŠ½è±¡å·¥å‚æ¨¡å¼</h2><p>æŠ½è±¡çš„æŠ½è±¡</p><p>å›´ç»•ä¸€ä¸ªè¶…çº§å·¥å‚åˆ›å»ºå…¶ä»–å·¥å‚ï¼Œè¯¥è¶…çº§å·¥å‚åˆç§°ä¸ºå…¶ä»–å·¥å‚çš„å·¥å‚</p><p><img src="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.assets/image-20220215171524181.png" alt="image-20220215171524181"></p><blockquote><p>UMLç±»å›¾</p></blockquote><p><img src="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.assets/image-20220215171727512.png" alt="image-20220215171727512"></p><blockquote><p>äº§å“æ—ä¸äº§å“ç­‰çº§</p></blockquote><p><img src="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.assets/image-20220215171847135.png" alt="image-20220215171847135"></p><h2 id="å»ºé€ è€…æ¨¡å¼"><a href="#å»ºé€ è€…æ¨¡å¼" class="headerlink" title="å»ºé€ è€…æ¨¡å¼"></a>å»ºé€ è€…æ¨¡å¼</h2><blockquote><p>æ–¹å¼ä¸€</p></blockquote><p><img src="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.assets/image-20220216091856173.png" alt="image-20220216091856173"></p><p><img src="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.assets/image-20220216092118077.png" alt="image-20220216092118077"></p><blockquote><p>æ–¹å¼äºŒï¼Œç®€åŒ–ï¼šå»é™¤director</p></blockquote><p><img src="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.assets/image-20220216094805639.png" alt="image-20220216094805639"></p><blockquote><p> ä¼˜ç¼ºç‚¹ã€åº”ç”¨åœºæ™¯ã€æ¯”è¾ƒï¼š</p></blockquote><p><img src="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.assets/image-20220216102151267.png" alt="image-20220216102151267"></p><p><img src="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.assets/image-20220216102256201.png" alt="image-20220216102256201"></p><h2 id="åŸå‹æ¨¡å¼"><a href="#åŸå‹æ¨¡å¼" class="headerlink" title="åŸå‹æ¨¡å¼"></a>åŸå‹æ¨¡å¼</h2><p>å…‹éš†ï¼šæµ…å…‹éš†ä¸æ·±å…‹éš†</p><p><img src="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.assets/image-20220216110422325.png" alt="image-20220216110422325"></p><p>æ·±å…‹éš†ï¼š</p><ol><li>æ”¹é€ cloneæ–¹æ³•</li><li>åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼šæ€§èƒ½æ¯”è¾ƒä½ä¸‹</li></ol><h2 id="é€‚é…å™¨æ¨¡å¼"><a href="#é€‚é…å™¨æ¨¡å¼" class="headerlink" title="é€‚é…å™¨æ¨¡å¼"></a>é€‚é…å™¨æ¨¡å¼</h2><p>é€‚é…å™¨ï¼š</p><ol><li><p>ç»§æ‰¿ï¼ˆç±»é€‚é…å™¨ï¼Œå•ç»§æ‰¿ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Adapter</span> <span class="keyword">extends</span> <span class="title class_">Adaptee</span> <span class="keyword">implements</span> <span class="title class_">NetToUsb</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.request(); <span class="comment">//å¯ä»¥ä¸Šç½‘äº†</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç»„åˆ ï¼ˆå¯¹è±¡é€‚é…å™¨ï¼šå¸¸ç”¨ï¼‰ æ¨èï¼ï¼ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Adapter2</span> <span class="keyword">implements</span> <span class="title class_">NetToUsb</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Adaptee adaptee;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Adapter2</span><span class="params">(Adaptee adaptee)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.adaptee = adaptee;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">()</span> &#123;</span><br><span class="line">        adaptee.request();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>ç¤ºä¾‹ï¼šç½‘çº¿â€”â€”è½¬æ¢å™¨â€”â€”ç”µè„‘æ¥å£</p><p><img src="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.assets/image-20220216152143020.png" alt="image-20220216152143020"></p><p><img src="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.assets/image-20220216152454136.png" alt="image-20220216152454136"></p><blockquote><p>ä¼˜ç¼ºç‚¹</p></blockquote><p><img src="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.assets/image-20220216152640970.png" alt="image-20220216152640970"></p><h2 id="æ¡¥æ¥æ¨¡å¼"><a href="#æ¡¥æ¥æ¨¡å¼" class="headerlink" title="æ¡¥æ¥æ¨¡å¼"></a>æ¡¥æ¥æ¨¡å¼</h2><p><img src="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.assets/image-20220216153110395.png" alt="image-20220216153110395"></p><p><img src="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.assets/image-20220216153400419.png" alt="image-20220216153400419"></p><blockquote><p>æ¡¥æ¥æ¨¡å¼</p></blockquote><p>æ¡¥æ¥æ¨¡å¼æ˜¯å°†æŠ½è±¡éƒ¨åˆ†ä¸å®ƒçš„å®ç°éƒ¨åˆ†åˆ†ç¦», ä½¿ä»–ä»¬éƒ½å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–, å®ƒæ˜¯ä¸€ç§å¯¹è±¡ç»“æ„å‹æ¨¡å¼, åˆç§°ä¸ºæŸ„ä½“(Handle and Body)æ¨¡å¼æˆ–æ¥å£(Interface)æ¨¡å¼</p><p><img src="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.assets/image-20220216155712610.png" alt="image-20220216155712610"></p><blockquote><p>ä¼˜åŠ£</p></blockquote><p><img src="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.assets/image-20220216155831430.png" alt="image-20220216155831430"></p><p><img src="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.assets/image-20220216160028428.png" alt="image-20220216160028428"></p><h2 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h2><p><img src="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.assets/image-20220216161542800.png" alt="image-20220216161542800"></p><h3 id="é™æ€ä»£ç†"><a href="#é™æ€ä»£ç†" class="headerlink" title="é™æ€ä»£ç†"></a>é™æ€ä»£ç†</h3><blockquote><p>è§’è‰²åˆ†æ:</p></blockquote><ul><li>æŠ½è±¡è§’è‰²: ä¸€èˆ¬ä¼šä½¿ç”¨æ¥å£æˆ–æŠ½è±¡ç±»æ¥è§£å†³</li><li>çœŸå®è§’è‰²: è¢«ä»£ç†çš„è§’è‰²</li><li>ä»£ç†è§’è‰²: ä»£ç†çœŸå®è§’è‰²,ä»£ç†çœŸå®è§’è‰²å,æˆ‘ä»¬ä¸€èˆ¬ä¼šåšä¸€äº›é™„å±æ“ä½œ</li><li>å®¢æˆ·: è®¿é—®ä»£ç†å¯¹è±¡çš„äºº</li></ul><blockquote><p>ä»£ç æ­¥éª¤</p></blockquote><ol><li>æ¥å£</li><li>çœŸå®è§’è‰²</li><li>ä»£ç†è§’è‰²</li><li>å®¢æˆ·ç«¯è®¿é—®ä»£ç†è§’è‰²</li></ol><blockquote><p>ä¼˜ç¼ºç‚¹</p></blockquote><p>ä»£ç†æ¨¡å¼çš„å¥½å¤„:</p><ul><li>å¯ä»¥ä½¿çœŸå®è§’è‰²çš„æ“ä½œæ›´åŠ çº¯ç²¹,ä¸ç”¨å»å…³æ³¨ä¸€äº›å…¬å…±çš„ä¸šåŠ¡</li><li>å…¬å…±ä¹Ÿå°±äº¤ç»™ä»£ç†è§’è‰²,å®ç°äº†ä¸šåŠ¡çš„åˆ†å·¥</li><li>å…¬å…±ä¸šåŠ¡å‘ç”Ÿæ‰©å±•çš„æ—¶å€™,æ–¹ä¾¿é›†ä¸­ç®¡ç†</li></ul><p>ç¼ºç‚¹:</p><ul><li>ä¸€ä¸ªçœŸå®è§’è‰²å°±ä¼šäº§ç”Ÿä¸€ä¸ªä»£ç†è§’è‰²,ä»£ç é‡ä¼šç¿»å€,å¼€å‘æ•ˆç‡ä¼šå˜ä½</li></ul><h3 id="é™æ€ä»£ç†å†ç†è§£"><a href="#é™æ€ä»£ç†å†ç†è§£" class="headerlink" title="é™æ€ä»£ç†å†ç†è§£"></a>é™æ€ä»£ç†å†ç†è§£</h3><p><img src="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.assets/618c6f6e78e1a5ab9997fdb418bdeb82.png" alt="image-20201108162839442"></p><h3 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h3><ul><li>åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†è§’è‰²ä¸€æ ·</li><li>åŠ¨æ€ä»£ç†çš„ä»£ç†ç±»æ˜¯åŠ¨æ€ç”Ÿæˆçš„,ä¸æ˜¯æˆ‘ä»¬ç›´æ¥å†™å¥½çš„</li><li>åŠ¨æ€ä»£ç†åˆ†ä¸ºä¸¤å¤§ç±» : åŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†,åŸºäºç±»çš„åŠ¨æ€ä»£ç†<ul><li>åŸºäºæ¥å£-JDKåŠ¨æ€ä»£ç†ã€æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨ã€‘</li><li>åŸºäºç±»: <ul><li>cglib</li><li>javaå­—èŠ‚ç å®ç° : javassist</li></ul></li></ul></li></ul><p>éœ€è¦äº†è§£çš„ä¸¤ä¸ªç±»: Proxy: ä»£ç†, InvocationHandler: è°ƒç”¨å¤„ç†ç¨‹åº</p><blockquote><p>InvocationHandler(è°ƒç”¨å¤„ç†ç¨‹åº)</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jia.proxy.demo04;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jia.proxy.demo03.Rent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * User: jia</span></span><br><span class="line"><span class="comment"> * Time: 2022/2/16  19:10</span></span><br><span class="line"><span class="comment"> * Description:</span></span><br><span class="line"><span class="comment"> * Version:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//æˆ–ç”¨è¿™ä¸ªç±»è‡ªåŠ¨ç”Ÿæˆä»£ç†ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProxyInvocationHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¢«ä»£ç†çš„æ¥å£</span></span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTarget</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”Ÿæˆå¾—åˆ°ä»£ç†ç±»</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getProxy</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(<span class="built_in">this</span>.getClass().getClassLoader(), target.getClass().getInterfaces(),<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// proxy : ä»£ç†ç±»</span></span><br><span class="line">    <span class="comment">// method : ä»£ç†ç±»çš„è°ƒç”¨å¤„ç†ç¨‹åºçš„æ–¹æ³•å¯¹è±¡.</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        log(method.getName());</span><br><span class="line">        <span class="comment">//åŠ¨æ€ä»£ç†çš„æœ¬è´¨,å°±æ˜¯ä½¿ç”¨åå°„æœºåˆ¶å®ç°</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(target, args);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(String methodName)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œäº†&quot;</span>+methodName+<span class="string">&quot;æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¥½å¤„</p></blockquote><p>é™æ€ä»£ç†æœ‰çš„å®ƒéƒ½æœ‰ï¼Œé™æ€ä»£ç†æ²¡æœ‰çš„ï¼Œå®ƒä¹Ÿæœ‰ï¼</p><ul><li>å¯ä»¥ä½¿å¾—æˆ‘ä»¬çš„çœŸå®è§’è‰²æ›´åŠ çº¯ç²¹ . ä¸å†å»å…³æ³¨ä¸€äº›å…¬å…±çš„äº‹æƒ… .</li><li>å…¬å…±çš„ä¸šåŠ¡ç”±ä»£ç†æ¥å®Œæˆ . å®ç°äº†ä¸šåŠ¡çš„åˆ†å·¥ ,</li><li>å…¬å…±ä¸šåŠ¡å‘ç”Ÿæ‰©å±•æ—¶å˜å¾—æ›´åŠ é›†ä¸­å’Œæ–¹ä¾¿ .</li><li>ä¸€ä¸ªåŠ¨æ€ä»£ç† , ä¸€èˆ¬ä»£ç†æŸä¸€ç±»ä¸šåŠ¡</li><li>ä¸€ä¸ªåŠ¨æ€ä»£ç†å¯ä»¥ä»£ç†å¤šä¸ªç±»ï¼Œä»£ç†çš„æ˜¯æ¥å£ï¼</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;23ç§è®¾è®¡æ¨¡å¼ï¼ˆGoF-23ï¼‰&quot;&gt;&lt;a href=&quot;#23ç§è®¾è®¡æ¨¡å¼ï¼ˆGoF-23ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;23ç§è®¾è®¡æ¨¡å¼ï¼ˆGoF 23ï¼‰&quot;&gt;&lt;/a&gt;23ç§è®¾è®¡æ¨¡å¼ï¼ˆGoF 23ï¼‰&lt;/h1&gt;&lt;p&gt;æœ‰äººæ¨èéŸ©é¡ºå¹³çš„&lt;/p&gt;
&lt;p&gt;æ–‡æ¡£</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>JUCå¹¶å‘ç¼–ç¨‹</title>
    <link href="https://blog.jiascu.top/2022/03/04/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    <id>https://blog.jiascu.top/2022/03/04/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/</id>
    <published>2022-03-04T06:49:05.545Z</published>
    <updated>2022-03-04T06:49:36.258Z</updated>
    
    <content type="html"><![CDATA[<h1 id="JUCå¹¶å‘ç¼–ç¨‹"><a href="#JUCå¹¶å‘ç¼–ç¨‹" class="headerlink" title="JUCå¹¶å‘ç¼–ç¨‹"></a>JUCå¹¶å‘ç¼–ç¨‹</h1><p>ç¬”è®°ï¼š</p><p><a href="https://www.cnblogs.com/th11/p/15330675.html">JUCå¹¶å‘ç¼–ç¨‹ç¬”è®°ï¼ˆç‹‚ç¥è¯´ï¼‰ - ä½ æˆ‘ä¸åœ¨å¹´å°‘ - åšå®¢å›­ (cnblogs.com)</a></p><p><a href="https://blog.csdn.net/weixin_44491927/article/details/108560692">https://blog.csdn.net/weixin_44491927/article/details/108560692</a></p><p><a href="https://www.cnblogs.com/futuresky/p/15016732.html">https://www.cnblogs.com/futuresky/p/15016732.html</a></p><h2 id="ä»€ä¹ˆæ˜¯JUC"><a href="#ä»€ä¹ˆæ˜¯JUC" class="headerlink" title="ä»€ä¹ˆæ˜¯JUC"></a>ä»€ä¹ˆæ˜¯JUC</h2><p>JUCå°±æ˜¯java.util.concurrentä¸‹é¢çš„ç±»åŒ…ï¼Œä¸“é—¨ç”¨äºå¤šçº¿ç¨‹çš„å¼€å‘</p><p>concurrentï¼šåŒæ—¶ï¼Œå¹¶å‘</p><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220225113031656.png" alt="image-20220225113031656"></p><p>java.util å·¥å…·åŒ…</p><ul><li>ä¸šåŠ¡ï¼šæ— æ³•é€šè¿‡æ™®é€šçš„çº¿ç¨‹ä»£ç  Threadå®ç°ã€‚</li><li>Runnable æ²¡æœ‰è¿”å›å€¼ã€æ•ˆç‡ç›¸æ¯”äºCallableç›¸å¯¹è¾ƒä½ï¼</li><li>ä¼ä¸šå¼€å‘ä¸­Callable ä½¿ç”¨è¾ƒå¤š</li></ul><h2 id="çº¿ç¨‹å’Œè¿›ç¨‹"><a href="#çº¿ç¨‹å’Œè¿›ç¨‹" class="headerlink" title="çº¿ç¨‹å’Œè¿›ç¨‹"></a>çº¿ç¨‹å’Œè¿›ç¨‹</h2><blockquote><p>è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿä¸­çš„åº”ç”¨ç¨‹åºã€æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹æ˜¯ç”¨æ¥æ‰§è¡Œå…·ä½“çš„ä»»åŠ¡å’ŒåŠŸèƒ½ï¼Œæ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾çš„æœ€å°å•ä½</p><p>ä¸€ä¸ªè¿›ç¨‹å¾€å¾€å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼Œè‡³å°‘åŒ…å«ä¸€ä¸ª</p></blockquote><h3 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h3><p><strong>è¿›ç¨‹æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œï¼ŒQQ.EXE Music.EXEï¼›ç¨‹åºçš„é›†åˆ</strong></p><p>ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼Œè‡³å°‘åŒ…å«ä¸€ä¸ªçº¿ç¨‹ï¼</p><p>Javaé»˜è®¤æœ‰å‡ ä¸ªçº¿ç¨‹ï¼Ÿ<strong>2ä¸ªçº¿ç¨‹ï¼ mainçº¿ç¨‹ã€GCçº¿ç¨‹</strong></p><h3 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h3><p>å¼€äº†ä¸€ä¸ªè¿›ç¨‹Typoraï¼Œå†™å­—ï¼Œç­‰å¾…å‡ åˆ†é’Ÿä¼šè¿›è¡Œè‡ªåŠ¨ä¿å­˜(çº¿ç¨‹è´Ÿè´£çš„)</p><p>å¯¹äºJavaè€Œè¨€ï¼šThreadã€Runableã€Callableè¿›è¡Œå¼€å¯çº¿ç¨‹çš„ã€‚</p><p>&#x3D;&#x3D;<strong>æé—®ï¼ŸJAVAçœŸçš„å¯ä»¥å¼€å¯çº¿ç¨‹å—ï¼Ÿ å¼€ä¸äº†çš„ï¼</strong>&#x3D;&#x3D;</p><p>Javaæ˜¯æ²¡æœ‰æƒé™å»å¼€å¯çº¿ç¨‹ã€æ“ä½œç¡¬ä»¶çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªnativeçš„ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œå®ƒè°ƒç”¨çš„åº•å±‚çš„C++ä»£ç ã€‚</p><h3 id="å¹¶å‘"><a href="#å¹¶å‘" class="headerlink" title="å¹¶å‘"></a>å¹¶å‘</h3><p>å¤šçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªèµ„æºã€‚</p><ul><li>CPU åªæœ‰ä¸€æ ¸ï¼Œæ¨¡æ‹Ÿå‡ºæ¥å¤šæ¡çº¿ç¨‹ï¼Œå¤©ä¸‹æ­¦åŠŸï¼Œå”¯å¿«ä¸ç ´ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨CPUå¿«é€Ÿäº¤æ›¿ï¼Œæ¥æ¨¡æ‹Ÿå¤šçº¿ç¨‹ã€‚</li><li>å¹¶å‘ç¼–ç¨‹çš„æœ¬è´¨ï¼š<strong>å……åˆ†åˆ©ç”¨CPUçš„èµ„æºï¼</strong></li></ul><h3 id="å¹¶è¡Œ"><a href="#å¹¶è¡Œ" class="headerlink" title="å¹¶è¡Œ"></a>å¹¶è¡Œ</h3><p><strong>å¹¶è¡Œï¼š</strong> å¤šä¸ªäººä¸€èµ·è¡Œèµ°</p><ul><li><strong>CPUå¤šæ ¸</strong>ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æ‰§è¡Œã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>çº¿ç¨‹æ± </strong>ï¼</li></ul><p><strong>è·å–cpuçš„çº¿ç¨‹æ•°ï¼ˆé€»è¾‘å¤„ç†å™¨ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//è·å–cpuçš„æ ¸æ•°</span></span><br><span class="line">        System.out.println(Runtime.getRuntime().availableProcessors());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="çº¿ç¨‹çš„çŠ¶æ€"><a href="#çº¿ç¨‹çš„çŠ¶æ€" class="headerlink" title="çº¿ç¨‹çš„çŠ¶æ€"></a>çº¿ç¨‹çš„çŠ¶æ€</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">State</span> &#123;</span><br><span class="line"><span class="comment">//æ–°ç”Ÿ</span></span><br><span class="line">    NEW,</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿è¡Œ</span></span><br><span class="line">    RUNNABLE,</span><br><span class="line"></span><br><span class="line"><span class="comment">//é˜»å¡</span></span><br><span class="line">    BLOCKED,</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç­‰å¾…</span></span><br><span class="line">    WAITING,</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¶…æ—¶ç­‰å¾…</span></span><br><span class="line">    TIMED_WAITING,</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç»ˆæ­¢</span></span><br><span class="line">    TERMINATED;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="wait-x2F-sleep"><a href="#wait-x2F-sleep" class="headerlink" title="wait&#x2F;sleep"></a>wait&#x2F;sleep</h3><p><strong>1ã€æ¥è‡ªä¸åŒçš„ç±»</strong></p><p>wait &#x3D;&gt; Object</p><p>sleep &#x3D;&gt; Thread</p><p>ä¸€èˆ¬æƒ…å†µä¼ä¸šä¸­ä½¿ç”¨ä¼‘çœ æ˜¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TimeUnit.DAYS.sleep(<span class="number">1</span>); <span class="comment">//ä¼‘çœ 1å¤©</span></span><br><span class="line">TimeUnit.SECONDS.sleep(<span class="number">1</span>); <span class="comment">//ä¼‘çœ 1s</span></span><br></pre></td></tr></table></figure><p><strong>2ã€å…³äºé”çš„é‡Šæ”¾</strong></p><p>wait ä¼šé‡Šæ”¾é”ï¼›</p><p>sleepç¡è§‰äº†ï¼Œä¸ä¼šé‡Šæ”¾é”ï¼›</p><p><strong>3ã€ä½¿ç”¨çš„èŒƒå›´æ˜¯ä¸åŒçš„</strong></p><p>wait å¿…é¡»åœ¨åŒæ­¥ä»£ç å—ä¸­ï¼›</p><p>sleep å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ç¡ï¼›</p><p><strong>4ã€æ˜¯å¦éœ€è¦æ•è·å¼‚å¸¸</strong></p><p>waitä¹Ÿéœ€è¦æ•è·å¼‚å¸¸ï¼›ï¼ˆç½‘ä¸Šéå¸¸å¤šçš„ä»£ç è¯´ä¸ç”¨æŠ›å‡ºå¼‚å¸¸ï¼Œåº”è¯¥æ˜¯æ²¡å»çœ‹æºç å’Œå°è¯•å§ï¼Œä¸‹é¢é™„å›¾ï¼Œå…¶å®æ–‡ç« ä¸Šä¸€å¼ æºç çš„å›¾ä¹Ÿæ˜¾ç¤ºéœ€è¦æŠ›å‡ºå¼‚å¸¸ï¼‰ï¼Œnotifyå’ŒnotifyAllä¸éœ€è¦æ•è·å¼‚å¸¸ã€‚ï¼‰ä¸­æ–­</p><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/20210131150856789.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>sleepå¿…é¡»è¦æ•è·å¼‚å¸¸ï¼›</p><h2 id="Locké”ï¼ˆé‡ç‚¹ï¼‰"><a href="#Locké”ï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="Locké”ï¼ˆé‡ç‚¹ï¼‰"></a>Locké”ï¼ˆé‡ç‚¹ï¼‰</h2><h3 id="ä¼ ç»Ÿçš„-synchronized"><a href="#ä¼ ç»Ÿçš„-synchronized" class="headerlink" title="ä¼ ç»Ÿçš„ synchronized"></a>ä¼ ç»Ÿçš„ synchronized</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SaleTicketDemo01</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¹¶å‘ï¼šå¤šçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªèµ„æºç±», æŠŠèµ„æºç±»ä¸¢å…¥çº¿ç¨‹</span></span><br><span class="line">        <span class="type">Ticket</span> <span class="variable">ticket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Ticket</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// @FunctionalInterface å‡½æ•°å¼æ¥å£ï¼Œjdk1.8  lambdaè¡¨è¾¾å¼ (å‚æ•°)-&gt;&#123; ä»£ç  &#125;</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">40</span> ; i++) &#123;</span><br><span class="line">                ticket.sale();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">40</span> ; i++) &#123;</span><br><span class="line">                ticket.sale();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">40</span> ; i++) &#123;</span><br><span class="line">                ticket.sale();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;C&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// èµ„æºç±» OOP</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Ticket</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å±æ€§ã€æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å–ç¥¨çš„æ–¹å¼</span></span><br><span class="line">    <span class="comment">// synchronized æœ¬è´¨: é˜Ÿåˆ—ï¼Œé”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">sale</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (number&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;å–å‡ºäº†&quot;</span>+(number--)+<span class="string">&quot;ç¥¨,å‰©ä½™ï¼š&quot;</span>+number);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h3><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/77ca36442c3ced0659a5af7f06909bd2.png" alt="image-20200810221525974"></p><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/d0070945de646cdc612f11c99dd5fb7d.png" alt="image-20200810221731649"></p><p><strong>å…¬å¹³é”ï¼š</strong> ååˆ†å…¬å¹³ï¼Œå¿…é¡»å…ˆæ¥ååˆ°~ï¼›</p><p><strong>éå…¬å¹³é”ï¼š</strong> ååˆ†ä¸å…¬å¹³ï¼Œå¯ä»¥æ’é˜Ÿï¼›**(é»˜è®¤ä¸ºéå…¬å¹³é”)**</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SaleTicketDemo02</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Ticket2</span> <span class="variable">ticket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Ticket2</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">40</span>; i++) &#123;</span><br><span class="line">                ticket.sale();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">40</span>; i++) &#123;</span><br><span class="line">                ticket.sale();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">40</span>; i++) &#123;</span><br><span class="line">                ticket.sale();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;C&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//lockä¸‰éƒ¨æ›²</span></span><br><span class="line"><span class="comment">//1ã€    Lock lock=new ReentrantLock();</span></span><br><span class="line"><span class="comment">//2ã€    lock.lock() åŠ é”</span></span><br><span class="line"><span class="comment">//3ã€    finally=&gt; è§£é”ï¼šlock.unlock();</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Ticket2</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºé”</span></span><br><span class="line">    <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="comment">//å–ç¥¨çš„æ–¹å¼</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">sale</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock(); <span class="comment">// å¼€å¯é”</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (number &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;å–å‡ºäº†ç¬¬&quot;</span> + (number--) + <span class="string">&quot;å¼ ç¥¨å‰©ä½™&quot;</span> + number + <span class="string">&quot;å¼ ç¥¨&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock(); <span class="comment">// å…³é—­é”</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Synchronized-ä¸Lock-çš„åŒºåˆ«"><a href="#Synchronized-ä¸Lock-çš„åŒºåˆ«" class="headerlink" title="Synchronized ä¸Lock çš„åŒºåˆ«"></a>Synchronized ä¸Lock çš„åŒºåˆ«</h3><ol><li>Synchronized <strong>å†…ç½®çš„Javaå…³é”®å­—</strong>ï¼ŒLockæ˜¯ä¸€ä¸ª<strong>Javaç±»</strong></li><li>Synchronized æ— æ³•åˆ¤æ–­è·å–<strong>é”çš„çŠ¶æ€</strong>ï¼ŒLockå¯ä»¥åˆ¤æ–­</li><li>Synchronized ä¼š<strong>è‡ªåŠ¨é‡Šæ”¾é”</strong>ï¼Œlockå¿…é¡»è¦æ‰‹åŠ¨åŠ é”å’Œæ‰‹åŠ¨é‡Šæ”¾é”ï¼å¯èƒ½ä¼šé‡åˆ°æ­»é”</li><li>Synchronized çº¿ç¨‹1(è·å¾—é”-&gt;é˜»å¡)ã€çº¿ç¨‹2(ç­‰å¾…)ï¼›lockå°±ä¸ä¸€å®šä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ï¼Œlockä¼šæœ‰ä¸€ä¸ª<strong>trylock</strong>å»å°è¯•è·å–é”ï¼Œä¸ä¼šé€ æˆé•¿ä¹…çš„ç­‰å¾…ã€‚</li><li>Synchronized <strong>æ˜¯å¯é‡å…¥é”</strong>ï¼Œä¸å¯ä»¥ä¸­æ–­çš„ï¼Œ<strong>éå…¬å¹³çš„</strong>ï¼›Lockï¼Œå¯é‡å…¥çš„ï¼Œå¯ä»¥åˆ¤æ–­é”ï¼Œå¯ä»¥è‡ªå·±è®¾ç½®å…¬å¹³é”å’Œéå…¬å¹³é”ï¼›</li><li>Synchronized é€‚åˆé”å°‘é‡çš„ä»£ç åŒæ­¥é—®é¢˜ï¼ŒLocké€‚åˆé”å¤§é‡çš„åŒæ­¥ä»£ç ï¼›</li></ol><h2 id="ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜"><a href="#ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜" class="headerlink" title="ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜"></a>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜</h2><p><strong>é¢è¯•ï¼šå•ä¾‹æ¨¡å¼ã€æ’åºç®—æ³•ã€ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€æ­»é”é—®é¢˜</strong></p><p>waitæ–¹æ³•ï¼šä¼šé‡Šæ”¾é”ï¼</p><h3 id="Synchronized-ç‰ˆ"><a href="#Synchronized-ç‰ˆ" class="headerlink" title="Synchronized ç‰ˆ"></a>Synchronized ç‰ˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡é—®é¢˜ï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜ï¼ ç­‰å¾…å”¤é†’ï¼Œé€šçŸ¥å”¤é†’</span></span><br><span class="line"><span class="comment"> * çº¿ç¨‹äº¤æ›¿æ‰§è¡Œ A B æ“ä½œåŒä¸€ä¸ªå˜é‡ num = 0</span></span><br><span class="line"><span class="comment"> * A num+1</span></span><br><span class="line"><span class="comment"> * B num-1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//é¡ºåºï¼šåˆ¤æ–­å¾…-&gt;ä¸šåŠ¡-&gt;é€šçŸ¥</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Data</span> <span class="variable">data</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Data</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    data.increment();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    data.decrement();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Data</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//+1</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">if</span> (number != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//ç­‰å¾…</span></span><br><span class="line">            <span class="built_in">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        number++;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;=&gt;&quot;</span> + number);</span><br><span class="line">        <span class="comment">// é€šçŸ¥å…¶ä»–çº¿ç¨‹ï¼Œæˆ‘+1å®Œæ¯•äº†</span></span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//-1</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">decrement</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">if</span> (number == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//ç­‰å¾…</span></span><br><span class="line">            <span class="built_in">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        number--;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;=&gt;&quot;</span> + number);</span><br><span class="line">        <span class="comment">// é€šçŸ¥å…¶ä»–çº¿ç¨‹ï¼Œæˆ‘-1å®Œæ¯•äº†</span></span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å­˜åœ¨é—®é¢˜ï¼ˆè™šå‡å”¤é†’ï¼‰</p></blockquote><p><strong>é—®é¢˜ï¼Œå¦‚æœæœ‰å››ä¸ªçº¿ç¨‹</strong>ï¼Œä¼šå‡ºç°è™šå‡å”¤é†’</p><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/1af314564aae84ed73a7ee90525f9d91.png" alt="image-20200810224629273"></p><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220301195544595.png" alt="image-20220301195544595"></p><p>è§£å†³æ–¹å¼ ï¼Œ<strong>if æ”¹ä¸ºwhileå³å¯ï¼Œé˜²æ­¢è™šå‡å”¤é†’</strong></p><p><strong>ç»“è®ºï¼š</strong>å°±æ˜¯ç”¨ifåˆ¤æ–­çš„è¯ï¼Œå”¤é†’åçº¿ç¨‹ä¼šä»waitä¹‹åçš„ä»£ç å¼€å§‹è¿è¡Œï¼Œä½†æ˜¯ä¸ä¼šé‡æ–°åˆ¤æ–­ifæ¡ä»¶ï¼Œç›´æ¥ç»§ç»­è¿è¡Œifä»£ç å—ä¹‹åçš„ä»£ç ï¼Œè€Œå¦‚æœä½¿ç”¨whileçš„è¯ï¼Œä¹Ÿä¼šä»waitä¹‹åçš„ä»£ç è¿è¡Œï¼Œä½†æ˜¯å”¤é†’åä¼šé‡æ–°åˆ¤æ–­å¾ªç¯æ¡ä»¶ï¼Œå¦‚æœä¸æˆç«‹å†æ‰§è¡Œwhileä»£ç å—ä¹‹åçš„ä»£ç å—ï¼Œæˆç«‹çš„è¯ç»§ç»­waitã€‚<br>è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆç”¨whileè€Œä¸ç”¨ifçš„åŸå› äº†ï¼Œå› ä¸ºçº¿ç¨‹è¢«å”¤é†’åï¼Œæ‰§è¡Œå¼€å§‹çš„åœ°æ–¹æ˜¯waitä¹‹å</p><p><strong>ä»£ç ï¼š</strong>æœ‰é—®é¢˜ï¼Œå››ä¸ªçº¿ç¨‹ä¸èƒ½è·‘å®Œå››ä¸ªå¾ªç¯ï¼ˆè¾“å‡ºçš„ä¸æ˜¯40ä¸ªï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Data</span> <span class="variable">data</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Data</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    data.increment();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    data.decrement();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    data.increment();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;, <span class="string">&quot;C&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    data.increment();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;, <span class="string">&quot;D&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Data</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//+1</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">while</span> (number != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//ç­‰å¾…</span></span><br><span class="line">            <span class="built_in">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        number++;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;=&gt;&quot;</span> + number);</span><br><span class="line">        <span class="comment">// é€šçŸ¥å…¶ä»–çº¿ç¨‹ï¼Œæˆ‘-1å®Œæ¯•äº†</span></span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//-1</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">decrement</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">while</span> (number == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//ç­‰å¾…</span></span><br><span class="line">            <span class="built_in">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        number--;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;=&gt;&quot;</span> + number);</span><br><span class="line">        <span class="comment">// é€šçŸ¥å…¶ä»–çº¿ç¨‹ï¼Œæˆ‘-1å®Œæ¯•äº†</span></span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Lockç‰ˆï¼ˆJUCï¼‰"><a href="#Lockç‰ˆï¼ˆJUCï¼‰" class="headerlink" title="Lockç‰ˆï¼ˆJUCï¼‰"></a>Lockç‰ˆï¼ˆJUCï¼‰</h3><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/dad7044c4b8b46648084823841cb6781.png" alt="image-20200811094721678"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">B</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Data2</span> <span class="variable">data</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Data2</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    data.increment();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    data.decrement();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    data.increment();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;C&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    data.decrement();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;D&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Data2</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="type">Condition</span> <span class="variable">condition</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="comment">// +1</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­ç­‰å¾…</span></span><br><span class="line">            <span class="keyword">while</span> (num != <span class="number">0</span>) &#123;</span><br><span class="line">                condition.await();</span><br><span class="line">            &#125;</span><br><span class="line">            num++;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;=&gt;&quot;</span> + num);</span><br><span class="line">            <span class="comment">// é€šçŸ¥å…¶ä»–çº¿ç¨‹ +1 æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">            condition.signalAll();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -1</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">decrement</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­ç­‰å¾…</span></span><br><span class="line">            <span class="keyword">while</span> (num == <span class="number">0</span>) &#123;</span><br><span class="line">                condition.await();</span><br><span class="line">            &#125;</span><br><span class="line">            num--;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;=&gt;&quot;</span> + num);</span><br><span class="line">            <span class="comment">// é€šçŸ¥å…¶ä»–çº¿ç¨‹ +1 æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">            condition.signalAll();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Conditionçš„ä¼˜åŠ¿</p></blockquote><p>ç²¾å‡†çš„é€šçŸ¥å’Œå”¤é†’çš„çº¿ç¨‹ï¼</p><p><strong>å¦‚æœæˆ‘ä»¬è¦æŒ‡å®šé€šçŸ¥çš„ä¸‹ä¸€ä¸ªè¿›è¡Œé¡ºåºæ€ä¹ˆåŠå‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Conditionæ¥æŒ‡å®šé€šçŸ¥è¿›ç¨‹~</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Descriptionï¼š</span></span><br><span class="line"><span class="comment"> * A æ‰§è¡Œå®Œ è°ƒç”¨B</span></span><br><span class="line"><span class="comment"> * B æ‰§è¡Œå®Œ è°ƒç”¨C</span></span><br><span class="line"><span class="comment"> * C æ‰§è¡Œå®Œ è°ƒç”¨A</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jiaoqianjin</span></span><br><span class="line"><span class="comment"> * Date: 2020/8/11 9:58</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">C</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Data3</span> <span class="variable">data3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Data3</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                data3.printA();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                data3.printB();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                data3.printC();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;C&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Data3</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition1</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition2</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition3</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">// 1A 2B 3C</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printA</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ä¸šåŠ¡ä»£ç  åˆ¤æ–­ -&gt; æ‰§è¡Œ -&gt; é€šçŸ¥</span></span><br><span class="line">            <span class="keyword">while</span> (num != <span class="number">1</span>) &#123;</span><br><span class="line">                condition1.await();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;==&gt; AAAA&quot;</span> );</span><br><span class="line">            num = <span class="number">2</span>;</span><br><span class="line">            condition2.signal();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printB</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ä¸šåŠ¡ä»£ç  åˆ¤æ–­ -&gt; æ‰§è¡Œ -&gt; é€šçŸ¥</span></span><br><span class="line">            <span class="keyword">while</span> (num != <span class="number">2</span>) &#123;</span><br><span class="line">                condition2.await();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;==&gt; BBBB&quot;</span> );</span><br><span class="line">            num = <span class="number">3</span>;</span><br><span class="line">            condition3.signal();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printC</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ä¸šåŠ¡ä»£ç  åˆ¤æ–­ -&gt; æ‰§è¡Œ -&gt; é€šçŸ¥</span></span><br><span class="line">            <span class="keyword">while</span> (num != <span class="number">3</span>) &#123;</span><br><span class="line">                condition3.await();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;==&gt; CCCC&quot;</span> );</span><br><span class="line">            num = <span class="number">1</span>;</span><br><span class="line">            condition1.signal();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">A==&gt; AAAA</span></span><br><span class="line"><span class="comment">B==&gt; BBBB</span></span><br><span class="line"><span class="comment">C==&gt; CCCC</span></span><br><span class="line"><span class="comment">A==&gt; AAAA</span></span><br><span class="line"><span class="comment">B==&gt; BBBB</span></span><br><span class="line"><span class="comment">C==&gt; CCCC</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="8é”ç°è±¡"><a href="#8é”ç°è±¡" class="headerlink" title="8é”ç°è±¡"></a>8é”ç°è±¡</h2><p>å¦‚ä½•åˆ¤æ–­é”çš„æ˜¯è°ï¼é”åˆ°åº•é”çš„æ˜¯è°ï¼Ÿ</p><p><strong>é”ä¼šé”ä½ï¼šå¯¹è±¡ã€Class</strong></p><p>æ·±åˆ»ç†è§£æˆ‘ä»¬çš„é”</p><h3 id="é—®é¢˜1"><a href="#é—®é¢˜1" class="headerlink" title="é—®é¢˜1"></a><strong>é—®é¢˜1</strong></h3><p>ä¸¤ä¸ªåŒæ­¥æ–¹æ³•ï¼Œå…ˆæ‰§è¡Œå‘çŸ­ä¿¡è¿˜æ˜¯æ‰“ç”µè¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Phone</span> <span class="variable">phone</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(phone::sendMs).start();</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(phone::call).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Phone</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">sendMs</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘çŸ­ä¿¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">call</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰“ç”µè¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç»“æœ</strong>ï¼šå…ˆå‘çŸ­ä¿¡ï¼Œç„¶åå†æ‰“ç”µè¯ï¼</p><h3 id="é—®é¢˜2"><a href="#é—®é¢˜2" class="headerlink" title="é—®é¢˜2"></a>é—®é¢˜2</h3><p><strong>æˆ‘ä»¬è®©å‘çŸ­ä¿¡ å»¶è¿Ÿ4s</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Phone</span> <span class="variable">phone</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                phone.sendMs();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(phone::call).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Phone</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">sendMs</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">4</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘çŸ­ä¿¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">call</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰“ç”µè¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š<strong>è¿˜æ˜¯å…ˆå‘çŸ­ä¿¡ï¼Œç„¶åå†æ‰“ç”µè¯ï¼</strong></p><p><strong>whyï¼Ÿ</strong></p><p><strong>åŸå› ï¼š</strong>å¹¶ä¸æ˜¯é¡ºåºæ‰§è¡Œï¼Œè€Œæ˜¯synchronized é”ä½çš„å¯¹è±¡æ˜¯æ–¹æ³•çš„è°ƒç”¨è€…ï¼å¯¹äºä¸¤ä¸ªæ–¹æ³•ç”¨çš„æ˜¯åŒä¸€ä¸ªé”ï¼Œè°å…ˆæ‹¿åˆ°è°å…ˆæ‰§è¡Œï¼Œå¦å¤–ä¸€ä¸ªç­‰å¾…</p><h3 id="é—®é¢˜3"><a href="#é—®é¢˜3" class="headerlink" title="é—®é¢˜3"></a>é—®é¢˜3</h3><p><strong>åŠ ä¸€ä¸ªæ™®é€šæ–¹æ³•hello</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Phone2</span> <span class="variable">phone</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone2</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                phone.sendMs();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(phone::hello).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Phone2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">sendMs</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">4</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘çŸ­ä¿¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">call</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰“ç”µè¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç»“æœï¼š</strong>hello   å‘çŸ­ä¿¡</p><p><strong>åŸå› </strong>ï¼šhelloæ˜¯ä¸€ä¸ªæ™®é€šæ–¹æ³•ï¼Œä¸å—synchronizedé”çš„å½±å“ï¼Œä¸ç”¨ç­‰å¾…é”çš„é‡Šæ”¾</p><h3 id="é—®é¢˜4"><a href="#é—®é¢˜4" class="headerlink" title="é—®é¢˜4"></a>é—®é¢˜4</h3><p><strong>å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ä¸¤ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªè°ƒç”¨å‘çŸ­ä¿¡ï¼Œä¸€ä¸ªè°ƒç”¨æ‰“ç”µè¯ï¼Œé‚£ä¹ˆæ•´ä¸ªé¡ºåºæ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Phone2</span> <span class="variable">phone1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone2</span>();</span><br><span class="line">        <span class="type">Phone2</span> <span class="variable">phone2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone2</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                phone1.sendMs();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(phone2::call).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Phone2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">sendMs</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">4</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘çŸ­ä¿¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">call</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰“ç”µè¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç»“æœï¼š</strong>æ‰“ç”µè¯  å‘çŸ­ä¿¡</p><p><strong>åŸå› </strong>ï¼šä¸¤ä¸ªå¯¹è±¡ä¸¤æŠŠé”ï¼Œä¸ä¼šå‡ºç°ç­‰å¾…çš„æƒ…å†µï¼Œå‘çŸ­ä¿¡ç¡äº†4s,æ‰€ä»¥å…ˆæ‰§è¡Œæ‰“ç”µè¯</p><h3 id="é—®é¢˜5ï¼Œ6"><a href="#é—®é¢˜5ï¼Œ6" class="headerlink" title="é—®é¢˜5ï¼Œ6"></a><strong>é—®é¢˜5ï¼Œ6</strong></h3><p><strong>å¦‚æœæˆ‘ä»¬æŠŠsynchronizedçš„æ–¹æ³•åŠ ä¸Šstaticå˜æˆé™æ€æ–¹æ³•ï¼é‚£ä¹ˆé¡ºåºåˆæ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</strong></p><p>ï¼ˆ1ï¼‰æˆ‘ä»¬å…ˆæ¥ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡è°ƒç”¨ä¸¤ä¸ªæ–¹æ³•ï¼</p><p>ç­”æ¡ˆæ˜¯ï¼š<strong>å…ˆå‘çŸ­ä¿¡,åæ‰“ç”µè¯</strong></p><p>ï¼ˆ2ï¼‰å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªå¯¹è±¡è°ƒç”¨ä¸¤ä¸ªæ–¹æ³•ï¼</p><p>ç­”æ¡ˆæ˜¯ï¼š<strong>è¿˜æ˜¯å…ˆå‘çŸ­ä¿¡ï¼Œåæ‰“ç”µè¯</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test3</span>  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸¤ä¸ªå¯¹è±¡çš„Classç±»æ¨¡æ¿åªæœ‰ä¸€ä¸ªï¼Œstaticï¼Œé”çš„æ˜¯Class</span></span><br><span class="line">        <span class="type">Phone3</span> <span class="variable">phone1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone3</span>();</span><br><span class="line">        <span class="type">Phone3</span> <span class="variable">phone2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone3</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//é”çš„å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            phone1.sendSms();</span><br><span class="line">        &#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ•è·</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            phone2.call();</span><br><span class="line">        &#125;,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Phone3å”¯ä¸€çš„ä¸€ä¸ª Class å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Phone3</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// synchronized é”çš„å¯¹è±¡æ˜¯æ–¹æ³•çš„è°ƒç”¨è€…ï¼</span></span><br><span class="line">    <span class="comment">// static é™æ€æ–¹æ³•</span></span><br><span class="line">    <span class="comment">// ç±»ä¸€åŠ è½½å°±æœ‰äº†ï¼é”çš„æ˜¯Class</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">sendSms</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">4</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘çŸ­ä¿¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">call</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰“ç”µè¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ ä¸ºä»€ä¹ˆåŠ äº†staticå°±å§‹ç»ˆå‰é¢ä¸€ä¸ªå¯¹è±¡å…ˆæ‰§è¡Œå‘¢ï¼ä¸ºä»€ä¹ˆåé¢ä¼šç­‰å¾…å‘¢ï¼Ÿ</p><p>åŸå› ï¼š<strong>å¯¹äºstaticé™æ€æ–¹æ³•æ¥è¯´ï¼Œå¯¹äºæ•´ä¸ªç±»Classæ¥è¯´åªæœ‰ä¸€ä»½ï¼Œå¯¹äºä¸åŒçš„å¯¹è±¡ä½¿ç”¨çš„æ˜¯åŒä¸€ä»½æ–¹æ³•ï¼Œç›¸å½“äºè¿™ä¸ªæ–¹æ³•æ˜¯å±äºè¿™ä¸ªç±»çš„ï¼Œå¦‚æœé™æ€staticæ–¹æ³•ä½¿ç”¨synchronizedé”å®šï¼Œé‚£ä¹ˆè¿™ä¸ªsynchronizedé”ä¼šé”ä½æ•´ä¸ªå¯¹è±¡ï¼ä¸ç®¡å¤šå°‘ä¸ªå¯¹è±¡ï¼Œå¯¹äºé™æ€çš„é”éƒ½åªæœ‰ä¸€æŠŠé”ï¼Œè°å…ˆæ‹¿åˆ°è¿™ä¸ªé”å°±å…ˆæ‰§è¡Œï¼Œå…¶ä»–çš„è¿›ç¨‹éƒ½éœ€è¦ç­‰å¾…ï¼</strong></p><h3 id="é—®é¢˜7ï¼Œ8"><a href="#é—®é¢˜7ï¼Œ8" class="headerlink" title="é—®é¢˜7ï¼Œ8"></a><strong>é—®é¢˜7ï¼Œ8</strong></h3><p><strong>å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªé™æ€åŒæ­¥æ–¹æ³•ã€ä¸€ä¸ªåŒæ­¥æ–¹æ³•ã€ä¸€ä¸ªå¯¹è±¡è°ƒç”¨é¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><p>ï¼ˆ1ï¼‰ä¸€ä¸ªå¯¹è±¡ï¼Œå…ˆæ‰“å° å‘çŸ­ä¿¡ï¼Ÿæ‰“ç”µè¯ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼š<strong>å…ˆæ‰“ç”µè¯,åå‘çŸ­ä¿¡</strong></p><p>ï¼ˆ2ï¼‰ä¸¤ä¸ªå¯¹è±¡ï¼Œå…ˆæ‰“å° å‘çŸ­ä¿¡ï¼Ÿæ‰“ç”µè¯ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼š<strong>è¿˜æ˜¯å…ˆå‘çŸ­ä¿¡ï¼Œåæ‰“ç”µè¯</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * 1ã€1ä¸ªé™æ€çš„åŒæ­¥æ–¹æ³•ï¼Œ1ä¸ªæ™®é€šçš„åŒæ­¥æ–¹æ³• ï¼Œä¸€ä¸ªå¯¹è±¡ï¼Œå…ˆæ‰“å° å‘çŸ­ä¿¡ï¼Ÿæ‰“ç”µè¯ï¼Ÿ</span></span><br><span class="line"><span class="comment"> * 2ã€1ä¸ªé™æ€çš„åŒæ­¥æ–¹æ³•ï¼Œ1ä¸ªæ™®é€šçš„åŒæ­¥æ–¹æ³• ï¼Œä¸¤ä¸ªå¯¹è±¡ï¼Œå…ˆæ‰“å° å‘çŸ­ä¿¡ï¼Ÿæ‰“ç”µè¯ï¼Ÿ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test4</span>  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸¤ä¸ªå¯¹è±¡çš„Classç±»æ¨¡æ¿åªæœ‰ä¸€ä¸ªï¼Œstaticï¼Œé”çš„æ˜¯Class</span></span><br><span class="line">        <span class="type">Phone4</span> <span class="variable">phone1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone4</span>();</span><br><span class="line">        <span class="type">Phone4</span> <span class="variable">phone2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone4</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//é”çš„å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            phone1.sendSms();</span><br><span class="line">        &#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ•è·</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            phone2.call();</span><br><span class="line">        &#125;,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Phone3å”¯ä¸€çš„ä¸€ä¸ª Class å¯¹è±¡</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Phone4</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™æ€çš„åŒæ­¥æ–¹æ³• é”çš„æ˜¯ Class ç±»æ¨¡æ¿</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">sendSms</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">4</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘çŸ­ä¿¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ™®é€šçš„åŒæ­¥æ–¹æ³•  é”çš„è°ƒç”¨è€…</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">call</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰“ç”µè¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸå› </strong>ï¼šä¸¤æŠŠé”é”çš„ä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿ï¼Œ<strong>é™æ€çš„åŒæ­¥æ–¹æ³•é”çš„æ˜¯ Class ç±»æ¨¡æ¿ï¼Œæ™®é€šçš„åŒæ­¥æ–¹æ³•  é”çš„è°ƒç”¨è€…</strong></p><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a><strong>å°ç»“</strong></h3><ul><li>é”å¯¹è±¡ï¼šnew this å…·ä½“çš„ä¸€ä¸ªæ‰‹æœºï¼Œå¯¹è±¡å’Œå¯¹è±¡ä¹‹é—´ä¸å…±ç”¨é”</li><li>é”classï¼šstatic Class å”¯ä¸€çš„ä¸€ä¸ªæ¨¡æ¿ï¼Œå¯¹è±¡å’Œæ¨¡æ¿ä¹‹é—´ä¸å…±ç”¨é”</li></ul><p>å³ï¼šé”ï¼šstatic Classæ¨¡æ¿ã€å¯¹è±¡1ã€å¯¹è±¡2â€¦</p><h2 id="é›†åˆä¸å®‰å…¨"><a href="#é›†åˆä¸å®‰å…¨" class="headerlink" title="é›†åˆä¸å®‰å…¨"></a>é›†åˆä¸å®‰å…¨</h2><h3 id="List-ä¸å®‰å…¨"><a href="#List-ä¸å®‰å…¨" class="headerlink" title="List ä¸å®‰å…¨"></a>List ä¸å®‰å…¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ListTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Object&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">10</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                arrayList.add(UUID.randomUUID().toString().substring(<span class="number">0</span>,<span class="number">5</span>));</span><br><span class="line">                System.out.println(arrayList);</span><br><span class="line">            &#125;,String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼šå¯¼è‡´java.util.ConcurrentModificationException å¹¶å‘ä¿®æ”¹å¼‚å¸¸</p><p><strong>ArrayList åœ¨å¹¶å‘æƒ…å†µä¸‹æ˜¯ä¸å®‰å…¨çš„</strong></p><p>è§£å†³æ–¹æ¡ˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ListTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * è§£å†³æ–¹æ¡ˆ</span></span><br><span class="line"><span class="comment">         * 1. List&lt;String&gt; list = new Vector&lt;&gt;();</span></span><br><span class="line"><span class="comment">         * 2. List&lt;String&gt; list = Collections.synchronizedList(new ArrayList&lt;&gt;());</span></span><br><span class="line"><span class="comment">         * 3. List&lt;String&gt; list = new CopyOnWriteArrayList&lt;&gt;();</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">10</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                list.add(UUID.randomUUID().toString().substring(<span class="number">0</span>,<span class="number">5</span>));</span><br><span class="line">                System.out.println(list);</span><br><span class="line">            &#125;,String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>CopyOnWriteArrayList</strong>ï¼š<strong>å†™å…¥æ—¶å¤åˆ¶ï¼</strong> <strong>COW è®¡ç®—æœºç¨‹åºè®¾è®¡é¢†åŸŸçš„ä¸€ç§ä¼˜åŒ–ç­–ç•¥</strong></p><p>æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå¦‚æœæœ‰å¤šä¸ªè°ƒç”¨è€…ï¼ˆCallersï¼‰åŒæ—¶è¦æ±‚ç›¸åŒçš„èµ„æºï¼ˆå¦‚å†…å­˜æˆ–è€…æ˜¯ç£ç›˜ä¸Šçš„æ•°æ®å­˜å‚¨ï¼‰ï¼Œä»–ä»¬ä¼šå…±åŒè·å–ç›¸åŒçš„æŒ‡é’ˆæŒ‡å‘ç›¸åŒçš„èµ„æºï¼Œç›´åˆ°æŸä¸ªè°ƒç”¨è€…è§†å›¾ä¿®æ”¹èµ„æºå†…å®¹æ—¶ï¼Œç³»ç»Ÿæ‰ä¼šçœŸæ­£å¤åˆ¶ä¸€ä»½ä¸“ç”¨å‰¯æœ¬ï¼ˆprivate copyï¼‰ç»™è¯¥è°ƒç”¨è€…ï¼Œè€Œå…¶ä»–è°ƒç”¨è€…æ‰€è§åˆ°çš„æœ€åˆçš„èµ„æºä»ç„¶ä¿æŒä¸å˜ã€‚è¿™è¿‡ç¨‹å¯¹å…¶ä»–çš„è°ƒç”¨è€…éƒ½æ˜¯é€æ˜çš„ï¼ˆtransparentlyï¼‰ã€‚æ­¤åšæ³•ä¸»è¦çš„ä¼˜ç‚¹æ˜¯å¦‚æœè°ƒç”¨è€…æ²¡æœ‰ä¿®æ”¹èµ„æºï¼Œå°±ä¸ä¼šæœ‰å‰¯æœ¬ï¼ˆprivate copyï¼‰è¢«åˆ›å»ºï¼Œå› æ­¤å¤šä¸ªè°ƒç”¨è€…åªæ˜¯è¯»å–æ“ä½œæ—¶å¯ä»¥å…±äº«åŒä¸€ä»½èµ„æºã€‚</p><p>è¯»çš„æ—¶å€™ä¸éœ€è¦åŠ é”ï¼Œå¦‚æœè¯»çš„æ—¶å€™æœ‰å¤šä¸ªçº¿ç¨‹æ­£åœ¨å‘CopyOnWriteArrayListæ·»åŠ æ•°æ®ï¼Œè¯»è¿˜æ˜¯ä¼šè¯»åˆ°æ—§çš„æ•°æ®ï¼Œå› ä¸ºå†™çš„æ—¶å€™ä¸ä¼šé”ä½æ—§çš„CopyOnWriteArrayListã€‚</p><p><strong>å¤šä¸ªçº¿ç¨‹è°ƒç”¨çš„æ—¶å€™ï¼Œlistï¼Œè¯»å–çš„æ—¶å€™ï¼Œå›ºå®šçš„ï¼Œå†™å…¥ï¼ˆå­˜åœ¨è¦†ç›–æ“ä½œï¼‰ï¼›</strong></p><p><strong>åœ¨å†™å…¥çš„æ—¶å€™é¿å…è¦†ç›–ï¼Œé€ æˆæ•°æ®é”™ä¹±çš„é—®é¢˜ï¼›</strong></p><p><strong>è¯»å†™åˆ†ç¦»</strong></p><blockquote><p><strong>CopyOnWriteArrayList</strong>æ¯”<strong>Vector</strong>å‰å®³åœ¨å“ªé‡Œï¼Ÿ</p></blockquote><p><strong>Vector</strong>åº•å±‚æ˜¯ä½¿ç”¨<strong>synchronized</strong>å…³é”®å­—æ¥å®ç°çš„ï¼šæ•ˆç‡ç‰¹åˆ«ä½ä¸‹ã€‚</p><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/ec0193ec03b4e67874350644b0f7b6ec-16461257137898.png" alt="image-20200811144549151"></p><p><strong>CopyOnWriteArrayList</strong>ä½¿ç”¨çš„æ˜¯Locké”ï¼Œæ•ˆç‡ä¼šæ›´åŠ é«˜æ•ˆï¼</p><p><img src="https://img-service.csdnimg.cn/img_convert/65d81d2d9f14913e79f91dcf23f8eea7.png" alt="image-20200811144447781"></p><h3 id="set-ä¸å®‰å…¨"><a href="#set-ä¸å®‰å…¨" class="headerlink" title="set ä¸å®‰å…¨"></a>set ä¸å®‰å…¨</h3><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220301190434454.png" alt="image-20220301190434454"></p><ul><li><p><strong>Setå’ŒListåŒç†å¯å¾—:</strong> å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œæ™®é€šçš„Seté›†åˆæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼›</p><p>è§£å†³æ–¹æ¡ˆè¿˜æ˜¯ä¸¤ç§ï¼š</p><ul><li>ä½¿ç”¨Collectionså·¥å…·ç±»çš„<strong>synchronized</strong>åŒ…è£…çš„Setç±»</li><li>ä½¿ç”¨CopyOnWriteArraySet å†™å…¥å¤åˆ¶çš„<strong>JUC</strong>è§£å†³æ–¹æ¡ˆ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 1. Set&lt;String&gt; set = Collections.synchronizedSet(new HashSet&lt;&gt;());</span></span><br><span class="line"><span class="comment">         * 2. Set&lt;String&gt; set = new CopyOnWriteArraySet&lt;&gt;();</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"><span class="comment">//        Set&lt;String&gt; set = new HashSet&lt;&gt;();</span></span><br><span class="line">        Set&lt;String&gt; set = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArraySet</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">30</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                set.add(UUID.randomUUID().toString().substring(<span class="number">0</span>,<span class="number">5</span>));</span><br><span class="line">                System.out.println(set);</span><br><span class="line">            &#125;,String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>HashSetåº•å±‚æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><p>hashSetåº•å±‚å°±æ˜¯ä¸€ä¸ª<strong>HashMap</strong>ï¼›</p><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/35c7c667ffc7a2e2bb001a147d30b5f9.png" alt="image-20200811150415187"></p></li></ul><h3 id="Mapä¸å®‰å…¨"><a href="#Mapä¸å®‰å…¨" class="headerlink" title="Mapä¸å®‰å…¨"></a>Mapä¸å®‰å…¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//map æ˜¯è¿™æ ·ç”¨çš„å—ï¼Ÿ  ä¸æ˜¯ï¼Œå·¥ä½œä¸­ä¸ä½¿ç”¨è¿™ä¸ª</span><br><span class="line">//é»˜è®¤ç­‰ä»·ä»€ä¹ˆï¼Ÿ new HashMap&lt;&gt;(16,0.75);</span><br><span class="line">Map&lt;String, String&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">//åŠ è½½å› å­ã€åˆå§‹åŒ–å®¹é‡</span><br></pre></td></tr></table></figure><p>é»˜è®¤<strong>åŠ è½½å› å­æ˜¯0.75</strong>,é»˜è®¤çš„<strong>åˆå§‹å®¹é‡æ˜¯16</strong></p><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/a35fac9739ec6cb78381f0a82c1a8927.png" alt="image-20200811150700927"></p><p>åŒæ ·çš„HashMapåŸºç¡€ç±»ä¹Ÿå­˜åœ¨<strong>å¹¶å‘ä¿®æ”¹å¼‚å¸¸</strong>ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//map æ˜¯è¿™æ ·ç”¨çš„å—ï¼Ÿ  ä¸æ˜¯ï¼Œå·¥ä½œä¸­ä¸ä½¿ç”¨è¿™ä¸ª</span></span><br><span class="line">        <span class="comment">//é»˜è®¤ç­‰ä»·ä»€ä¹ˆï¼Ÿ new HashMap&lt;&gt;(16,0.75);</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * è§£å†³æ–¹æ¡ˆ</span></span><br><span class="line"><span class="comment">         * 1. Map&lt;String, String&gt; map = Collections.synchronizedMap(new HashMap&lt;&gt;());</span></span><br><span class="line"><span class="comment">         *  Map&lt;String, String&gt; map = new ConcurrentHashMap&lt;&gt;();</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//åŠ è½½å› å­ã€åˆå§‹åŒ–å®¹é‡</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                map.put(Thread.currentThread().getName(), UUID.randomUUID().toString().substring(<span class="number">0</span>,<span class="number">5</span>));</span><br><span class="line">                System.out.println(map);</span><br><span class="line">            &#125;,String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä½œä¸š:ç ”ç©¶ConcurrentHashMapåº•å±‚åŸç†ï¼š</strong></p><h2 id="Callable"><a href="#Callable" class="headerlink" title="Callable"></a>Callable</h2><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220301195356970.png" alt="image-20220301195356970"></p><p><strong>1ã€å¯ä»¥æœ‰è¿”å›å€¼ï¼›</strong></p><p><strong>2ã€å¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼›</strong></p><p><strong>3ã€æ–¹æ³•ä¸åŒï¼Œrun()&#x2F;call()</strong></p><blockquote><p>ä»£ç æµ‹è¯•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutionException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.FutureTask;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CallableTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">//new Thread(new Runnable()).start();</span></span><br><span class="line">        <span class="comment">//new Thread(new FutureTask&lt;V&gt;()).start();</span></span><br><span class="line">        <span class="comment">//new Thread(new FutureTask&lt;V&gt;( Callable )).start();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//new Thread().start();// æ€ä¹ˆå¯åŠ¨Callable</span></span><br><span class="line"></span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        <span class="type">FutureTask</span> <span class="variable">futureTask</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FutureTask</span>(thread);<span class="comment">//é€‚é…ç±»</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask,<span class="string">&quot;B&quot;</span>).start();<span class="comment">// ç»“æœä¼šè¢«ç¼“å­˜ï¼Œæ•ˆç‡é«˜ï¼Œç»“æœåªæ‰“å°ä¸€æ¬¡</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–Callableçš„è¿”å›ç»“æœ</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">o</span> <span class="operator">=</span> (String) futureTask.get();<span class="comment">//è¿™ä¸ªget æ–¹æ³•å¯èƒ½ä¼šäº§ç”Ÿé˜»å¡ï¼æŠŠä»–æ”¾åˆ°æœ€å æˆ–è€…ä½¿ç”¨å¼‚æ­¥é€šä¿¡æ¥å¤„ç†ï¼</span></span><br><span class="line"></span><br><span class="line">        System.out.println(o);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;jjjj&quot;</span>);</span><br><span class="line">        <span class="comment">// è€—æ—¶çš„æ“ä½œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»†èŠ‚ï¼š</p><p>1ã€æœ‰ç¼“å­˜</p><p>2ã€ç»“æœå¯èƒ½éœ€è¦ç­‰å¾…ï¼Œä¼šé˜»å¡ï¼</p><h2 id="å¸¸ç”¨çš„è¾…åŠ©ç±»-é«˜å¹¶å‘å¿…ä¼š"><a href="#å¸¸ç”¨çš„è¾…åŠ©ç±»-é«˜å¹¶å‘å¿…ä¼š" class="headerlink" title="å¸¸ç”¨çš„è¾…åŠ©ç±»(é«˜å¹¶å‘å¿…ä¼š)"></a>å¸¸ç”¨çš„è¾…åŠ©ç±»(é«˜å¹¶å‘å¿…ä¼š)</h2><p>åŠ æ³•è®¡æ•°å™¨ï¼Œå‡æ³•è®¡æ•°å™¨å’Œä¿¡å·é‡</p><h3 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h3><p>å‡æ³•è®¡æ•°å™¨</p><p><strong>ä¸»è¦æ–¹æ³•ï¼š</strong></p><ul><li>countDown å‡ä¸€æ“ä½œï¼›</li><li>await ç­‰å¾…è®¡æ•°å™¨å½’é›¶</li></ul><p>await ç­‰å¾…è®¡æ•°å™¨å½’é›¶ï¼Œå°±å”¤é†’ï¼Œå†ç»§ç»­å‘ä¸‹è¿è¡Œ</p><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CountDownLatchDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">// æ€»æ•°æ˜¯6</span></span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">countDownLatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">6</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;==&gt; Go Out&quot;</span>);</span><br><span class="line">                countDownLatch.countDown(); <span class="comment">// æ¯ä¸ªçº¿ç¨‹éƒ½æ•°é‡ -1</span></span><br><span class="line">            &#125;,String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">        countDownLatch.await(); <span class="comment">// ç­‰å¾…è®¡æ•°å™¨å½’é›¶ ç„¶åå‘ä¸‹æ‰§è¡Œ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;close door&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="CyclickBarrier"><a href="#CyclickBarrier" class="headerlink" title="CyclickBarrier"></a>CyclickBarrier</h3><p>åŠ æ³•è®¡æ•°å™¨</p><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CyclicBarrierDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * é›†é½7é¢—é¾™ç å¬å”¤ç¥é¾™</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">// å¬å”¤é¾™ç çš„çº¿ç¨‹</span></span><br><span class="line">        <span class="type">CyclicBarrier</span> <span class="variable">cyclicBarrier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CyclicBarrier</span>(<span class="number">7</span>, () -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å¬å”¤ç¥é¾™ã€‚ã€‚ã€‚&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">7</span>; i++) &#123;</span><br><span class="line">            <span class="comment">// lambdaä¸èƒ½æ“ä½œåˆ° i , å¿…é¡»ä¸ºä¸ä¿®æ”¹çš„å¸¸é‡</span></span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot;æ”¶é›†ç¬¬&quot;</span>+temp+<span class="string">&quot;é¢—é¾™ç &quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    cyclicBarrier.await(); <span class="comment">//ç­‰å¾…</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException | BrokenBarrierException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>CyclicBarrier ä¸ CountDownLatch åŒºåˆ«</p><ul><li>CountDownLatch æ˜¯ä¸€æ¬¡æ€§çš„ï¼ŒCyclicBarrier æ˜¯å¯å¾ªç¯åˆ©ç”¨çš„</li><li>CountDownLatch å‚ä¸çš„çº¿ç¨‹çš„èŒè´£æ˜¯ä¸ä¸€æ ·çš„ï¼Œæœ‰çš„åœ¨å€’è®¡æ—¶ï¼Œæœ‰çš„åœ¨ç­‰å¾…å€’è®¡æ—¶ç»“æŸã€‚CyclicBarrier å‚ä¸çš„çº¿ç¨‹èŒè´£æ˜¯ä¸€æ ·çš„ã€‚</li></ul><h3 id="Semaphoreï¼ˆä¿¡å·é‡ï¼‰"><a href="#Semaphoreï¼ˆä¿¡å·é‡ï¼‰" class="headerlink" title="Semaphoreï¼ˆä¿¡å·é‡ï¼‰"></a>Semaphoreï¼ˆ<strong>ä¿¡å·é‡</strong>ï¼‰</h3><p>æŠ¢è½¦ä½ï¼6è½¦â€”3ä¸ªåœè½¦ä½ç½®</p><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SemaphoreDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// çº¿ç¨‹æ•°é‡ï¼šåœè½¦ä½! ç”¨æ¥é™æµï¼</span></span><br><span class="line">        <span class="type">Semaphore</span> <span class="variable">semaphore</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">3</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">6</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="comment">//acquire() å¾—åˆ°</span></span><br><span class="line">                <span class="comment">//release() é‡Šæ”¾</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    semaphore.acquire();</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot;æŠ¢åˆ°è½¦ä½ï¼&quot;</span>);</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot;ç¦»å¼€è½¦ä½ï¼&quot;</span>);</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                    semaphore.release();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸç†ï¼š</strong></p><ul><li><code>semaphore.acquire();</code> <strong>è·å¾—ï¼Œå‡è®¾å¦‚æœå·²ç»æ»¡äº†ï¼Œç­‰å¾…ï¼Œç­‰å¾…è¢«é‡Šæ”¾ä¸ºæ­¢ï¼</strong></li><li><code>semaphore.release();</code> <strong>é‡Šæ”¾ï¼Œä¼šå°†å½“å‰çš„ä¿¡å·é‡é‡Šæ”¾ + 1ï¼Œç„¶åå”¤é†’ç­‰å¾…çš„çº¿ç¨‹ï¼</strong></li></ul><p>ä½œç”¨ï¼š</p><ul><li><strong>å¤šä¸ªå…±äº«èµ„æºäº’æ–¥çš„ä½¿ç”¨ï¼å¹¶å‘é™æµï¼Œæ§åˆ¶æœ€å¤§çš„çº¿ç¨‹æ•°ï¼</strong></li></ul><h2 id="è¯»å†™é”"><a href="#è¯»å†™é”" class="headerlink" title="è¯»å†™é”"></a>è¯»å†™é”</h2><p>ReadWriteLock</p><p>æ¡ˆä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç‹¬å é”ï¼ˆå†™é”ï¼‰ ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹å æœ‰</span></span><br><span class="line"><span class="comment"> * å…±äº«é”ï¼ˆè¯»é”ï¼‰ å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶å æœ‰</span></span><br><span class="line"><span class="comment"> * ReadWriteLock</span></span><br><span class="line"><span class="comment"> * è¯»-è¯» å¯ä»¥å…±å­˜</span></span><br><span class="line"><span class="comment"> * è¯»-å†™ ä¸èƒ½å…±å­˜</span></span><br><span class="line"><span class="comment"> * å†™-å†™ ä¸èƒ½å…±å­˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReadWriteLockDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//MyCache myCache = new MyCache();</span></span><br><span class="line">        <span class="type">MyCacheLock</span> <span class="variable">myCache</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyCacheLock</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">6</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= num; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">finalI</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                myCache.write(String.valueOf(finalI), String.valueOf(finalI));</span><br><span class="line">            &#125;,String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= num; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">finalI</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                myCache.read(String.valueOf(finalI));</span><br><span class="line">            &#125;,String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyCacheLock</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// è¯»å†™é”ï¼Œæ›´åŠ ç»†ç²’åº¦çš„æ§åˆ¶</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">ReadWriteLock</span> <span class="variable">readWriteLock</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å†™çš„æ—¶å€™ï¼Œåªå¸Œæœ›åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹å†™</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">        readWriteLock.writeLock().lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹å¼€å§‹å†™å…¥&quot;</span>);</span><br><span class="line">            map.put(key, value);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹å†™å…¥ok&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            readWriteLock.writeLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¯»ï¼Œæ‰€æœ‰äººéƒ½å¯ä»¥è¯»</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">read</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        readWriteLock.readLock().lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹å¼€å§‹è¯»å–&quot;</span>);</span><br><span class="line">            map.get(key);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹è¯»å–ok&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            readWriteLock.readLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  æ–¹æ³•æœªåŠ é”ï¼Œå¯¼è‡´å†™çš„æ—¶å€™è¢«æ’é˜Ÿ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyCache</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹å¼€å§‹å†™å…¥&quot;</span>);</span><br><span class="line">        map.put(key, value);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹å†™å…¥ok&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">read</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹å¼€å§‹è¯»å–&quot;</span>);</span><br><span class="line">        map.get(key);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹å†™è¯»å–ok&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é˜»å¡é˜Ÿåˆ—"><a href="#é˜»å¡é˜Ÿåˆ—" class="headerlink" title="é˜»å¡é˜Ÿåˆ—"></a>é˜»å¡é˜Ÿåˆ—</h2><p>å†™å…¥ï¼šå¦‚æœé˜Ÿåˆ—æ»¡äº†å°±å¿…é¡»é˜»å¡ç­‰å¾…</p><p>å–ï¼šå¦‚æœé˜Ÿåˆ—æ˜¯ç©ºçš„ï¼Œå¿…é¡»é˜»å¡ç­‰å¾…ç”Ÿäº§</p><p>é˜»å¡é˜Ÿåˆ—ï¼š</p><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220302163501941.png" alt="image-20220302163501941"></p><blockquote><p>BlockingQueue æœ‰å››ç»„api</p></blockquote><table><thead><tr><th>æ–¹å¼</th><th>æŠ›å‡ºå¼‚å¸¸</th><th>ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæœ‰è¿”å›å€¼</th><th>é˜»å¡ï¼Œç­‰å¾…</th><th>è¶…æ—¶ç­‰å¾…</th></tr></thead><tbody><tr><td>æ·»åŠ </td><td>add</td><td>offer()</td><td>put</td><td>offer(timenum.timeUnit)</td></tr><tr><td>ç§»å‡º</td><td>remove</td><td>poll()</td><td>take</td><td>poll(timenum,timeUnit)</td></tr><tr><td>åˆ¤æ–­é˜Ÿé¦–å…ƒç´ </td><td>element</td><td>peek</td><td>-</td><td>-</td></tr></tbody></table><p><strong>æŠ›å‡ºå¼‚å¸¸</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//éœ€è¦åˆå§‹åŒ–é˜Ÿåˆ—çš„å¤§å°</span></span><br><span class="line">    <span class="type">ArrayBlockingQueue</span> <span class="variable">blockingQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(blockingQueue.add(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">    System.out.println(blockingQueue.add(<span class="string">&quot;b&quot;</span>));</span><br><span class="line">    System.out.println(blockingQueue.add(<span class="string">&quot;c&quot;</span>));</span><br><span class="line">    <span class="comment">//æŠ›å‡ºå¼‚å¸¸ï¼šjava.lang.IllegalStateException: Queue full</span></span><br><span class="line">    <span class="comment">//System.out.println(blockingQueue.add(&quot;d&quot;));</span></span><br><span class="line"></span><br><span class="line">    System.out.println(blockingQueue.element()); <span class="comment">//æŸ¥çœ‹é˜Ÿé¦–å…ƒç´ æ˜¯è°</span></span><br><span class="line">    System.out.println(<span class="string">&quot;---------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(blockingQueue.remove());</span><br><span class="line">    System.out.println(blockingQueue.remove());</span><br><span class="line">    System.out.println(blockingQueue.remove());</span><br><span class="line">    <span class="comment">//å¦‚æœå¤šç§»é™¤ä¸€ä¸ª</span></span><br><span class="line">    <span class="comment">//è¿™ä¹Ÿä¼šé€ æˆ java.util.NoSuchElementException æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="comment">//System.out.println(blockingQueue.remove());</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œæœ‰è¿”å›å€¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ArrayBlockingQueue</span> <span class="variable">blockingQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">    System.out.println(blockingQueue.offer(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">    System.out.println(blockingQueue.offer(<span class="string">&quot;b&quot;</span>));</span><br><span class="line">    System.out.println(blockingQueue.offer(<span class="string">&quot;c&quot;</span>));</span><br><span class="line">    <span class="comment">//æ·»åŠ ä¸€ä¸ªä¸èƒ½æ·»åŠ çš„å…ƒç´  ä½¿ç”¨offeråªä¼šè¿”å›false ä¸ä¼šæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    System.out.println(blockingQueue.offer(<span class="string">&quot;d&quot;</span>));</span><br><span class="line"></span><br><span class="line">    System.out.println(blockingQueue.peek()); <span class="comment">//æŸ¥çœ‹é˜Ÿé¦–å…ƒç´ æ˜¯è°</span></span><br><span class="line">    System.out.println(<span class="string">&quot;---------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(blockingQueue.poll());</span><br><span class="line">    System.out.println(blockingQueue.poll());</span><br><span class="line">    System.out.println(blockingQueue.poll());</span><br><span class="line">    <span class="comment">//å¼¹å‡º å¦‚æœæ²¡æœ‰å…ƒç´  åªä¼šè¿”å›null ä¸ä¼šæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    System.out.println(blockingQueue.poll());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç­‰å¾… ä¸€ç›´é˜»å¡</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">ArrayBlockingQueue</span> <span class="variable">blockingQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸€ç›´é˜»å¡ ä¸ä¼šè¿”å›</span></span><br><span class="line">    blockingQueue.put(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">    blockingQueue.put(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">    blockingQueue.put(<span class="string">&quot;c&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¦‚æœé˜Ÿåˆ—å·²ç»æ»¡äº†ï¼Œ å†è¿›å»ä¸€ä¸ªå…ƒç´   è¿™ç§æƒ…å†µä¼šä¸€ç›´ç­‰å¾…è¿™ä¸ªé˜Ÿåˆ— ä»€ä¹ˆæ—¶å€™æœ‰äº†ä½ç½®å†è¿›å»ï¼Œç¨‹åºä¸ä¼šåœæ­¢</span></span><br><span class="line">    <span class="comment">//blockingQueue.put(&quot;d&quot;);</span></span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;---------------------&quot;</span>);</span><br><span class="line">    System.out.println(blockingQueue.take());</span><br><span class="line">    System.out.println(blockingQueue.take());</span><br><span class="line">    System.out.println(blockingQueue.take());</span><br><span class="line">    <span class="comment">//å¦‚æœæˆ‘ä»¬å†æ¥ä¸€ä¸ª  è¿™ç§æƒ…å†µä¹Ÿä¼šç­‰å¾…ï¼Œç¨‹åºä¼šä¸€ç›´è¿è¡Œ é˜»å¡</span></span><br><span class="line">    System.out.println(blockingQueue.take());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç­‰å¾… è¶…æ—¶é˜»å¡</strong></p><p>è¿™ç§æƒ…å†µä¹Ÿä¼šç­‰å¾…é˜Ÿåˆ—æœ‰ä½ç½® æˆ–è€…æœ‰äº§å“ ä½†æ˜¯ä¼šè¶…æ—¶ç»“æŸ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">ArrayBlockingQueue</span> <span class="variable">blockingQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">    blockingQueue.offer(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">    blockingQueue.offer(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">    blockingQueue.offer(<span class="string">&quot;c&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;å¼€å§‹ç­‰å¾…&quot;</span>);</span><br><span class="line">    blockingQueue.offer(<span class="string">&quot;d&quot;</span>,<span class="number">2</span>, TimeUnit.SECONDS);  <span class="comment">//è¶…æ—¶æ—¶é—´2s ç­‰å¾…å¦‚æœè¶…è¿‡2så°±ç»“æŸç­‰å¾…</span></span><br><span class="line">    System.out.println(<span class="string">&quot;ç»“æŸç­‰å¾…&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;===========å–å€¼==================&quot;</span>);</span><br><span class="line">    System.out.println(blockingQueue.poll());</span><br><span class="line">    System.out.println(blockingQueue.poll());</span><br><span class="line">    System.out.println(blockingQueue.poll());</span><br><span class="line">    System.out.println(<span class="string">&quot;å¼€å§‹ç­‰å¾…&quot;</span>);</span><br><span class="line">    blockingQueue.poll(<span class="number">2</span>,TimeUnit.SECONDS); <span class="comment">//è¶…è¿‡ä¸¤ç§’ æˆ‘ä»¬å°±ä¸è¦ç­‰å¾…äº†</span></span><br><span class="line">    System.out.println(<span class="string">&quot;ç»“æŸç­‰å¾…&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¡¥å……ï¼šåŒæ­¥é˜Ÿåˆ—SynchronousQueue</p></blockquote><ul><li>åŒæ­¥é˜Ÿåˆ—æ²¡æœ‰å®¹é‡ï¼Œä¹Ÿå¯ä»¥è§†ä¸º<strong>å®¹é‡ä¸º1çš„é˜Ÿåˆ—</strong>ï¼›</li><li>è¿›å»ä¸€ä¸ªå…ƒç´ ï¼Œå¿…é¡»ç­‰å¾…å–å‡ºæ¥ä¹‹åï¼Œæ‰èƒ½å†å¾€é‡Œé¢æ”¾å…¥ä¸€ä¸ªå…ƒç´ ï¼›</li><li><strong>put</strong>æ–¹æ³• å’Œ <strong>take</strong>æ–¹æ³•ï¼›</li><li>Synchronized å’Œ å…¶ä»–çš„BlockingQueue ä¸ä¸€æ · å®ƒä¸å­˜å‚¨å…ƒç´ ï¼›</li><li><strong>putäº†ä¸€ä¸ªå…ƒç´ ï¼Œå°±å¿…é¡»ä»é‡Œé¢å…ˆtakeå‡ºæ¥ï¼Œå¦åˆ™ä¸èƒ½å†putè¿›å»å€¼ï¼</strong></li><li>å¹¶ä¸”SynchronousQueue çš„takeæ˜¯ä½¿ç”¨äº†locké”ä¿è¯çº¿ç¨‹å®‰å…¨çš„</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynchronousQueueDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        BlockingQueue&lt;String&gt; synchronousQueue = <span class="keyword">new</span> <span class="title class_">SynchronousQueue</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// ç½‘queueä¸­æ·»åŠ å…ƒç´ </span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; put 1&quot;</span>);</span><br><span class="line">                synchronousQueue.put(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; put 2&quot;</span>);</span><br><span class="line">                synchronousQueue.put(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; put 3&quot;</span>);</span><br><span class="line">                synchronousQueue.put(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        <span class="comment">// å–å‡ºå…ƒç´ </span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; take &quot;</span> + synchronousQueue.take());</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; take &quot;</span> + synchronousQueue.take());</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; take &quot;</span> + synchronousQueue.take());</span><br><span class="line">            &#125;<span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="çº¿ç¨‹æ± -é‡ç‚¹"><a href="#çº¿ç¨‹æ± -é‡ç‚¹" class="headerlink" title="çº¿ç¨‹æ± (é‡ç‚¹)"></a>çº¿ç¨‹æ± (é‡ç‚¹)</h2><p><strong>çº¿ç¨‹æ± ï¼šä¸‰å¤§æ–¹æ³•ã€7å¤§å‚æ•°ã€4ç§æ‹’ç»ç­–ç•¥</strong></p><blockquote><p>æ± åŒ–æŠ€æœ¯</p></blockquote><p>ç¨‹åºçš„è¿è¡Œï¼Œæœ¬è´¨ï¼šå ç”¨ç³»ç»Ÿçš„èµ„æºï¼æˆ‘ä»¬éœ€è¦å»ä¼˜åŒ–èµ„æºçš„ä½¿ç”¨ &#x3D;&#x3D;&#x3D;&gt; æ± åŒ–æŠ€æœ¯</p><p>çº¿ç¨‹æ± ã€JDBCçš„è¿æ¥æ± ã€å†…å­˜æ± ã€å¯¹è±¡æ±  ç­‰ç­‰ã€‚ã€‚ã€‚ã€‚</p><p>èµ„æºçš„åˆ›å»ºã€é”€æ¯ååˆ†æ¶ˆè€—èµ„æº</p><p><strong>æ± åŒ–æŠ€æœ¯</strong>ï¼šäº‹å…ˆå‡†å¤‡å¥½ä¸€äº›èµ„æºï¼Œå¦‚æœæœ‰äººè¦ç”¨ï¼Œå°±æ¥æˆ‘è¿™é‡Œæ‹¿ï¼Œç”¨å®Œä¹‹åè¿˜ç»™æˆ‘ï¼Œä»¥æ­¤æ¥æé«˜æ•ˆç‡ã€‚</p><p>é»˜è®¤å¤§å°ï¼š3</p><p>maxï¼š</p><blockquote><p>çº¿ç¨‹æ± çš„å¥½å¤„ï¼š</p></blockquote><p>1ã€é™ä½èµ„æºçš„æ¶ˆè€—ï¼›</p><p>2ã€æé«˜å“åº”çš„é€Ÿåº¦ï¼›</p><p>3ã€æ–¹ä¾¿ç®¡ç†ï¼›</p><p><strong>çº¿ç¨‹å¤ç”¨ã€å¯ä»¥æ§åˆ¶æœ€å¤§å¹¶å‘æ•°ã€ç®¡ç†çº¿ç¨‹ï¼›</strong></p><h3 id="ä¸‰å¤§æ–¹æ³•"><a href="#ä¸‰å¤§æ–¹æ³•" class="headerlink" title="ä¸‰å¤§æ–¹æ³•"></a>ä¸‰å¤§æ–¹æ³•</h3><p>é˜¿é‡Œè§„èŒƒï¼š</p><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220302182211176.png" alt="image-20220302182211176"></p><p>ä¸‰å¤§æ–¹æ³•ï¼š</p><ul><li>ExecutorService threadPool &#x3D; Executors.newSingleThreadExecutor();&#x2F;&#x2F;å•ä¸ªçº¿ç¨‹</li><li>ExecutorService threadPool2 &#x3D; Executors.newFixedThreadPool(5); &#x2F;&#x2F;åˆ›å»ºä¸€ä¸ªå›ºå®šçš„çº¿ç¨‹æ± çš„å¤§å°</li><li>ExecutorService threadPool3 &#x3D; Executors.newCachedThreadPool(); &#x2F;&#x2F;å¯ä¼¸ç¼©çš„</li></ul><p>æ¡ˆä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Executors å·¥å…·ç±»ï¼Œ 3å¤§æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//ExecutorService threadPool = Executors.newSingleThreadExecutor();//å•ä¸ªçº¿ç¨‹</span></span><br><span class="line">        <span class="comment">//ExecutorService threadPool = Executors.newFixedThreadPool(5);//åˆ›å»ºä¸€ä¸ªå›ºå®šçš„çº¿ç¨‹æ± å¤§å°</span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span> Executors.newCachedThreadPool();<span class="comment">//å¯ä¼¸ç¼©çš„ï¼Œé‡å¼ºåˆ™å¼ºï¼Œé‡å¼±åˆ™å¼±</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                <span class="comment">// ä½¿ç”¨äº†çº¿ç¨‹æ± ä¹‹åï¼Œä½¿ç”¨çº¿ç¨‹æ± æ¥åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">                threadPool.execute(() -&gt; &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;  OK&quot;</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// çº¿ç¨‹æ± ç”¨å®Œï¼Œç¨‹åºç»“æŸï¼Œå…³é—­çº¿ç¨‹æ± </span></span><br><span class="line">            threadPool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸ƒå¤§å‚æ•°"><a href="#ä¸ƒå¤§å‚æ•°" class="headerlink" title="ä¸ƒå¤§å‚æ•°"></a>ä¸ƒå¤§å‚æ•°</h3><p>ä¸‰è€…æœ¬è´¨ä¸Šéƒ½æ˜¯è°ƒç”¨<code>ThreadPoolExecutor</code></p><p>ä¸‰å¤§æ–¹æ³•æºç åˆ†æï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newSingleThreadExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FinalizableDelegatedExecutorService</span></span><br><span class="line">            (<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                                    <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                    <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newFixedThreadPool</span><span class="params">(<span class="type">int</span> nThreads)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(nThreads, nThreads,</span><br><span class="line">                                      <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                      <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newCachedThreadPool</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">0</span>, Integer.MAX_VALUE, <span class="comment">//21äº¿ </span></span><br><span class="line">                                      <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                                      <span class="keyword">new</span> <span class="title class_">SynchronousQueue</span>&lt;Runnable&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// æœ¬è´¨ThreadPoolExecutorï¼ˆï¼‰</span></span><br><span class="line"> <span class="keyword">public</span> <span class="title function_">ThreadPoolExecutor</span><span class="params">(<span class="type">int</span> corePoolSize, // æ ¸å¿ƒçº¿ç¨‹æ± å¤§å°</span></span><br><span class="line"><span class="params">                              <span class="type">int</span> maximumPoolSize,  // æœ€å¤§æ ¸å¿ƒçº¿ç¨‹æ± å¤§å°</span></span><br><span class="line"><span class="params">                              <span class="type">long</span> keepAliveTime, // è¶…æ—¶äº†æ²¡æœ‰äººè°ƒç”¨å°±ä¼šé‡Šæ”¾</span></span><br><span class="line"><span class="params">                              TimeUnit unit, // è¶…æ—¶å•ä½</span></span><br><span class="line"><span class="params">                              BlockingQueue&lt;Runnable&gt; workQueue,// é˜»å¡é˜Ÿåˆ—</span></span><br><span class="line"><span class="params">                              ThreadFactory threadFactory,// çº¿ç¨‹å·¥å‚ï¼šåˆ›å»ºçº¿ç¨‹çš„ï¼Œä¸€èˆ¬ä¸ç”¨åŠ¨</span></span><br><span class="line"><span class="params">                              RejectedExecutionHandler handler// æ‹’ç»ç­–ç•¥</span></span><br><span class="line"><span class="params">                              )</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (corePoolSize &lt; <span class="number">0</span> ||</span><br><span class="line">            maximumPoolSize &lt;= <span class="number">0</span> ||</span><br><span class="line">            maximumPoolSize &lt; corePoolSize ||</span><br><span class="line">            keepAliveTime &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>();</span><br><span class="line">        <span class="keyword">if</span> (workQueue == <span class="literal">null</span> || threadFactory == <span class="literal">null</span> || handler == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">        <span class="built_in">this</span>.acc = System.getSecurityManager() == <span class="literal">null</span> ?</span><br><span class="line">                <span class="literal">null</span> :</span><br><span class="line">                AccessController.getContext();</span><br><span class="line">        <span class="built_in">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">        <span class="built_in">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">        <span class="built_in">this</span>.workQueue = workQueue;</span><br><span class="line">        <span class="built_in">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">        <span class="built_in">this</span>.threadFactory = threadFactory;</span><br><span class="line">        <span class="built_in">this</span>.handler = handler;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220302184432463.png" alt="image-20220302184432463"></p><blockquote><p>æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * new ThreadPoolExecutor.AbortPolicy() // é“¶è¡Œæ»¡äº†ï¼Œè¿˜æœ‰äººè¿›æ¥ï¼Œä¸å¤„ç†è¿™ä¸ªäººçš„ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="comment"> * new ThreadPoolExecutor.CallerRunsPolicy() // å“ªæ¥çš„å»å“ªé‡Œï¼ mainçº¿ç¨‹</span></span><br><span class="line"><span class="comment"> * new ThreadPoolExecutor.DiscardPolicy() //é˜Ÿåˆ—æ»¡äº†ï¼Œä¸¢æ‰ä»»åŠ¡ï¼Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼</span></span><br><span class="line"><span class="comment"> * new ThreadPoolExecutor.DiscardOldestPolicy() //é˜Ÿåˆ—æ»¡äº†ï¼Œå°è¯•å»å’Œæœ€æ—©çš„ç«äº‰ï¼Œä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼åªä¼šå°è¯•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼å·¥ä½œ ThreadPoolExecutor</span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">                <span class="number">2</span>,<span class="comment">// æ ¸å¿ƒçº¿ç¨‹æ± å¤§å°</span></span><br><span class="line">                <span class="number">5</span>,<span class="comment">// æœ€å¤§æ ¸å¿ƒçº¿ç¨‹æ± å¤§å°</span></span><br><span class="line">                <span class="number">4</span>,<span class="comment">//è¶…æ—¶æ—¶é—´</span></span><br><span class="line">                TimeUnit.SECONDS,<span class="comment">//è¶…æ—¶å•ä½</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="number">3</span>),<span class="comment">//å€™å®¢åŒº</span></span><br><span class="line">                Executors.defaultThreadFactory(),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.DiscardOldestPolicy());<span class="comment">//é“¶è¡Œæ»¡äº†ï¼Œè¿˜æœ‰äººè¿›æ¥ï¼Œä¸å¤„ç†è¿™ä¸ªäººçš„ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//æœ€å¤§æ‰¿è½½ï¼šDeque + max ï¼ˆ5+3ï¼‰</span></span><br><span class="line">            <span class="comment">//è¶…è¿‡ RejectedExecutionException</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">9</span>; i++) &#123;</span><br><span class="line">                <span class="comment">// ä½¿ç”¨äº†çº¿ç¨‹æ± ä¹‹åï¼Œä½¿ç”¨çº¿ç¨‹æ± æ¥åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">                threadPool.execute(() -&gt; &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;  OK&quot;</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// çº¿ç¨‹æ± ç”¨å®Œï¼Œç¨‹åºç»“æŸï¼Œå…³é—­çº¿ç¨‹æ± </span></span><br><span class="line">            threadPool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å››ç§æ‹’ç»ç­–ç•¥"><a href="#å››ç§æ‹’ç»ç­–ç•¥" class="headerlink" title="å››ç§æ‹’ç»ç­–ç•¥"></a>å››ç§æ‹’ç»ç­–ç•¥</h3><ul><li>new ThreadPoolExecutor.AbortPolicy() &#x2F;&#x2F; é“¶è¡Œæ»¡äº†ï¼Œè¿˜æœ‰äººè¿›æ¥ï¼Œä¸å¤„ç†è¿™ä¸ªäººçš„ï¼ŒæŠ›å‡ºå¼‚å¸¸</li><li>new ThreadPoolExecutor.CallerRunsPolicy() &#x2F;&#x2F; å“ªæ¥çš„å»å“ªé‡Œï¼ mainçº¿ç¨‹</li><li>new ThreadPoolExecutor.DiscardPolicy() &#x2F;&#x2F;é˜Ÿåˆ—æ»¡äº†ï¼Œä¸¢æ‰ä»»åŠ¡ï¼Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼</li><li>new ThreadPoolExecutor.DiscardOldestPolicy() &#x2F;&#x2F;é˜Ÿåˆ—æ»¡äº†ï¼Œå°è¯•å»å’Œæœ€æ—©çš„ç«äº‰ï¼Œä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼åªä¼šå°è¯•</li></ul><h3 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h3><p>å¦‚ä½•è®¾ç½®çº¿ç¨‹æ± çš„æœ€å¤§å¤§å°ï¼ˆè°ƒä¼˜ï¼‰</p><p>æœ€å¤§çº¿ç¨‹æ± å¤§å°è¯¥å¦‚ä½•å®šä¹‰ï¼š</p><p><strong>1ã€CPUå¯†é›†å‹ï¼šç”µè„‘çš„æ ¸æ•°æ˜¯å‡ æ ¸å°±é€‰æ‹©å‡ ï¼›é€‰æ‹©maximunPoolSizeçš„å¤§å°</strong></p><p>ä»£ç è·å–CPUæ ¸æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(Runtime.getRuntime().availableProcessors());</span><br></pre></td></tr></table></figure><p><strong>2ã€I&#x2F;Oå¯†é›†å‹ï¼š</strong></p><p>åœ¨ç¨‹åºä¸­æœ‰15ä¸ªå¤§å‹ä»»åŠ¡ï¼Œioååˆ†å ç”¨èµ„æºï¼›</p><p>I&#x2F;Oå¯†é›†å‹å°±æ˜¯åˆ¤æ–­æˆ‘ä»¬ç¨‹åºä¸­ååˆ†è€—I&#x2F;Oçš„çº¿ç¨‹æ•°é‡ï¼Œå¤§çº¦æ˜¯æœ€å¤§I&#x2F;Oæ•°çš„ä¸€å€åˆ°ä¸¤å€ä¹‹é—´ã€‚</p><h2 id="å››å¤§å‡½æ•°å¼æ¥å£ï¼ˆå¿…é¡»æŒæ¡ï¼‰"><a href="#å››å¤§å‡½æ•°å¼æ¥å£ï¼ˆå¿…é¡»æŒæ¡ï¼‰" class="headerlink" title="å››å¤§å‡½æ•°å¼æ¥å£ï¼ˆå¿…é¡»æŒæ¡ï¼‰"></a>å››å¤§å‡½æ•°å¼æ¥å£ï¼ˆå¿…é¡»æŒæ¡ï¼‰</h2><p>æ–°æ—¶ä»£çš„ç¨‹åºå‘˜ï¼š<strong>lambdaè¡¨è¾¾å¼ã€é“¾å¼ç¼–ç¨‹ã€å‡½æ•°å¼æ¥å£ã€Streamæµå¼è®¡ç®—</strong></p><blockquote><p>å‡½æ•°å¼æ¥å£ï¼šåªæœ‰ä¸€ä¸ªæ–¹æ³•çš„æ¥å£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼ ç»ŸæŠ€æœ¯å¿…ä¼šï¼šæ³›å‹ã€æšä¸¾ã€åå°„</span></span><br><span class="line"><span class="comment">// æ–°æŠ€æœ¯å¿…ä¼šï¼šlambdaè¡¨è¾¾å¼ã€é“¾å¼ç¼–ç¨‹ã€å‡½æ•°å¼æ¥å£ã€Streamæµå¼è®¡ç®—</span></span><br><span class="line"><span class="comment">// è¶…çº§å¤šFunctionalInterface</span></span><br><span class="line"><span class="comment">// ç®€åŒ–ç¼–ç¨‹æ¨¡å‹ï¼Œåœ¨æ–°ç‰ˆæœ¬çš„æ¡†æ¶åº•å±‚å¤§é‡åº”ç”¨ï¼</span></span><br><span class="line"><span class="comment">// foreach(æ¶ˆè´¹è€…ç±»çš„å‡½æ•°å¼æ¥å£)</span></span><br></pre></td></tr></table></figure><p>å››å¤§å‡½æ•°å¼æ¥å£ï¼šFunctionã€Predicateã€Suppierã€Consummer</p><table><thead><tr><th align="center"></th><th align="center">å‚æ•°</th><th align="center">è¿”å›å€¼</th></tr></thead><tbody><tr><td align="center">Function</td><td align="center">æœ‰</td><td align="center">æœ‰</td></tr><tr><td align="center">Predicate</td><td align="center">æœ‰</td><td align="center">Boolean</td></tr><tr><td align="center">Suppier</td><td align="center">æ— </td><td align="center">æ— </td></tr><tr><td align="center">Consummer</td><td align="center">æœ‰</td><td align="center">æ— </td></tr></tbody></table><h3 id="Function-å‡½æ•°å‹æ¥å£"><a href="#Function-å‡½æ•°å‹æ¥å£" class="headerlink" title="Function å‡½æ•°å‹æ¥å£"></a>Function å‡½æ•°å‹æ¥å£</h3><p>ä¼ å…¥å‚æ•°Tï¼Œè¿”å›å‚æ•°R</p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220302195255643.png" alt="image-20220302195255643" style="zoom:80%;" /><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Function å‡½æ•°å‹æ¥å£, æœ‰ä¸€ä¸ªè¾“å…¥å‚æ•°ï¼Œæœ‰ä¸€ä¸ªè¾“å‡º,</span></span><br><span class="line"><span class="comment"> * åªè¦æ˜¯å‡½æ•°å‹æ¥å£ï¼Œå°±å¯ä»¥ç”¨ lambdaè¡¨è¾¾å¼ç®€åŒ–</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//å·¥å…·ç±»ï¼šè¾“å‡ºè¾“å…¥çš„å€¼</span></span><br><span class="line">        <span class="type">Function</span> <span class="variable">function</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Function</span>&lt;String, String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> String <span class="title function_">apply</span><span class="params">(String str)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> str;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åªè¦æ˜¯å‡½æ•°å‹æ¥å£ï¼Œå°±å¯ä»¥ç”¨ lambdaè¡¨è¾¾å¼ç®€åŒ–</span></span><br><span class="line">        <span class="type">Function</span> <span class="variable">function1</span> <span class="operator">=</span> (str) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> str;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        System.out.println(function1.apply(<span class="string">&quot;123&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Predicate-æ–­å®šå‹æ¥å£"><a href="#Predicate-æ–­å®šå‹æ¥å£" class="headerlink" title="Predicate æ–­å®šå‹æ¥å£"></a>Predicate æ–­å®šå‹æ¥å£</h3><p>ä¼ å…¥å‚æ•°Tï¼Œè¿”å›Booleanå€¼</p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220302200456825.png" alt="image-20220302200456825" style="zoom:80%;" /><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–­å®šå‹æ¥å£ï¼šæœ‰ä¸€ä¸ªè¾“å…¥å‚æ•°ï¼Œè¿”å›å€¼åªèƒ½æ˜¯ å¸ƒå°”å€¼ï¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo02</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">        Predicate&lt;String&gt; predicate = <span class="keyword">new</span> <span class="title class_">Predicate</span>&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(String str)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> str.isEmpty();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//åªè¦æ˜¯å‡½æ•°å‹æ¥å£ï¼Œå°±å¯ä»¥ç”¨ lambdaè¡¨è¾¾å¼ç®€åŒ–</span></span><br><span class="line">        Predicate&lt;String&gt; predicate2 = (str) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> str.isEmpty();</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        System.out.println(predicate.test(<span class="string">&quot;asddd&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Suppier-ä¾›ç»™å‹æ¥å£"><a href="#Suppier-ä¾›ç»™å‹æ¥å£" class="headerlink" title="Suppier ä¾›ç»™å‹æ¥å£"></a>Suppier ä¾›ç»™å‹æ¥å£</h3><p>æ²¡æœ‰å‚æ•°ï¼Œåªæœ‰è¿”å›å€¼</p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220302202754892.png" alt="image-20220302202754892" style="zoom:80%;" /><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Supplier ä¾›ç»™å‹æ¥å£ æ²¡æœ‰å‚æ•°ï¼Œåªæœ‰è¿”å›å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo04</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Supplier</span> <span class="variable">supplier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Supplier</span>&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Integer <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1024</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åªè¦æ˜¯å‡½æ•°å‹æ¥å£ï¼Œå°±å¯ä»¥ç”¨ lambdaè¡¨è¾¾å¼ç®€åŒ–</span></span><br><span class="line">        <span class="type">Supplier</span> <span class="variable">supplier2</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1024</span>;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        System.out.println(supplier2.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Consummer-æ¶ˆè´¹å‹æ¥å£"><a href="#Consummer-æ¶ˆè´¹å‹æ¥å£" class="headerlink" title="Consummer æ¶ˆè´¹å‹æ¥å£"></a>Consummer æ¶ˆè´¹å‹æ¥å£</h3><p>åªæœ‰å‚æ•°ï¼Œæ²¡æœ‰è¿”å›å€¼</p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220302202454092.png" alt="image-20220302202454092" style="zoom:80%;" /><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Consumer æ¶ˆè´¹å‹æ¥å£: åªæœ‰è¾“å…¥ï¼Œæ²¡æœ‰è¿”å›å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo03</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Consumer&lt;String&gt; consumer = <span class="keyword">new</span> <span class="title class_">Consumer</span>&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(String str)</span> &#123;</span><br><span class="line">                System.out.println(str);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//åªè¦æ˜¯å‡½æ•°å‹æ¥å£ï¼Œå°±å¯ä»¥ç”¨ lambdaè¡¨è¾¾å¼ç®€åŒ–</span></span><br><span class="line">        Consumer&lt;String&gt; consumer1 = (str) -&gt; &#123;</span><br><span class="line">            System.out.println(str);</span><br><span class="line">        &#125;;</span><br><span class="line">        consumer.accept(<span class="string">&quot;qwre&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Streamæµå¼è®¡ç®—"><a href="#Streamæµå¼è®¡ç®—" class="headerlink" title="Streamæµå¼è®¡ç®—"></a>Streamæµå¼è®¡ç®—</h2><blockquote><p>ä»€ä¹ˆæ˜¯Streamæµå¼è®¡ç®—</p></blockquote><p>å¤§æ•°æ®ï¼šå­˜å‚¨ + è®¡ç®—</p><p>é›†åˆã€MySQL æœ¬è´¨å°±æ˜¯<strong>å­˜å‚¨</strong>ä¸œè¥¿çš„ï¼›</p><p>è®¡ç®—éƒ½åº”è¯¥äº¤ç»™<strong>æµ</strong>æ¥æ“ä½œï¼</p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220303103917648.png" alt="image-20220303103917648" style="zoom:80%;" /><blockquote><p>æ¡ˆä¾‹</p></blockquote><p>Userç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Test</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é¢˜ç›®è¦æ±‚ï¼šä¸€åˆ†é’Ÿå†…å®Œæˆæ­¤é¢˜ï¼Œåªèƒ½ç”¨ä¸€è¡Œä»£ç å®ç°ï¼</span></span><br><span class="line"><span class="comment"> * ç°åœ¨æœ‰5ä¸ªç”¨æˆ·ï¼ç­›é€‰ï¼š</span></span><br><span class="line"><span class="comment"> * 1ã€ID å¿…é¡»æ˜¯å¶æ•°</span></span><br><span class="line"><span class="comment"> * 2ã€å¹´é¾„å¿…é¡»å¤§äº23å²</span></span><br><span class="line"><span class="comment"> * 3ã€ç”¨æˆ·åè½¬ä¸ºå¤§å†™å­—æ¯</span></span><br><span class="line"><span class="comment"> * 4ã€ç”¨æˆ·åå­—æ¯å€’ç€æ’åº</span></span><br><span class="line"><span class="comment"> * 5ã€åªè¾“å‡ºä¸€ä¸ªç”¨æˆ·ï¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">u1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1</span>, <span class="string">&quot;a&quot;</span>, <span class="number">21</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">u2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">2</span>, <span class="string">&quot;b&quot;</span>, <span class="number">22</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">u3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">3</span>, <span class="string">&quot;c&quot;</span>, <span class="number">23</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">u4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">4</span>, <span class="string">&quot;d&quot;</span>, <span class="number">24</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">u5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">6</span>, <span class="string">&quot;e&quot;</span>, <span class="number">25</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é›†åˆæ˜¯å­˜å‚¨</span></span><br><span class="line">        List&lt;User&gt; list = Arrays.asList(u1, u2, u3, u4, u5);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¡ç®—äº¤ç»™Streamæµ</span></span><br><span class="line">        <span class="comment">// list.stream();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// lambdaè¡¨è¾¾å¼ã€é“¾å¼ç¼–ç¨‹ã€å‡½æ•°å¼æ¥å£ã€Streamæµå¼è®¡ç®—</span></span><br><span class="line">        list.stream()</span><br><span class="line">                .filter(u -&gt; &#123;</span><br><span class="line">                    <span class="keyword">return</span> u.getId() % <span class="number">2</span> == <span class="number">0</span>;</span><br><span class="line">                &#125;)</span><br><span class="line">                .filter(u -&gt; &#123;</span><br><span class="line">                    <span class="keyword">return</span> u.getAge() &gt; <span class="number">23</span>;</span><br><span class="line">                &#125;)</span><br><span class="line">                .map(u -&gt; &#123;</span><br><span class="line">                    <span class="keyword">return</span> u.getName().toUpperCase();</span><br><span class="line">                &#125;)</span><br><span class="line">                .sorted((uu1, uu2) -&gt; &#123;</span><br><span class="line">                    <span class="keyword">return</span> uu2.compareTo(uu1);</span><br><span class="line">                &#125;)</span><br><span class="line">                .limit(<span class="number">1</span>)</span><br><span class="line">                .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ForkJoin"><a href="#ForkJoin" class="headerlink" title="ForkJoin"></a>ForkJoin</h2><p>ä¸­æ–‡ï¼šåˆ†æ”¯åˆå¹¶</p><p>ForkJoin åœ¨JDK1.7ï¼Œå¹¶è¡Œæ‰§è¡Œä»»åŠ¡ï¼æé«˜æ•ˆç‡ã€‚åœ¨<strong>å¤§æ•°æ®é‡</strong>é€Ÿç‡ä¼šæ›´å¿«ï¼</p><p>å¤§æ•°æ®ä¸­ï¼š<strong>MapReduce æ ¸å¿ƒæ€æƒ³-&gt;æŠŠå¤§ä»»åŠ¡æ‹†åˆ†ä¸ºå°ä»»åŠ¡ï¼</strong></p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220303104222621.png" alt="image-20220303104222621" style="zoom:80%;" /><blockquote><p>ForkJoin ç‰¹ç‚¹ï¼š å·¥ä½œçªƒå–ï¼</p></blockquote><p>å®ç°åŸç†æ˜¯ï¼š<strong>åŒç«¯é˜Ÿåˆ—</strong>ï¼ä»ä¸Šé¢å’Œä¸‹é¢éƒ½å¯ä»¥å»æ‹¿åˆ°ä»»åŠ¡è¿›è¡Œæ‰§è¡Œï¼</p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220303104443027.png" alt="image-20220303104443027" style="zoom:80%;" /><blockquote><p>ForkJoinä½¿ç”¨</p></blockquote><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220303110004768.png" alt="image-20220303110004768" style="zoom:80%;" /><ul><li><p>é€šè¿‡<strong>ForkJoinPool</strong>æ¥æ‰§è¡Œ</p></li><li><p>è®¡ç®—ä»»åŠ¡ <strong>execute(ForkJoinTask&lt;?&gt; task)</strong></p></li><li><p>è®¡ç®—ç±»è¦å»ç»§æ‰¿ForkJoinTaskï¼›</p><p><strong>ForkJoin çš„è®¡ç®—ç±»</strong></p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ±‚å’Œè®¡ç®—çš„ä»»åŠ¡</span></span><br><span class="line"><span class="comment"> * 3000 6000(ForkJoin) 9000(Streamå¹¶è¡Œæµ)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ForkJoinDemo</span> <span class="keyword">extends</span> <span class="title class_">RecursiveTask</span>&lt;Long&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> start;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> end;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** ä¸´ç•Œå€¼ */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="number">1000000L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ForkJoinDemo</span><span class="params">(<span class="type">long</span> start, <span class="type">long</span> end)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.start = start;</span><br><span class="line">        <span class="built_in">this</span>.end = end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¡ç®—æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Long <span class="title function_">compute</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ((end - start) &lt; temp) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0L</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; end; i++) &#123;</span><br><span class="line">                sum += i;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sum;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// ä½¿ç”¨ForkJoin åˆ†è€Œæ²»ä¹‹ è®¡ç®—</span></span><br><span class="line">            <span class="comment">//1 . è®¡ç®—å¹³å‡å€¼</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">middle</span> <span class="operator">=</span> (start + end) / <span class="number">2</span>;</span><br><span class="line">            <span class="type">ForkJoinDemo</span> <span class="variable">task1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ForkJoinDemo</span>(start, middle);</span><br><span class="line">            task1.fork();<span class="comment">// æ‹†åˆ†ä»»åŠ¡ï¼ŒæŠŠçº¿ç¨‹å‹å…¥çº¿ç¨‹é˜Ÿåˆ—</span></span><br><span class="line">            <span class="type">ForkJoinDemo</span> <span class="variable">task2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ForkJoinDemo</span>(middle, end);</span><br><span class="line">            task2.fork();</span><br><span class="line"></span><br><span class="line">            <span class="type">long</span> <span class="variable">taskSum</span> <span class="operator">=</span> task1.join() + task2.join();</span><br><span class="line">            <span class="keyword">return</span> taskSum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ForkJoinTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">SUM</span> <span class="operator">=</span> <span class="number">20_0000_0000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        test1();</span><br><span class="line">        test2();</span><br><span class="line">        test3();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨æ™®é€šæ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">star</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0L</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; SUM ; i++) &#123;</span><br><span class="line">            sum += i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(sum);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ—¶é—´ï¼š&quot;</span> + (end - star));</span><br><span class="line">        System.out.println(<span class="string">&quot;----------------------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨ForkJoin æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">star</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="type">ForkJoinPool</span> <span class="variable">forkJoinPool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ForkJoinPool</span>();</span><br><span class="line">        ForkJoinTask&lt;Long&gt; task = <span class="keyword">new</span> <span class="title class_">ForkJoinDemo</span>(<span class="number">0L</span>, SUM);</span><br><span class="line">        ForkJoinTask&lt;Long&gt; submit = forkJoinPool.submit(task); <span class="comment">//æäº¤ä»»åŠ¡</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">along</span> <span class="operator">=</span> submit.get();</span><br><span class="line"></span><br><span class="line">        System.out.println(along);</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;æ—¶é—´ï¼š&quot;</span> + (end - star));</span><br><span class="line">        System.out.println(<span class="string">&quot;-----------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨ Stream æµè®¡ç®—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">star</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> LongStream.range(<span class="number">0L</span>, <span class="number">20_0000_0000L</span>).parallel().reduce(<span class="number">0</span>, Long::sum);</span><br><span class="line">        System.out.println(sum);</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;æ—¶é—´ï¼š&quot;</span> + (end - star));</span><br><span class="line">        System.out.println(<span class="string">&quot;-----------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220303112617896.png" alt="image-20220303112617896" style="zoom:80%;" /><blockquote><p>æ³¨æ„</p></blockquote><p>longå’ŒLongçš„åŒºåˆ«ï¼š</p><ul><li><p>longï¼šåŸºæœ¬æ•°æ®ç±»å‹ï¼Œä¸intï¼Œfloatç±»ä¼¼</p></li><li><p>Longï¼šå¯¹è±¡ï¼Œä¸Integerç±»ä¼¼</p></li><li><p>longæ¯”Longè¿ç®—é€Ÿåº¦å¿«çš„å¤šï¼ï¼ï¼</p></li></ul><p>æ‰©å……ï¼šjavaå…«å¤§åŸºæœ¬æ•°æ®ç±»å‹åŠå…¶å°è£…ç±»</p><table><thead><tr><th>ç®€å•ç±»å‹</th><th>boolean</th><th>byte</th><th>char</th><th>short</th><th>Int</th><th>long</th><th>float</th><th>double</th><th>void</th></tr></thead><tbody><tr><td>äºŒè¿›åˆ¶ä½æ•°</td><td>1</td><td>8</td><td>16</td><td>16</td><td>32</td><td>64</td><td>32</td><td>64</td><td>â€“</td></tr><tr><td>å°è£…å™¨ç±»</td><td>Boolean</td><td>Byte</td><td>Character</td><td>Short</td><td>Integer</td><td>Long</td><td>Float</td><td>Double</td><td>Void</td></tr></tbody></table><p>JavaåŸºæœ¬ç±»å‹å­˜å‚¨åœ¨æ ˆä¸­ï¼Œå› æ­¤å®ƒä»¬çš„å­˜å–é€Ÿåº¦è¦å¿«äºå­˜å‚¨åœ¨å †ä¸­çš„å¯¹åº”åŒ…è£…ç±»çš„å®ä¾‹å¯¹è±¡ã€‚</p><p>åŸºæœ¬ç±»å‹çš„ä¼˜åŠ¿ï¼šæ•°æ®å­˜å‚¨ç›¸å¯¹ç®€å•ï¼Œ<strong>è¿ç®—æ•ˆç‡æ¯”è¾ƒé«˜</strong></p><p>åŒ…è£…ç±»çš„ä¼˜åŠ¿ï¼šæœ‰çš„å®¹æ˜“ï¼Œæ¯”å¦‚é›†åˆçš„å…ƒç´ å¿…é¡»æ˜¯å¯¹è±¡ç±»å‹ï¼Œæ»¡è¶³äº†javaä¸€åˆ‡çš†æ˜¯å¯¹è±¡çš„æ€æƒ³</p><h2 id="å¼‚æ­¥å›è°ƒ"><a href="#å¼‚æ­¥å›è°ƒ" class="headerlink" title="å¼‚æ­¥å›è°ƒ"></a>å¼‚æ­¥å›è°ƒ</h2><blockquote><p>Future è®¾è®¡çš„åˆè¡·ï¼š å¯¹å°†æ¥çš„æŸä¸ªäº‹ä»¶çš„ç»“æœè¿›è¡Œå»ºæ¨¡</p></blockquote><p>å…¶å®å°±æ˜¯å‰ç«¯ â€“&gt; å‘é€ajaxå¼‚æ­¥è¯·æ±‚ç»™åç«¯</p><p>ä½†æ˜¯æˆ‘ä»¬å¹³æ—¶éƒ½ä½¿ç”¨<strong>CompletableFuture</strong></p><blockquote><p>æ²¡æœ‰è¿”å›å€¼çš„runAsyncå¼‚æ­¥å›è°ƒ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¼‚æ­¥è°ƒç”¨ï¼š CompletableFuture</span></span><br><span class="line"><span class="comment"> * // å¼‚æ­¥æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"> * // æˆåŠŸå›è°ƒ</span></span><br><span class="line"><span class="comment"> * // å¤±è´¥å›è°ƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// å‘èµ·ä¸€ä¸ªè¯·æ±‚ void</span></span><br><span class="line">        <span class="comment">// æ²¡æœ‰è¿”å›å€¼çš„ runAsync å¼‚æ­¥å›è°ƒ</span></span><br><span class="line">        CompletableFuture&lt;Void&gt; completableFuture = CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;runAsync=&gt;void&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;11111111&quot;</span>);</span><br><span class="line">        completableFuture.get();<span class="comment">//è·å–æ‰§è¡Œç»“æœ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æœ‰è¿”å›å€¼çš„å¼‚æ­¥å›è°ƒsupplyAsync</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// æœ‰è¿”å›å€¼çš„ runAsync å¼‚æ­¥å›è°ƒ</span></span><br><span class="line">        <span class="comment">// æˆåŠŸè¿”å›ï¼Œå¤±è´¥è¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">        CompletableFuture&lt;Integer&gt; completableFuture = CompletableFuture.supplyAsync(()-&gt;&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;supplyAsync=&gt;Integer&quot;</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>/<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1024</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(completableFuture.whenComplete((t, u) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;t=&gt;&quot;</span> + t); <span class="comment">//æ­£å¸¸çš„è¿”å›ç»“æœ</span></span><br><span class="line">            System.out.println(<span class="string">&quot;u=&gt;&quot;</span> + u); <span class="comment">//é”™è¯¯ä¿¡æ¯  java.util.concurrent.CompletionException</span></span><br><span class="line">        &#125;).exceptionally((e) -&gt; &#123;</span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="number">233</span>; <span class="comment">//å¯ä»¥è·å–åˆ°é”™è¯¯çš„è¿”å›ç»“æœ</span></span><br><span class="line">        &#125;).get());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>whenComplete</strong>: æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯t ä¸€ä¸ªæ˜¯u</p><p>Tï¼šæ˜¯ä»£è¡¨çš„ <strong>æ­£å¸¸è¿”å›çš„ç»“æœ</strong>ï¼›</p><p>Uï¼šæ˜¯ä»£è¡¨çš„ <strong>æŠ›å‡ºå¼‚å¸¸çš„é”™è¯¯ä¿¡æ¯</strong>ï¼›</p><p>å¦‚æœå‘ç”Ÿäº†å¼‚å¸¸ï¼Œgetå¯ä»¥è·å–åˆ°<strong>exceptionally</strong>è¿”å›çš„å€¼ï¼›</p><blockquote><p>ç†è§£</p></blockquote><p>å¼‚æ­¥å›è°ƒï¼šå¼€å¯å¦å¤–ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼Œä¸»çº¿ç¨‹å¯è·å¾—å¦å¤–ä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œç»“æœï¼ˆä¸å¤šçº¿ç¨‹çš„ä¸åŒï¼‰</p><p>Mqtt (åº”ç”¨)ï¼šMqttCallbackå›è°ƒå‡½æ•°</p><h2 id="JMM"><a href="#JMM" class="headerlink" title="JMM"></a>JMM</h2><blockquote><p>å¯¹Volatile çš„ç†è§£</p></blockquote><p><strong>Volatile</strong> æ˜¯ Java è™šæ‹Ÿæœºæä¾› <strong>è½»é‡çº§çš„åŒæ­¥æœºåˆ¶</strong></p><p>1ã€ä¿è¯å¯è§æ€§</p><p><strong>2ã€ä¸ä¿è¯åŸå­æ€§</strong></p><p>3ã€ç¦æ­¢æŒ‡ä»¤é‡æ’</p><blockquote><p>ä»€ä¹ˆæ˜¯JMMï¼Ÿ</p></blockquote><p><strong>JMMï¼šJAVAå†…å­˜æ¨¡å‹</strong>ï¼Œä¸å­˜åœ¨çš„ä¸œè¥¿ï¼Œæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œä¹Ÿæ˜¯ä¸€ä¸ªçº¦å®šï¼</p><p><strong>å…³äºJMMçš„ä¸€äº›åŒæ­¥çš„çº¦å®šï¼š</strong></p><p>1ã€çº¿ç¨‹è§£é”å‰ï¼Œå¿…é¡»æŠŠå…±äº«å˜é‡<strong>ç«‹åˆ»</strong>åˆ·å›ä¸»å­˜ï¼›</p><p>2ã€çº¿ç¨‹åŠ é”å‰ï¼Œå¿…é¡»<strong>è¯»å–ä¸»å­˜</strong>ä¸­çš„æœ€æ–°å€¼åˆ°å·¥ä½œå†…å­˜ä¸­ï¼›</p><p>3ã€åŠ é”å’Œè§£é”æ˜¯åŒä¸€æŠŠé”ï¼›</p><p><strong>å†…å­˜äº¤äº’æ“ä½œæœ‰8ç§:</strong></p><ul><li><p><strong>Readï¼ˆè¯»å–ï¼‰</strong>ï¼šä½œç”¨äºä¸»å†…å­˜å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„loadåŠ¨ä½œä½¿ç”¨ï¼›</p></li><li><p><strong>loadï¼ˆè½½å…¥ï¼‰</strong>ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠreadæ“ä½œä»ä¸»å­˜ä¸­å˜é‡æ”¾å…¥å·¥ä½œå†…å­˜ä¸­ï¼›</p></li><li><p><strong>Useï¼ˆä½¿ç”¨ï¼‰</strong>ï¼šä½œç”¨äºå·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­çš„å˜é‡ä¼ è¾“ç»™æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªéœ€è¦ä½¿ç”¨åˆ°å˜é‡çš„å€¼ï¼Œå°±ä¼šä½¿ç”¨åˆ°è¿™ä¸ªæŒ‡ä»¤ï¼›</p></li><li><p><strong>assignï¼ˆèµ‹å€¼ï¼‰</strong>ï¼šä½œç”¨äºå·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“ä¸­æ¥å—åˆ°çš„å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­ï¼›</p></li><li><p><strong>storeï¼ˆå­˜å‚¨ï¼‰</strong>ï¼šä½œç”¨äºä¸»å†…å­˜ä¸­çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªä»å·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­ï¼Œä»¥ä¾¿åç»­çš„writeä½¿ç”¨ï¼›</p></li><li><p><strong>writeï¼ˆå†™å…¥ï¼‰</strong>ï¼šä½œç”¨äºä¸»å†…å­˜ä¸­çš„å˜é‡ï¼Œå®ƒæŠŠstoreæ“ä½œä»å·¥ä½œå†…å­˜ä¸­å¾—åˆ°çš„å˜é‡çš„å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­ï¼›</p></li><li><p><strong>lockï¼ˆé”å®šï¼‰</strong>ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼ŒæŠŠä¸€ä¸ªå˜é‡æ ‡è¯†ä¸ºçº¿ç¨‹ç‹¬å çŠ¶æ€ï¼›</p></li><li><p><strong>unlockï¼ˆè§£é”ï¼‰</strong>ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åçš„å˜é‡æ‰å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹é”å®šï¼›</p><p>æ³¨æ„ï¼šä¸‹é¢è¿™å¹…å›¾ä¸­writeå’Œstoreçš„é¡ºåºåäº†ï¼Œåº”è¯¥å…ˆstoreå†write</p></li></ul><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220303151127453.png" alt="image-20220303151127453" style="zoom: 67%;" /><p><strong>JMMå¯¹è¿™å…«ç§æŒ‡ä»¤çš„ä½¿ç”¨ï¼Œåˆ¶å®šäº†å¦‚ä¸‹è§„åˆ™ï¼š</strong></p><ul><li>ä¸å…è®¸readå’Œloadã€storeå’Œwriteæ“ä½œä¹‹ä¸€å•ç‹¬å‡ºç°ï¼Œå¿…é¡»æˆå¯¹ä½¿ç”¨ã€‚å³ä½¿ç”¨äº†readå¿…é¡»loadï¼Œä½¿ç”¨äº†storeå¿…é¡»write</li><li>ä¸å…è®¸çº¿ç¨‹ä¸¢å¼ƒä»–æœ€è¿‘çš„assignæ“ä½œï¼Œå³å·¥ä½œå˜é‡çš„æ•°æ®æ”¹å˜äº†ä¹‹åï¼Œå¿…é¡»å‘ŠçŸ¥ä¸»å­˜</li><li>ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹å°†æ²¡æœ‰assignçš„æ•°æ®ä»å·¥ä½œå†…å­˜åŒæ­¥å›ä¸»å†…å­˜<br>ä¸€ä¸ªæ–°çš„å˜é‡å¿…é¡»åœ¨ä¸»å†…å­˜ä¸­è¯ç”Ÿï¼Œä¸å…è®¸å·¥ä½œå†…å­˜ç›´æ¥ä½¿ç”¨ä¸€ä¸ªæœªè¢«åˆå§‹åŒ–çš„å˜é‡ã€‚å°±æ˜¯æ€¼å˜é‡å®æ–½useã€storeæ“ä½œä¹‹å‰ï¼Œå¿…é¡»ç»è¿‡assignå’Œloadæ“ä½œ</li><li>ä¸€ä¸ªå˜é‡åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¯¹å…¶è¿›è¡Œlockã€‚å¤šæ¬¡lockåï¼Œå¿…é¡»æ‰§è¡Œç›¸åŒæ¬¡æ•°çš„unlockæ‰èƒ½è§£é”</li><li>å¦‚æœå¯¹ä¸€ä¸ªå˜é‡è¿›è¡Œlockæ“ä½œï¼Œä¼šæ¸…ç©ºæ‰€æœ‰å·¥ä½œå†…å­˜ä¸­æ­¤å˜é‡çš„å€¼ï¼Œåœ¨æ‰§è¡Œå¼•æ“ä½¿ç”¨è¿™ä¸ªå˜é‡å‰ï¼Œå¿…é¡»é‡æ–°loadæˆ–assignæ“ä½œåˆå§‹åŒ–å˜é‡çš„å€¼</li><li>å¦‚æœä¸€ä¸ªå˜é‡æ²¡æœ‰è¢«lockï¼Œå°±ä¸èƒ½å¯¹å…¶è¿›è¡Œunlockæ“ä½œã€‚ä¹Ÿä¸èƒ½unlockä¸€ä¸ªè¢«å…¶ä»–çº¿ç¨‹é”ä½çš„å˜é‡å¯¹ä¸€ä¸ªå˜é‡è¿›è¡Œunlockæ“ä½œä¹‹å‰ï¼Œå¿…é¡»æŠŠæ­¤å˜é‡åŒæ­¥å›ä¸»å†…å­˜<br>é—®é¢˜ï¼š ç¨‹åºä¸çŸ¥é“ä¸»å†…å­˜çš„å€¼å·²ç»è¢«ä¿®æ”¹è¿‡äº†</li></ul><blockquote><p>æ¡ˆä¾‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JMMDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; <span class="comment">//main</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123; <span class="comment">//çº¿ç¨‹1 å¯¹ä¸»å†…å­˜çš„å˜åŒ–ä¸çŸ¥é“çš„</span></span><br><span class="line">           <span class="keyword">while</span> (num == <span class="number">0</span> )&#123;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        num = <span class="number">1</span>;</span><br><span class="line">        System.out.println(num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">ç»“æœï¼šç¨‹åºæœªæš‚åœï¼Œçº¿ç¨‹ä¸­numä¸€ç›´ä¸º0</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220303152230060.png" alt="image-20220303152230060"></p><h2 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h2><p><strong>Volatile</strong> æ˜¯ Java è™šæ‹Ÿæœºæä¾› <strong>è½»é‡çº§çš„åŒæ­¥æœºåˆ¶</strong></p><p>1ã€ä¿è¯å¯è§æ€§</p><p><strong>2ã€ä¸ä¿è¯åŸå­æ€§</strong></p><p>3ã€ç¦æ­¢æŒ‡ä»¤é‡æ’</p><h3 id="ä¿è¯å¯è§æ€§"><a href="#ä¿è¯å¯è§æ€§" class="headerlink" title="ä¿è¯å¯è§æ€§"></a>ä¿è¯å¯è§æ€§</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JMMDemo</span> &#123;</span><br><span class="line">    <span class="comment">// ä¸åŠ  volatile ç¨‹åºå°±ä¼šæ­»å¾ªç¯ï¼</span></span><br><span class="line">    <span class="comment">// åŠ  volatile å¯ä»¥ä¿è¯å¯è§æ€§</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; <span class="comment">//main</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123; <span class="comment">//çº¿ç¨‹1 å¯¹ä¸»å†…å­˜çš„å˜åŒ–ä¸çŸ¥é“çš„</span></span><br><span class="line">           <span class="keyword">while</span> (num == <span class="number">0</span> )&#123;</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        num = <span class="number">1</span>;</span><br><span class="line">        System.out.println(num);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸ä¿è¯åŸå­æ€§"><a href="#ä¸ä¿è¯åŸå­æ€§" class="headerlink" title="ä¸ä¿è¯åŸå­æ€§"></a>ä¸ä¿è¯åŸå­æ€§</h3><p>åŸå­æ€§ï¼šä¸å¯åˆ†å‰²ï¼›</p><p>çº¿ç¨‹Aåœ¨æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ï¼Œä¸èƒ½è¢«æ‰“æ‰°çš„ï¼Œä¹Ÿä¸èƒ½è¢«åˆ†å‰²çš„ï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸ä¿è¯åŸå­æ€§</span></span><br><span class="line"><span class="comment"> * number &lt;=2w</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VDemo02</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span>&#123;</span><br><span class="line">        number++;</span><br><span class="line">        <span class="comment">//++ ä¸æ˜¯ä¸€ä¸ªåŸå­æ€§æ“ä½œï¼Œæ˜¯ä¸¤ä¸ª~3ä¸ªæ“ä½œ</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//ç†è®ºä¸Šnumber  === 20000</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= <span class="number">1000</span> ; j++) &#123;</span><br><span class="line">                    add();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (Thread.activeCount() &gt; <span class="number">2</span>)&#123; <span class="comment">//main gc</span></span><br><span class="line">            <span class="comment">//main  gc</span></span><br><span class="line">            Thread.yield();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;,num=&quot;</span>+number);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220303160951120.png" alt="image-20220303160951120"></p><p><strong>å¦‚æœä¸åŠ lockå’Œsynchronized ï¼Œæ€ä¹ˆæ ·ä¿è¯åŸå­æ€§ï¼Ÿ</strong></p><blockquote><p><strong>ä½¿ç”¨åŸå­ç±»ï¼Œè§£å†³åŸå­æ€§é—®é¢˜</strong>ï¼Œæ¯”é”é«˜æ•ˆå¾ˆå¤šå€ï¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VDemo02</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">AtomicInteger</span> <span class="variable">number</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span>&#123;</span><br><span class="line">        number.getAndIncrement(); <span class="comment">// AtomicInteger +1 æ–¹æ³• ï¼ŒCAS</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//ç†è®ºä¸Šnumber  === 20000</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= <span class="number">1000</span> ; j++) &#123;</span><br><span class="line">                    add();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (Thread.activeCount() &gt; <span class="number">2</span>)&#123; <span class="comment">//main gc</span></span><br><span class="line">            Thread.yield();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;,num=&quot;</span>+number);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™äº›ç±»çš„åº•å±‚éƒ½ç›´æ¥å’Œæ“ä½œç³»ç»ŸæŒ‚é’©ï¼æ˜¯åœ¨å†…å­˜ä¸­ä¿®æ”¹å€¼ã€‚</p><p>Unsafeç±»æ˜¯ä¸€ä¸ªå¾ˆç‰¹æ®Šçš„å­˜åœ¨ï¼›</p><h3 id="ç¦æ­¢æŒ‡ä»¤é‡æ’"><a href="#ç¦æ­¢æŒ‡ä»¤é‡æ’" class="headerlink" title="ç¦æ­¢æŒ‡ä»¤é‡æ’"></a>ç¦æ­¢æŒ‡ä»¤é‡æ’</h3><blockquote><p><strong>ä»€ä¹ˆæ˜¯æŒ‡ä»¤é‡æ’ï¼Ÿ</strong></p></blockquote><p>æˆ‘ä»¬å†™çš„ç¨‹åºï¼Œè®¡ç®—æœºå¹¶ä¸æ˜¯æŒ‰ç…§æˆ‘ä»¬è‡ªå·±å†™çš„é‚£æ ·å»æ‰§è¡Œçš„</p><p>æºä»£ç â€“&gt;ç¼–è¯‘å™¨ä¼˜åŒ–é‡æ’â€“&gt;æŒ‡ä»¤å¹¶è¡Œä¹Ÿå¯èƒ½ä¼šé‡æ’â€“&gt;å†…å­˜ç³»ç»Ÿä¹Ÿä¼šé‡æ’â€“&gt;æ‰§è¡Œ</p><p><strong>å¤„ç†å™¨åœ¨è¿›è¡ŒæŒ‡ä»¤é‡æ’çš„æ—¶å€™ï¼Œä¼šè€ƒè™‘æ•°æ®ä¹‹é—´çš„ä¾èµ–æ€§ï¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> x=<span class="number">1</span>; <span class="comment">//1</span></span><br><span class="line"><span class="type">int</span> y=<span class="number">2</span>; <span class="comment">//2</span></span><br><span class="line">x=x+<span class="number">5</span>;   <span class="comment">//3</span></span><br><span class="line">y=x*x;   <span class="comment">//4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æˆ‘ä»¬æœŸæœ›çš„æ‰§è¡Œé¡ºåºæ˜¯ 1_2_3_4  å¯èƒ½æ‰§è¡Œçš„é¡ºåºä¼šå˜æˆ2134 1324</span></span><br><span class="line"><span class="comment">//å¯ä¸å¯èƒ½æ˜¯ 4123ï¼Ÿ ä¸å¯èƒ½çš„</span></span><br></pre></td></tr></table></figure><p>å¯èƒ½é€ æˆçš„å½±å“ç»“æœï¼šå‰æï¼ša b x yè¿™å››ä¸ªå€¼ é»˜è®¤éƒ½æ˜¯0</p><table><thead><tr><th>çº¿ç¨‹A</th><th>çº¿ç¨‹B</th></tr></thead><tbody><tr><td>x&#x3D;a</td><td>y&#x3D;b</td></tr><tr><td>b&#x3D;1</td><td>a&#x3D;2</td></tr></tbody></table><p>æ­£å¸¸çš„ç»“æœï¼š x &#x3D; 0; y &#x3D;0;</p><table><thead><tr><th>çº¿ç¨‹A</th><th>çº¿ç¨‹B</th></tr></thead><tbody><tr><td>b&#x3D;1</td><td>a&#x3D;2</td></tr><tr><td>x&#x3D;a</td><td>y&#x3D;b</td></tr></tbody></table><p>å¯èƒ½åœ¨çº¿ç¨‹Aä¸­ä¼šå‡ºç°ï¼Œå…ˆæ‰§è¡Œb&#x3D;1,ç„¶åå†æ‰§è¡Œx&#x3D;aï¼›</p><p>åœ¨Bçº¿ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°ï¼Œå…ˆæ‰§è¡Œa&#x3D;2ï¼Œç„¶åæ‰§è¡Œy&#x3D;bï¼›</p><p>é‚£ä¹ˆå°±æœ‰å¯èƒ½ç»“æœå¦‚ä¸‹ï¼šx&#x3D;2; y&#x3D;1.</p><blockquote><p><strong>volatileå¯ä»¥é¿å…æŒ‡ä»¤é‡æ’ï¼š</strong></p></blockquote><p><strong>volatileä¸­ä¼šåŠ ä¸€é“å†…å­˜çš„å±éšœï¼Œè¿™ä¸ªå†…å­˜å±éšœå¯ä»¥ä¿è¯åœ¨è¿™ä¸ªå±éšœä¸­çš„æŒ‡ä»¤é¡ºåºã€‚</strong></p><p>å†…å­˜å±éšœï¼šCPUæŒ‡ä»¤ã€‚ä½œç”¨ï¼š</p><p>1ã€ä¿è¯ç‰¹å®šçš„æ“ä½œçš„æ‰§è¡Œé¡ºåºï¼›</p><p>2ã€å¯ä»¥ä¿è¯æŸäº›å˜é‡çš„å†…å­˜å¯è§æ€§ï¼ˆåˆ©ç”¨è¿™äº›ç‰¹æ€§ï¼Œå°±å¯ä»¥ä¿è¯volatileå®ç°çš„å¯è§æ€§ï¼‰</p><p>volatileåœ¨ä¸Šä¸‹åŠ ä¸Šä¸¤å±‚å†…å­˜å±éšœï¼Œé˜²æ­¢æŒ‡ä»¤é‡æ’ã€‚ </p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220303162957531.png" alt="image-20220303162957531" style="zoom:80%;" /><p>åœ¨å“ªé‡Œå†…å­˜å±éšœç”¨å¾—æœ€å¤šï¼Ÿ<strong>å•ä¾‹æ¨¡å¼</strong></p><h2 id="ç©è½¬å•ä¾‹æ¨¡å¼"><a href="#ç©è½¬å•ä¾‹æ¨¡å¼" class="headerlink" title="ç©è½¬å•ä¾‹æ¨¡å¼"></a>ç©è½¬å•ä¾‹æ¨¡å¼</h2><p>ä¸ºä»€ä¹ˆæšä¸¾å¯ä»¥é¿å…å•ä¾‹æ¨¡å¼è¢«ç ´åï¼Ÿ</p><p>é¥¿æ±‰å¼ DCLæ‡’æ±‰å¼ï¼Œæ·±ç©¶ï¼</p><h3 id="é¥¿æ±‰å¼"><a href="#é¥¿æ±‰å¼" class="headerlink" title="é¥¿æ±‰å¼"></a>é¥¿æ±‰å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é¥¿æ±‰å¼å•ä¾‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hungry</span> &#123;</span><br><span class="line">    <span class="comment">//ä¸€ä¸Šæ¥å°±å®ä¾‹åŒ–ï¼Œå¯èƒ½ä¼šæµªè´¹ç©ºé—´</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] data1 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] data2 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] data3 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] data4 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç§æœ‰åŒ–æ„é€ å™¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Hungry</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">Hungry</span> <span class="variable">HUNGRY</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Hungry</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Hungry <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> HUNGRY;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="DCLæ‡’æ±‰å¼"><a href="#DCLæ‡’æ±‰å¼" class="headerlink" title="DCLæ‡’æ±‰å¼"></a>DCLæ‡’æ±‰å¼</h3><blockquote><p>æ‡’æ±‰å¼å•ä¾‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‡’æ±‰å¼å•ä¾‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LazyMan</span> &#123;</span><br><span class="line">    <span class="comment">//ç§æœ‰åŒ–æ„é€ å™¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LazyMan</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot; OK&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LazyMan lazyMan;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LazyMan <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (lazyMan == <span class="literal">null</span>) &#123;</span><br><span class="line">            lazyMan = <span class="keyword">new</span> <span class="title class_">LazyMan</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lazyMan;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¤šçº¿ç¨‹å¹¶å‘ ï¼Œä¼šæœ‰éšæ‚£ï¼</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                lazyMan.getInstance();</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">å¯èƒ½ç»“æœï¼š</span></span><br><span class="line"><span class="comment">Thread-0 OK</span></span><br><span class="line"><span class="comment">Thread-2 OK</span></span><br><span class="line"><span class="comment">Thread-1 OK</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><blockquote><p>åŒé‡æ£€æµ‹é”æ¨¡å¼çš„ æ‡’æ±‰å¼å•ä¾‹ï¼ˆDCLæ‡’æ±‰å¼ï¼‰</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LazyMan</span> &#123;</span><br><span class="line">    <span class="comment">//ç§æœ‰åŒ–æ„é€ å™¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LazyMan</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot; OK&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LazyMan lazyMan;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åŒé‡æ£€æµ‹é”æ¨¡å¼çš„ æ‡’æ±‰å¼å•ä¾‹ DCLæ‡’æ±‰å¼</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LazyMan <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (lazyMan == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (LazyMan.class)&#123;</span><br><span class="line">                <span class="keyword">if</span> (lazyMan == <span class="literal">null</span>) &#123;</span><br><span class="line">                    lazyMan = <span class="keyword">new</span> <span class="title class_">LazyMan</span>();  <span class="comment">//ä¸æ˜¯ä¸€ä¸ªåŸå­æ€§æ“ä½œ</span></span><br><span class="line">                    <span class="comment">/**</span></span><br><span class="line"><span class="comment">                     * 1. åˆ†é…å†…å­˜ç©ºé—´</span></span><br><span class="line"><span class="comment">                     * 2. æ‰§è¡Œæ„é€ æ–¹æ³•ï¼Œåˆå§‹åŒ–å¯¹è±¡</span></span><br><span class="line"><span class="comment">                     * 3. æŠŠè¿™ä¸ªå¯¹è±¡æŒ‡å‘è¿™ä¸ªç©ºé—´</span></span><br><span class="line"><span class="comment">                     *</span></span><br><span class="line"><span class="comment">                     * 123</span></span><br><span class="line"><span class="comment">                     * 132 A</span></span><br><span class="line"><span class="comment">                     *     B // æ­¤æ—¶lazyManè¿˜æ²¡æœ‰å®Œæˆæ„é€ </span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lazyMan;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¤šçº¿ç¨‹å¹¶å‘</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                lazyMan.getInstance();</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åŒé‡æ£€æµ‹é” + åŸå­æ€§æ“ä½œ çš„æ‡’æ±‰å¼å•ä¾‹ï¼ˆDCLæ‡’æ±‰å¼ï¼‰</p></blockquote><p>åŠ volatile</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LazyMan</span> &#123;</span><br><span class="line">    <span class="comment">//ç§æœ‰åŒ–æ„é€ å™¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LazyMan</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot; OK&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> LazyMan lazyMan;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åŒé‡æ£€æµ‹é”æ¨¡å¼çš„ æ‡’æ±‰å¼å•ä¾‹ DCLæ‡’æ±‰å¼</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LazyMan <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (lazyMan == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (LazyMan.class)&#123;</span><br><span class="line">                <span class="keyword">if</span> (lazyMan == <span class="literal">null</span>) &#123;</span><br><span class="line">                    lazyMan = <span class="keyword">new</span> <span class="title class_">LazyMan</span>();  <span class="comment">//ä¸æ˜¯ä¸€ä¸ªåŸå­æ€§æ“ä½œ</span></span><br><span class="line">                    <span class="comment">/**</span></span><br><span class="line"><span class="comment">                     * 1. åˆ†é…å†…å­˜ç©ºé—´</span></span><br><span class="line"><span class="comment">                     * 2. æ‰§è¡Œæ„é€ æ–¹æ³•ï¼Œåˆå§‹åŒ–å¯¹è±¡</span></span><br><span class="line"><span class="comment">                     * 3. æŠŠè¿™ä¸ªå¯¹è±¡æŒ‡å‘è¿™ä¸ªç©ºé—´</span></span><br><span class="line"><span class="comment">                     *</span></span><br><span class="line"><span class="comment">                     * 123</span></span><br><span class="line"><span class="comment">                     * 132 A</span></span><br><span class="line"><span class="comment">                     *     B // æ­¤æ—¶lazyManè¿˜æ²¡æœ‰å®Œæˆæ„é€ </span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lazyMan;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¤šçº¿ç¨‹å¹¶å‘</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                lazyMan.getInstance();</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é™æ€å†…éƒ¨ç±»"><a href="#é™æ€å†…éƒ¨ç±»" class="headerlink" title="é™æ€å†…éƒ¨ç±»"></a>é™æ€å†…éƒ¨ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Holder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Holder</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Holder <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> InnerClass.holder;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">InnerClass</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Holder</span> <span class="variable">holder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Holder</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä»¥ä¸Šéƒ½ä¸å®‰å…¨ï¼Œå¯ä»¥é€šè¿‡åå°„ç ´åï¼</strong></p><h3 id="æšä¸¾"><a href="#æšä¸¾" class="headerlink" title="æšä¸¾"></a>æšä¸¾</h3><p>ä½¿ç”¨æšä¸¾ï¼Œæˆ‘ä»¬å°±å¯ä»¥é˜²æ­¢åå°„ç ´åäº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//enum æ˜¯ä»€ä¹ˆï¼Ÿ enumæœ¬èº«å°±æ˜¯ä¸€ä¸ªClass ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">EnumSingle</span> &#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line">    <span class="keyword">public</span> EnumSingle <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException &#123;</span><br><span class="line">        <span class="type">EnumSingle</span> <span class="variable">instance1</span> <span class="operator">=</span> EnumSingle.INSTANCE;</span><br><span class="line">        Constructor&lt;EnumSingle&gt; declaredConstructor = EnumSingle.class.getDeclaredConstructor(String.class,<span class="type">int</span>.class);</span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//java.lang.NoSuchMethodException: com.ogj.single.EnumSingle.&lt;init&gt;()</span></span><br><span class="line"></span><br><span class="line">        <span class="type">EnumSingle</span> <span class="variable">instance2</span> <span class="operator">=</span> declaredConstructor.newInstance();</span><br><span class="line">        System.out.println(instance1);</span><br><span class="line">        System.out.println(instance2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ·±å…¥ç†è§£CAS"><a href="#æ·±å…¥ç†è§£CAS" class="headerlink" title="æ·±å…¥ç†è§£CAS"></a>æ·±å…¥ç†è§£CAS</h2><blockquote><p>ä»€ä¹ˆæ˜¯CASï¼Ÿ</p></blockquote><p>è¿›å¤§å‚å¿…é¡»è¦æ·±å…¥ç ”ç©¶åº•å±‚ï¼å¦åˆ™è¿›ä¸å»ï¼æœ‰æ‰€çªç ´ï¼ ä¿®å†…åŠŸï¼Œ<strong>æ“ä½œç³»ç»Ÿï¼Œè®¡ç®—æœºç½‘ç»œåŸç†</strong>ã€‚</p><p>CAS : compareAndSet æ¯”è¾ƒå¹¶äº¤æ¢</p><p>javaä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CASDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//CAS : compareAndSet æ¯”è¾ƒå¹¶äº¤æ¢</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">AtomicInteger</span> <span class="variable">atomicInteger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">2020</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//boolean compareAndSet(int expect, int update)</span></span><br><span class="line">        <span class="comment">//æœŸæœ›å€¼ã€æ›´æ–°å€¼</span></span><br><span class="line">        <span class="comment">//å¦‚æœå®é™…å€¼ å’Œ æˆ‘çš„æœŸæœ›å€¼ç›¸åŒï¼Œé‚£ä¹ˆå°±æ›´æ–°</span></span><br><span class="line">        <span class="comment">//å¦‚æœå®é™…å€¼ å’Œ æˆ‘çš„æœŸæœ›å€¼ä¸åŒï¼Œé‚£ä¹ˆå°±ä¸æ›´æ–°</span></span><br><span class="line">        System.out.println(atomicInteger.compareAndSet(<span class="number">2020</span>, <span class="number">2021</span>));</span><br><span class="line">        System.out.println(atomicInteger.get());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å› ä¸ºæœŸæœ›å€¼æ˜¯2020  å®é™…å€¼å´å˜æˆäº†2021  æ‰€ä»¥ä¼šä¿®æ”¹å¤±è´¥</span></span><br><span class="line">        <span class="comment">//CAS æ˜¯CPUçš„å¹¶å‘åŸè¯­</span></span><br><span class="line">        atomicInteger.getAndIncrement(); <span class="comment">//++æ“ä½œ</span></span><br><span class="line">        System.out.println(atomicInteger.compareAndSet(<span class="number">2020</span>, <span class="number">2021</span>));</span><br><span class="line">        System.out.println(atomicInteger.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Unsafe ç±»</p></blockquote><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220303193542943.png" alt="image-20220303193542943"></p><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220303193557662.png" alt="image-20220303193557662"></p><blockquote><p>æ€»ç»“</p></blockquote><p><strong>CAS</strong>ï¼šæ¯”è¾ƒå½“å‰å·¥ä½œå†…å­˜ä¸­çš„å€¼ å’Œ ä¸»å†…å­˜ä¸­çš„å€¼ï¼Œå¦‚æœè¿™ä¸ªå€¼æ˜¯æœŸæœ›çš„ï¼Œé‚£ä¹ˆåˆ™æ‰§è¡Œæ“ä½œï¼å¦‚æœä¸æ˜¯å°±ä¸€ç›´å¾ªç¯ï¼Œä½¿ç”¨çš„æ˜¯è‡ªæ—‹é”ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>å¾ªç¯ä¼šè€—æ—¶ï¼›</li><li>ä¸€æ¬¡æ€§åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ€§ï¼›</li><li>å®ƒä¼šå­˜åœ¨ABAé—®é¢˜</li></ul><blockquote><p>CASï¼šABAé—®é¢˜ï¼ˆç‹¸çŒ«æ¢å¤ªå­ï¼‰</p></blockquote><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220304093027211.png" alt="image-20220304093027211" style="zoom:80%;" /><p>çº¿ç¨‹1ï¼šæœŸæœ›å€¼æ˜¯1ï¼Œè¦å˜æˆ2ï¼›</p><p>çº¿ç¨‹2ï¼šä¸¤ä¸ªæ“ä½œï¼š</p><ul><li>1ã€æœŸæœ›å€¼æ˜¯1ï¼Œå˜æˆ3</li><li>2ã€æœŸæœ›æ˜¯3ï¼Œå˜æˆ1</li></ul><p>æ‰€ä»¥å¯¹äºçº¿ç¨‹1æ¥è¯´ï¼ŒAçš„å€¼è¿˜æ˜¯1ï¼Œæ‰€ä»¥å°±å‡ºç°äº†é—®é¢˜ï¼Œéª—è¿‡äº†çº¿ç¨‹1ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CASDemo</span> &#123;</span><br><span class="line">    <span class="comment">// CAS compareAndSet : æ¯”è¾ƒå¹¶äº¤æ¢ï¼</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">AtomicInteger</span> <span class="variable">atomicInteger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">2020</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¹³æ—¶å†™çš„SQLï¼šä¹è§‚é”</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//æœŸæœ› æ›´æ–°</span></span><br><span class="line">        <span class="comment">//public final boolean compareAndSet(int expect, int update)</span></span><br><span class="line">        <span class="comment">// å¦‚æœæˆ‘æœŸæœ›çš„å€¼è¾¾åˆ°äº†ï¼Œé‚£ä¹ˆå°±æ›´æ–°ï¼Œå¦åˆ™ï¼Œå°±ä¸æ›´æ–°, CAS æ˜¯CPUçš„å¹¶å‘åŸè¯­ï¼</span></span><br><span class="line">        <span class="comment">// ============== æ£ä¹±çš„çº¿ç¨‹ ==================</span></span><br><span class="line">        System.out.println(atomicInteger.compareAndSet(<span class="number">2020</span>, <span class="number">2021</span>));</span><br><span class="line">        System.out.println(atomicInteger.get());</span><br><span class="line">        System.out.println(atomicInteger.compareAndSet(<span class="number">2021</span>, <span class="number">2020</span>));</span><br><span class="line">        System.out.println(atomicInteger.get());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ============== æœŸæœ›çš„çº¿ç¨‹ ==================</span></span><br><span class="line">        System.out.println(atomicInteger.compareAndSet(<span class="number">2020</span>, <span class="number">77777</span>));</span><br><span class="line">        System.out.println(atomicInteger.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŸå­å¼•ç”¨"><a href="#åŸå­å¼•ç”¨" class="headerlink" title="åŸå­å¼•ç”¨"></a>åŸå­å¼•ç”¨</h2><blockquote><p>è§£å†³ABA é—®é¢˜ï¼šå¼•å…¥åŸå­å¼•ç”¨ï¼Œå¯¹åº”çš„æ€æƒ³ï¼šä¹è§‚é”ï¼</p></blockquote><p><strong>å¸¦ç‰ˆæœ¬å· çš„åŸå­æ“ä½œï¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CASDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// AtomicStampedReference æ³¨æ„ï¼Œå¦‚æœæ³›å‹æ˜¯ä¸€ä¸ªåŒ…è£…ç±»ï¼Œæ³¨æ„å¯¹è±¡çš„å¼•ç”¨é—®é¢˜</span></span><br><span class="line">    <span class="comment">// æ­£å¸¸åœ¨ä¸šåŠ¡æ“ä½œï¼Œè¿™é‡Œé¢æ¯”è¾ƒçš„éƒ½æ˜¯ä¸€ä¸ªä¸ªå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> AtomicStampedReference&lt;Integer&gt; atomicStampedReference = <span class="keyword">new</span></span><br><span class="line">            <span class="title class_">AtomicStampedReference</span>&lt;&gt;(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// CAS compareAndSet : æ¯”è¾ƒå¹¶äº¤æ¢ï¼</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span>  <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">stamp</span> <span class="operator">=</span> atomicStampedReference.getStamp();<span class="comment">//è·å¾—ç‰ˆæœ¬å·</span></span><br><span class="line">            System.out.println(<span class="string">&quot;a1=&gt;&quot;</span>+stamp);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.out.println(atomicStampedReference.compareAndSet(<span class="number">10</span>, <span class="number">11</span>,</span><br><span class="line">                    atomicStampedReference.getStamp(), atomicStampedReference.getStamp() + <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;a2=&gt;&quot;</span> + atomicStampedReference.getStamp());</span><br><span class="line"></span><br><span class="line">            System.out.println(atomicStampedReference.compareAndSet(<span class="number">11</span>, <span class="number">10</span>,</span><br><span class="line">                    atomicStampedReference.getStamp(), atomicStampedReference.getStamp() + <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;a3=&gt;&quot;</span>+atomicStampedReference.getStamp());</span><br><span class="line"></span><br><span class="line">        &#125;,<span class="string">&quot;a&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span>  <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">stamp</span> <span class="operator">=</span> atomicStampedReference.getStamp();<span class="comment">//è·å¾—ç‰ˆæœ¬å·</span></span><br><span class="line">            System.out.println(<span class="string">&quot;b1=&gt;&quot;</span>+stamp);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.out.println(atomicStampedReference.compareAndSet(<span class="number">10</span>, <span class="number">15</span>,</span><br><span class="line">                    stamp, stamp + <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;b2=&gt;&quot;</span>+atomicStampedReference.getStamp());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;,<span class="string">&quot;b&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong></p><p><strong>Integer ä½¿ç”¨äº†å¯¹è±¡ç¼“å­˜æœºåˆ¶ï¼Œé»˜è®¤èŒƒå›´æ˜¯ -128 ~ 127 ï¼Œæ¨èä½¿ç”¨é™æ€å·¥å‚æ–¹æ³• valueOf è·å–å¯¹è±¡å®ä¾‹ï¼Œè€Œä¸æ˜¯ newï¼Œå› ä¸º valueOf ä½¿ç”¨ç¼“å­˜ï¼Œè€Œ new ä¸€å®šä¼šåˆ›å»ºæ–°çš„å¯¹è±¡åˆ†é…æ–°çš„å†…å­˜ç©ºé—´ï¼›</strong></p><p>é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œï¼š</p><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220304095823539.png" alt="image-20220304095823539"></p><h2 id="å„ç§é”çš„ç†è§£"><a href="#å„ç§é”çš„ç†è§£" class="headerlink" title="å„ç§é”çš„ç†è§£"></a>å„ç§é”çš„ç†è§£</h2><h3 id="å…¬å¹³é”ï¼Œéå…¬å¹³é”"><a href="#å…¬å¹³é”ï¼Œéå…¬å¹³é”" class="headerlink" title="å…¬å¹³é”ï¼Œéå…¬å¹³é”"></a>å…¬å¹³é”ï¼Œéå…¬å¹³é”</h3><p>å…¬å¹³é”ï¼š éå¸¸å…¬å¹³ï¼Œ ä¸èƒ½å¤Ÿæ’é˜Ÿï¼Œå¿…é¡»å…ˆæ¥ååˆ°ï¼</p><p>éå…¬å¹³é”ï¼šéå¸¸ä¸å…¬å¹³ï¼Œå¯ä»¥æ’é˜Ÿ ï¼ˆé»˜è®¤éƒ½æ˜¯éå…¬å¹³ï¼‰</p><p>æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ReentrantLock</span><span class="params">()</span> &#123;</span><br><span class="line">sync = <span class="keyword">new</span> <span class="title class_">NonfairSync</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ReentrantLock</span><span class="params">(<span class="type">boolean</span> fair)</span> &#123;</span><br><span class="line">sync = fair ? <span class="keyword">new</span> <span class="title class_">FairSync</span>() : <span class="keyword">new</span> <span class="title class_">NonfairSync</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯é‡å…¥é”"><a href="#å¯é‡å…¥é”" class="headerlink" title="å¯é‡å…¥é”"></a>å¯é‡å…¥é”</h3><p>å¯é‡å…¥é”ï¼ˆé€’å½’é”ï¼‰</p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220304100459411.png" alt="image-20220304100459411" style="zoom:50%;" /><blockquote><p><strong>Synchronized</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Phone</span> <span class="variable">phone</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            phone.sms();</span><br><span class="line">        &#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            phone.sms();</span><br><span class="line">        &#125;,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Phone</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">sms</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;ï¼šsms&quot;</span>);</span><br><span class="line">        call();<span class="comment">//è¿™é‡Œä¹Ÿæœ‰é”</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">call</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;ï¼šcall&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>Lock ç‰ˆ</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo02</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Phone2</span> <span class="variable">phone</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone2</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            phone.sms();</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            phone.sms();</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Phone2</span> &#123;</span><br><span class="line">    <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">sms</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();<span class="comment">// ç»†èŠ‚é—®é¢˜ï¼šlock.lock(); lock.unlock(); </span></span><br><span class="line">        <span class="comment">// locké”å¿…é¡»é…å¯¹ï¼Œlockä¸unlockæˆå¯¹å‡ºç°ï¼Œå¦åˆ™å°±ä¼šæ­»åœ¨é‡Œé¢</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;ï¼šsms&quot;</span>);</span><br><span class="line">            call();<span class="comment">//è¿™é‡Œä¹Ÿæœ‰é”</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">call</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;ï¼šcall&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>locké”å¿…é¡»é…å¯¹ï¼Œç›¸å½“äºlockå’Œ unlock å¿…é¡»æ•°é‡ç›¸åŒï¼›</li><li>åœ¨å¤–é¢åŠ çš„é”ï¼Œä¹Ÿå¯ä»¥åœ¨é‡Œé¢è§£é”ï¼›åœ¨é‡Œé¢åŠ çš„é”ï¼Œåœ¨å¤–é¢ä¹Ÿå¯ä»¥è§£é”ï¼›</li></ul><h3 id="è‡ªæ—‹é”"><a href="#è‡ªæ—‹é”" class="headerlink" title="è‡ªæ—‹é”"></a>è‡ªæ—‹é”</h3><p>spinlock</p><blockquote><p>æºç </p></blockquote><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220304101616067.png" alt="image-20220304101616067"></p><blockquote><p>è‡ªæˆ‘è®¾è®¡ è‡ªæ—‹é”</p></blockquote><p>è‡ªå®šä¹‰ä¸€ä¸ªé”ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªæ—‹é”</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpinlockDemo</span> &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹ï¼š int -&gt; 0; å¼•ç”¨ç±»å‹ Thread -&gt; null</span></span><br><span class="line">    AtomicReference&lt;Thread&gt; atomicReference = <span class="keyword">new</span> <span class="title class_">AtomicReference</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŠ é”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myLock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;==&gt;myLock&quot;</span>);</span><br><span class="line">        <span class="comment">//è‡ªæ—‹é”</span></span><br><span class="line">        <span class="keyword">while</span> (!atomicReference.compareAndSet(<span class="literal">null</span>, thread)) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£é”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myUnlock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;==&gt;myUnlock&quot;</span>);</span><br><span class="line">        <span class="comment">//è‡ªæ—‹é”</span></span><br><span class="line">        atomicReference.compareAndSet(thread, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestSpinLock</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//ReentrantLock</span></span><br><span class="line">        <span class="type">ReentrantLock</span> <span class="variable">reentrantLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">        reentrantLock.lock();</span><br><span class="line">        reentrantLock.unlock();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åº•å±‚ä½¿ç”¨çš„è‡ªæ—‹é”CAS</span></span><br><span class="line">        <span class="type">SpinlockDemo</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpinlockDemo</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            lock.myLock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.myUnlock();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;,<span class="string">&quot;T1&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            lock.myLock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.myUnlock();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;,<span class="string">&quot;T2&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><p><strong>t2è¿›ç¨‹å¿…é¡»ç­‰å¾…t1è¿›ç¨‹Unlockåï¼Œæ‰èƒ½Unlockï¼Œåœ¨è¿™ä¹‹å‰è¿›è¡Œè‡ªæ—‹ç­‰å¾…ã€‚ã€‚ã€‚ã€‚</strong></p><h3 id="æ­»é”"><a href="#æ­»é”" class="headerlink" title="æ­»é”"></a>æ­»é”</h3><blockquote><p>æ­»é”æ˜¯ä»€ä¹ˆ</p></blockquote><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220304102829906.png" alt="image-20220304102829906" style="zoom:80%;" /><blockquote><p>æ­»é”æµ‹è¯•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeadLockDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">lockA</span> <span class="operator">=</span> <span class="string">&quot;lockA&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">lockB</span> <span class="operator">=</span> <span class="string">&quot;lockB&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">MyThread</span>(lockA, lockB), <span class="string">&quot;T1&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">MyThread</span>(lockB, lockA), <span class="string">&quot;T2&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String lockA;</span><br><span class="line">    <span class="keyword">private</span> String lockB;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyThread</span><span class="params">(String lockA, String lockB)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.lockA = lockA;</span><br><span class="line">        <span class="built_in">this</span>.lockB = lockB;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lockA) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;lock:&quot;</span> + lockA + <span class="string">&quot;=&gt;get&quot;</span> + lockB);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">synchronized</span> (lockB) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;lock:&quot;</span> + lockB + <span class="string">&quot;=&gt;get&quot;</span> + lockA);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è§£å†³é—®é¢˜</p></blockquote><p><strong>1ã€ä½¿ç”¨jpså®šä½è¿›ç¨‹å·ï¼Œjdkçš„binç›®å½•ä¸‹ï¼š æœ‰ä¸€ä¸ªjps</strong></p><p>å‘½ä»¤ï¼š<code>jps -l</code></p><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220304103819132.png" alt="image-20220304103819132"></p><p>è¾“å…¥å‘½ä»¤çš„ä½ç½®ï¼š</p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220304103927982.png" alt="image-20220304103927982" style="zoom:80%;" /><p><strong>2ã€ä½¿ç”¨<code>jstack</code> è¿›ç¨‹è¿›ç¨‹å· æ‰¾åˆ°æ­»é”ä¿¡æ¯</strong></p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220304104001055.png" alt="image-20220304104001055" style="zoom:80%;" /><p><strong>ä¸€èˆ¬æƒ…å†µä¿¡æ¯åœ¨æœ€åï¼š</strong></p><p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20220304104147413.png" alt="image-20220304104147413"></p><p>é¢è¯•ï¼šå·¥ä½œä¸­æ’æŸ¥é—®é¢˜ï¼š</p><ol><li>æŸ¥çœ‹æ—¥å¿—</li><li>å †æ ˆä¿¡æ¯ï¼ï¼ï¼</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;JUCå¹¶å‘ç¼–ç¨‹&quot;&gt;&lt;a href=&quot;#JUCå¹¶å‘ç¼–ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;JUCå¹¶å‘ç¼–ç¨‹&quot;&gt;&lt;/a&gt;JUCå¹¶å‘ç¼–ç¨‹&lt;/h1&gt;&lt;p&gt;ç¬”è®°ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/th11/p</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>IDEAè°ƒè¯•æŠ€å·§</title>
    <link href="https://blog.jiascu.top/2022/03/03/IDEA%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7/"/>
    <id>https://blog.jiascu.top/2022/03/03/IDEA%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7/</id>
    <published>2022-03-03T13:47:51.680Z</published>
    <updated>2022-03-04T03:38:48.091Z</updated>
    
    <content type="html"><![CDATA[<h1 id="IDEAè°ƒè¯•æŠ€å·§"><a href="#IDEAè°ƒè¯•æŠ€å·§" class="headerlink" title="IDEAè°ƒè¯•æŠ€å·§"></a>IDEAè°ƒè¯•æŠ€å·§</h1><h2 id="æ–­ç‚¹ç»Ÿä¸€å¼€å…³"><a href="#æ–­ç‚¹ç»Ÿä¸€å¼€å…³" class="headerlink" title="æ–­ç‚¹ç»Ÿä¸€å¼€å…³"></a>æ–­ç‚¹ç»Ÿä¸€å¼€å…³</h2><p>Mute Breakpoints</p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20211107200557364.png" alt="image-20211107200557364" style="zoom:50%;" /><h2 id="æ¡ä»¶æ–­ç‚¹"><a href="#æ¡ä»¶æ–­ç‚¹" class="headerlink" title="æ¡ä»¶æ–­ç‚¹"></a>æ¡ä»¶æ–­ç‚¹</h2><p>æ–­ç‚¹å¤„ç‚¹å‡»å³é”®</p><img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20211107200901768.png" alt="image-20211107200901768" style="zoom:50%;" /><h2 id="å•æ­¥è°ƒè¯•"><a href="#å•æ­¥è°ƒè¯•" class="headerlink" title="å•æ­¥è°ƒè¯•"></a>å•æ­¥è°ƒè¯•</h2><ol><li><p><strong>Step Over (F8)</strong></p><p>ä¸‹ä¸€æ­¥ï¼ˆè¡Œï¼‰</p></li><li><p><strong>Step Into (F7)</strong></p></li></ol><p>   è¿›å…¥æ–¹æ³•å†…éƒ¨</p><ol start="3"><li><p><strong>Force Step Into (Alt + Shift + F7)</strong></p><p>å¼ºåˆ¶è¿›å…¥æ–¹æ³•å†…éƒ¨</p></li><li><p><strong>Step Out (Shift + F8)</strong></p><p>é€€å‡ºå½“å‰æ–¹æ³•</p></li></ol><h2 id="è¡¨è¾¾å¼æ±‚å€¼"><a href="#è¡¨è¾¾å¼æ±‚å€¼" class="headerlink" title="è¡¨è¾¾å¼æ±‚å€¼"></a>è¡¨è¾¾å¼æ±‚å€¼</h2><p><strong>Evaluate Expression (Alt + F8)</strong></p><p>è®¡ç®—è¡¨è¾¾å¼</p><h2 id="åŸºæœ¬ç”¨æ³•æ€»ç»“ã€å¿«æ·é”®"><a href="#åŸºæœ¬ç”¨æ³•æ€»ç»“ã€å¿«æ·é”®" class="headerlink" title="åŸºæœ¬ç”¨æ³•æ€»ç»“ã€å¿«æ·é”®"></a>åŸºæœ¬ç”¨æ³•æ€»ç»“ã€å¿«æ·é”®</h2><h3 id="ç¬¬ä¸€ç»„æŒ‰é’®"><a href="#ç¬¬ä¸€ç»„æŒ‰é’®" class="headerlink" title="ç¬¬ä¸€ç»„æŒ‰é’®"></a>ç¬¬ä¸€ç»„æŒ‰é’®</h3><p>å…±8ä¸ªæŒ‰é’®ï¼Œä»å·¦åˆ°å³ä¾æ¬¡å¦‚ä¸‹ï¼š</p><p>ã€€ã€€ã€€ã€€<img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20211107201352441.png" alt="image-20211107201352441"></p><ol><li><p><strong>Show Execution Point (Alt + F10)</strong></p><p>å¦‚æœä½ çš„å…‰æ ‡åœ¨å…¶å®ƒè¡Œæˆ–å…¶å®ƒé¡µé¢ï¼Œç‚¹å‡»è¿™ä¸ªæŒ‰é’®å¯è·³è½¬åˆ°å½“å‰ä»£ç æ‰§è¡Œçš„è¡Œã€‚</p></li><li><p><strong>Step Over (F8)</strong></p><p>ä¸‹ä¸€æ­¥ï¼ˆè¡Œï¼‰</p><p>æ­¥è¿‡ï¼Œä¸€è¡Œä¸€è¡Œåœ°å¾€ä¸‹èµ°ï¼Œå¦‚æœè¿™ä¸€è¡Œä¸Šæœ‰æ–¹æ³•ä¸ä¼šè¿›å…¥æ–¹æ³•ã€‚</p></li><li><p><strong>Step Into (F7)</strong></p></li></ol><p>   è¿›å…¥æ–¹æ³•å†…éƒ¨</p><p>   æ­¥å…¥ï¼Œå¦‚æœå½“å‰è¡Œæœ‰æ–¹æ³•ï¼Œå¯ä»¥è¿›å…¥æ–¹æ³•å†…éƒ¨ï¼Œä¸€èˆ¬ç”¨äºè¿›å…¥è‡ªå®šä¹‰æ–¹æ³•å†…ï¼Œä¸ä¼šè¿›å…¥å®˜æ–¹ç±»åº“çš„æ–¹æ³•ï¼Œå¦‚ç¬¬25è¡Œçš„putæ–¹æ³•ã€‚</p><ol start="4"><li><p><strong>Force Step Into (Alt + Shift + F7)</strong></p><p>å¼ºåˆ¶è¿›å…¥æ–¹æ³•å†…éƒ¨</p><p>å¼ºåˆ¶æ­¥å…¥ï¼Œèƒ½è¿›å…¥ä»»ä½•æ–¹æ³•ï¼ŒæŸ¥çœ‹åº•å±‚æºç çš„æ—¶å€™å¯ä»¥ç”¨è¿™ä¸ªè¿›å…¥å®˜æ–¹ç±»åº“çš„æ–¹æ³•ã€‚</p></li><li><p><strong>Step Out (Shift + F8)</strong></p><p>é€€å‡ºå½“å‰æ–¹æ³•</p><p>æ­¥å‡ºï¼Œä»æ­¥å…¥çš„æ–¹æ³•å†…é€€å‡ºåˆ°æ–¹æ³•è°ƒç”¨å¤„ï¼Œæ­¤æ—¶æ–¹æ³•å·²æ‰§è¡Œå®Œæ¯•ï¼Œåªæ˜¯è¿˜æ²¡æœ‰å®Œæˆèµ‹å€¼ã€‚</p></li><li><p><strong>Drop Frame</strong></p><p>å›é€€æ–­ç‚¹</p></li><li><p><strong>Run to Cursor (Alt + F9)</strong></p><p>è¿è¡Œåˆ°å…‰æ ‡å¤„</p><p>ä½ å¯ä»¥å°†å…‰æ ‡å®šä½åˆ°ä½ éœ€è¦æŸ¥çœ‹çš„é‚£ä¸€è¡Œï¼Œç„¶åä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œä»£ç ä¼šè¿è¡Œè‡³å…‰æ ‡è¡Œï¼Œè€Œä¸éœ€è¦æ‰“æ–­ç‚¹ã€‚</p></li><li><p><strong>Evaluate Expression (Alt + F8)</strong></p><p>è®¡ç®—è¡¨è¾¾å¼</p></li></ol><h3 id="ç¬¬äºŒç»„æŒ‰é’®"><a href="#ç¬¬äºŒç»„æŒ‰é’®" class="headerlink" title="ç¬¬äºŒç»„æŒ‰é’®"></a>ç¬¬äºŒç»„æŒ‰é’®</h3><p>å…±7ä¸ªæŒ‰é’®ï¼Œä»ä¸Šåˆ°ä¸‹ä¾æ¬¡å¦‚ä¸‹ï¼š</p><p> ã€€ã€€<img src="https://gitee.com/jia_scu/typora_picture/raw/master/img/image-20211107201604264.png" alt="image-20211107201604264"></p><ol><li><p><strong>Rerun â€˜xxxxâ€™</strong></p><p>é‡æ–°è¿è¡Œç¨‹åºï¼Œä¼šå…³é—­æœåŠ¡åé‡æ–°å¯åŠ¨ç¨‹åºã€‚</p></li><li><p><strong>Update â€˜techâ€™ application (Ctrl + F5)</strong></p></li></ol><p>   æ›´æ–°ç¨‹åºï¼Œä¸€èˆ¬åœ¨ä½ çš„ä»£ç æœ‰æ”¹åŠ¨åå¯æ‰§è¡Œè¿™ä¸ªåŠŸèƒ½ã€‚è€Œè¿™ä¸ªåŠŸèƒ½å¯¹åº”çš„æ“ä½œåˆ™æ˜¯åœ¨æœåŠ¡é…ç½®é‡Œ</p><ol start="3"><li><p><strong>Resume Program (F9)</strong></p><p>åªåœ¨æ–­ç‚¹åœç•™</p><p>æ¢å¤ç¨‹åºï¼Œæ¯”å¦‚ï¼Œä½ åœ¨ç¬¬20è¡Œå’Œ25è¡Œæœ‰ä¸¤ä¸ªæ–­ç‚¹ï¼Œå½“å‰è¿è¡Œè‡³ç¬¬20è¡Œï¼ŒæŒ‰F9ï¼Œåˆ™è¿è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹(å³ç¬¬25è¡Œ)ï¼Œå†æŒ‰F9ï¼Œåˆ™è¿è¡Œå®Œæ•´ä¸ªæµç¨‹ï¼Œå› ä¸ºåé¢å·²ç»æ²¡æœ‰æ–­ç‚¹äº†</p></li><li><p><strong>Pause Program</strong></p><p>æš‚åœç¨‹åºï¼Œå¯ç”¨Debugã€‚</p></li><li><p><strong>Stop â€˜xxxâ€™ (Ctrl + F2)</strong></p><p>è¿ç»­æŒ‰ä¸¤ä¸‹ï¼Œå…³é—­ç¨‹åºã€‚æœ‰æ—¶å€™ä½ ä¼šå‘ç°å…³é—­æœåŠ¡å†å¯åŠ¨æ—¶ï¼ŒæŠ¥ç«¯å£è¢«å ç”¨ï¼Œè¿™æ˜¯å› ä¸ºæ²¡å®Œå…¨å…³é—­æœåŠ¡çš„åŸå› ï¼Œä½ å°±éœ€è¦æŸ¥æ€æ‰€æœ‰JVMè¿›ç¨‹äº†ã€‚</p></li><li><p><strong>View Breakpoints (Ctrl + Shift + F8)</strong></p><p>æŸ¥çœ‹æ‰€æœ‰æ–­ç‚¹</p></li><li><p><strong>Mute Breakpoints</strong></p><p>å…³é—­æ–­ç‚¹</p><p>å“‘çš„æ–­ç‚¹ï¼Œé€‰æ‹©è¿™ä¸ªåï¼Œæ‰€æœ‰æ–­ç‚¹å˜ä¸ºç°è‰²ï¼Œæ–­ç‚¹å¤±æ•ˆï¼ŒæŒ‰F9åˆ™å¯ä»¥ç›´æ¥è¿è¡Œå®Œç¨‹åºã€‚å†æ¬¡ç‚¹å‡»ï¼Œæ–­ç‚¹å˜ä¸ºçº¢è‰²ï¼Œæœ‰æ•ˆã€‚å¦‚æœåªæƒ³ä½¿æŸä¸€ä¸ªæ–­ç‚¹å¤±æ•ˆï¼Œå¯ä»¥åœ¨æ–­ç‚¹ä¸Šå³é”®å–æ¶ˆEnabledï¼Œå¦‚å›¾2.4ï¼Œåˆ™è¯¥è¡Œæ–­ç‚¹å¤±æ•ˆã€‚</p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;IDEAè°ƒè¯•æŠ€å·§&quot;&gt;&lt;a href=&quot;#IDEAè°ƒè¯•æŠ€å·§&quot; class=&quot;headerlink&quot; title=&quot;IDEAè°ƒè¯•æŠ€å·§&quot;&gt;&lt;/a&gt;IDEAè°ƒè¯•æŠ€å·§&lt;/h1&gt;&lt;h2 id=&quot;æ–­ç‚¹ç»Ÿä¸€å¼€å…³&quot;&gt;&lt;a href=&quot;#æ–­ç‚¹ç»Ÿä¸€å¼€å…³&quot; class=&quot;headerli</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>else</title>
    <link href="https://blog.jiascu.top/2022/03/03/else/"/>
    <id>https://blog.jiascu.top/2022/03/03/else/</id>
    <published>2022-03-03T13:47:51.660Z</published>
    <updated>2022-03-04T03:33:08.463Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>getã€postè¯·æ±‚åŒºåˆ«</p></blockquote><p>getï¼šæŸ¥è¯¢ã€æœç´¢</p><p>postï¼š</p><ul><li>æ›´æ–°</li><li>ç™»å½•æ³¨å†Œç­‰è¡¨å•</li><li>å¯¹äºåšå®¢ã€è®ºå›ã€æ•°æ®çš„ä¸Šä¼ ä¸‹è½½</li></ul><blockquote><p>æŒ‚è½½åˆ°æœåŠ¡å™¨ä¸Š</p></blockquote><ol><li>clean</li><li>package</li><li></li></ol><blockquote><p>æ•°æ®åº“ã€JDBCã€æ•°æ®åº“è¿æ¥æ± çš„åŒºåˆ«</p></blockquote><p>**&#x3D;&#x3D;JDBC(Java Database Connectivity)&#x3D;&#x3D;**ï¼š javaå’Œæ•°æ®åº“çš„è¿æ¥æŠ€æœ¯ï¼Œsunå…¬å¸æ¨å‡ºçš„ä¸€å¥—javaåº”ç”¨ç¨‹åºè®¿é—®æ•°æ®åº“çš„æŠ€æœ¯è§„èŒƒã€‚</p><p>æ•°æ®åº“è¿æ¥æ±  Druidã€hikariï¼šæ™®é€šçš„JDBCæ•°æ®åº“è¿æ¥ä½¿ç”¨ DriverManager æ¥è·å–,ä½†æ˜¯ä¼šå‡ºç°å¾ˆå¤šé—®é¢˜ã€‚ä¸ºäº†è§£å†³ä¼ ç»Ÿå¼€å‘ä¸­æ•°æ®åº“çš„è¿æ¥é—®é¢˜ï¼Œä½¿ç”¨&#x3D;&#x3D;æ•°æ®åº“è¿æ¥æ± è´Ÿè´£åˆ†é…ã€ç®¡ç†å’Œé‡Šæ”¾æ•°æ®åº“è¿æ¥&#x3D;&#x3D;</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;getã€postè¯·æ±‚åŒºåˆ«&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;getï¼šæŸ¥è¯¢ã€æœç´¢&lt;/p&gt;
&lt;p&gt;postï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ›´æ–°&lt;/li&gt;
&lt;li&gt;ç™»å½•æ³¨å†Œç­‰è¡¨å•&lt;/li&gt;
&lt;li&gt;å¯¹äºåšå®¢ã€è®ºå›ã€æ•°æ®çš„ä¸Šä¼ ä¸‹è½½&lt;/li&gt;
&lt;/ul</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>IDEAå¿«æ·é”®</title>
    <link href="https://blog.jiascu.top/2022/03/03/%E5%BF%AB%E6%8D%B7%E9%94%AE/"/>
    <id>https://blog.jiascu.top/2022/03/03/%E5%BF%AB%E6%8D%B7%E9%94%AE/</id>
    <published>2022-03-03T13:47:51.624Z</published>
    <updated>2022-03-04T03:36:13.789Z</updated>
    
    <content type="html"><![CDATA[<h1 id="IDEAå¿«æ·é”®"><a href="#IDEAå¿«æ·é”®" class="headerlink" title="IDEAå¿«æ·é”®"></a>IDEAå¿«æ·é”®</h1><ol><li><p>é‡å†™æ–¹æ³•ï¼š</p><ul><li>alt + insert  ç„¶åç‚¹å‡»override</li><li>ctrl + o</li></ul></li><li><p>alt + enter</p><ul><li>å¼•å…¥å±€éƒ¨å˜é‡</li><li></li></ul></li><li><p>éå†å¿«æ·é”®ï¼šå˜é‡.for(i)</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookies.forio</span><br></pre></td></tr></table></figure><p>ifå¿«æ·é”®ï¼šå˜é‡.if</p></li><li><p>mainå‡½æ•°å¿«æ·é”®ï¼špsvm</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p>å®šä¹‰ç±»æ—¶ï¼Œ</p><ul><li>è‡ªåŠ¨ç”Ÿæˆgetå’Œsetæ–¹æ³•ï¼šalt + insert ç„¶åç‚¹å‡»Getter and Setter</li><li>è‡ªåŠ¨ç”Ÿæˆæ„é€ æ–¹æ³•ï¼šalt + insert ç„¶åç‚¹å‡»Constructor</li><li>é‡å†™toSringæ–¹æ³•ï¼šalt + insert ç„¶åç‚¹å‡»tostring</li></ul></li><li><p>jspä»£ç æ³¨é‡Šä¸é¡¶å¤´å†™ï¼šctrl + shift + &#x2F;</p></li><li><p>è¿è¡Œjavaæ–‡ä»¶å¿«æ·é”®ï¼šctrl + shift +F10</p></li><li><p>Tab &#x2F; Shift + Tab ï¼š ç¼©è¿›ä¸€æ¬¡æ‰€é€‰æ‹©çš„ä»£ç æ®µ</p><ul><li>Tab ï¼šå³ç¼©è¿›</li><li>Shift + Tab ï¼š å·¦ç¼©è¿›</li></ul></li><li><p>å¿«é€Ÿæå–æ–¹æ³•ï¼šCtrl + Alt + M ï¼ˆé¼ æ ‡å³å‡» ã€‹Refactor ã€‹Extract ã€‹Methodï¼‰</p></li><li><p>soutç­‰ä»·äºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println();</span><br></pre></td></tr></table></figure><p>ä¹Ÿèƒ½é€šè¿‡     .sout    ä½¿ç”¨</p></li><li><p>ctrl+f : æ–‡æ¡£ä¸­æœç´¢</p><p>ctrl+rï¼šæ–‡æ¡£ä¸­æ›¿æ¢</p></li><li><p>åŒå‡»shiftï¼šå…¨å±€æœç´¢ç±»ã€æ–‡ä»¶ç­‰</p></li><li><p>ctrl+shift+altï¼šå¤šè¡Œé€‰ä¸­ä¿®æ”¹</p></li><li><p>idea<strong>æ ¼å¼åŒ–ä»£ç </strong>å¿«æ·é”®ï¼š</p><ul><li><strong>å»æ‰ç©ºç™½ï¼š Ctrl + Shift + J</strong></li><li><strong>æ ¼å¼åŒ–ä»£ç ï¼š Ctrl + Alt + L</strong>ï¼ˆä¸QQå¿«æ·é”®å†²çªï¼Œå»ºè®®ä¿®æ”¹ï¼Œæˆ–ä½¿ç”¨æ—¶å…³é—­QQï¼‰</li></ul></li><li><p>åœ¨æŸä¸€æ–‡ä»¶å¤¹è¿…é€Ÿè¿è¡Œcmdå‘½ä»¤ï¼šè·¯å¾„ä¸Šæ“ä½œï¼šè·¯å¾„å‰é¢åŠ ä¸Šcmd ç›´æ¥è¿è¡Œ</p></li><li><p>å¤§å°å†™è½¬æ¢ï¼šctr + shift + u</p></li><li><p>å‡½æ•°æ–¹æ³•æ·»åŠ æ³¨é‡Šï¼š<a href="https://zhuanlan.zhihu.com/p/386392249">è‡ªåŠ¨ç»™IDEAç±»å’Œæ–¹æ³•æ·»åŠ æ³¨é‡Šï¼ˆå°ç™½å®Œç¾ç‰ˆï¼‰ - çŸ¥ä¹ (zhihu.com)</a></p><p>ä½¿ç”¨æ–¹æ³•ï¼šé¦–å…ˆæ–°å»ºä¸€ä¸ªæ–¹æ³•ï¼Œç„¶ååœ¨æ–¹æ³•çš„ä¸Šæ–¹è¾“å…¥<code>/**</code>ï¼ŒæŒ‰å›è½¦<code>Enter</code>ï¼Œå³å¯è‡ªåŠ¨ç”Ÿæˆæ³¨é‡Šä¿¡æ¯</p></li><li><p>try-catch-finallyå¿«æ·é”®ï¼š</p><ul><li>é»˜è®¤ï¼šctrl + alt +T(å†²çª)</li><li>å»ºè®®ä¿®æ”¹ä¸ºalt +T</li></ul></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;IDEAå¿«æ·é”®&quot;&gt;&lt;a href=&quot;#IDEAå¿«æ·é”®&quot; class=&quot;headerlink&quot; title=&quot;IDEAå¿«æ·é”®&quot;&gt;&lt;/a&gt;IDEAå¿«æ·é”®&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;é‡å†™æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;alt + insert  ç„¶åç‚¹å‡»over</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>æ³¨è§£</title>
    <link href="https://blog.jiascu.top/2022/03/03/%E6%B3%A8%E8%A7%A3/"/>
    <id>https://blog.jiascu.top/2022/03/03/%E6%B3%A8%E8%A7%A3/</id>
    <published>2022-03-03T13:47:43.108Z</published>
    <updated>2022-03-04T03:36:32.134Z</updated>
    
    <content type="html"><![CDATA[<h1 id="springmvc"><a href="#springmvc" class="headerlink" title="springmvc"></a>springmvc</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span> : ä»£è¡¨è¿™ä¸ªç±»ä¼šè¢«Springæ¥ç®¡</span><br><span class="line">  è¢«è¿™ä¸ªæ³¨è§£çš„ç±»ä¸­æ‰€æœ‰æ–¹æ³•ï¼Œå¦‚æœè¿”å›å€¼æ˜¯Stringï¼Œå¹¶ä¸”æœ‰å…·ä½“é¡µé¢å¯ä»¥è·³è½¬ï¼Œé‚£ä¹ˆå°±ä¼šè¢«è§†å›¾è§£æå™¨è§£æ <span class="meta">@RequestMapping(&quot;/t3&quot;)</span>ï¼šè¯·æ±‚æ˜ å°„</span><br><span class="line"><span class="meta">@GetMapping</span>ï¼šgetæ–¹æ³•</span><br><span class="line"><span class="meta">@PostMapping</span>ï¼špostæ–¹æ³•</span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="meta">@PatchMapping</span></span><br><span class="line"><span class="meta">@PathVariable</span> : è®©æ–¹æ³•å‚æ•°çš„å€¼å¯¹åº”ç»‘åˆ°ä¸€ä¸ªURLæ¨¡æ¿å˜é‡ä¸Š</span><br><span class="line"><span class="meta">@RequestParam(&quot;username&quot;)</span>ï¼šå‰ç«¯è¯·æ±‚çš„å‚æ•°å</span><br><span class="line"></span><br><span class="line"><span class="meta">@ResponseBody</span><span class="comment">//å®ƒä¸ä¼šèµ°è§†å›¾è§£æå™¨ã€‚ä¼šç›´æ¥è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="meta">@RestController</span>ï¼š<span class="meta">@Controller</span> + <span class="meta">@ResponseBody</span></span><br></pre></td></tr></table></figure><h1 id="spring"><a href="#spring" class="headerlink" title="spring"></a>spring</h1><ul><li><p>@Autowiredï¼šè‡ªåŠ¨æ³¨å…¥ï¼Œé¦–å…ˆæŒ‰ç±»å‹æ³¨å…¥ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªåˆ™æˆåŠŸï¼›å¦‚æœæ˜¯å¤šä¸ªï¼Œå†æŒ‰ç…§åç§°ï¼ˆç±»é¦–å­—æ¯å°å†™ï¼‰æ³¨å…¥ï¼Œæ‰¾åˆ°äº†æˆåŠŸï¼Œå¦åˆ™å¤±è´¥</p></li><li><p>@Qualifierï¼š@Autowiredæ˜¯æ ¹æ®ç±»å‹è‡ªåŠ¨è£…é…çš„ï¼ŒåŠ ä¸Š@Qualifieråˆ™å¯ä»¥æ ¹æ®byNameçš„æ–¹å¼è‡ªåŠ¨è£…é…</p></li><li><p>@Resourceï¼šè‡ªåŠ¨è£…é…é€šè¿‡åå­—ã€ç±»å‹ï¼Œä½¿ç”¨æ—¶éœ€å…ˆå¯¼åŒ…</p></li><li><p>@Nullableï¼šæ ‡è®°å­—æ®µï¼Œè¯´æ˜è¯¥å­—æ®µå¯ä»¥ä¸ºnull</p></li><li><p>beanæ³¨å…¥ï¼šæ”¾åœ¨ç±»ä¸Šï¼Œè¯´æ˜è¿™ä¸ªç±»è¢«Springç®¡ç†äº†ï¼Œå°±æ˜¯bean</p><p>â€‹                  ç›¸å½“äºï¼š<bean class="com.kuang.pojo.User" id="user"/></p><ul><li><p>@Componentï¼šç»„ä»¶ï¼Œæ”¾åœ¨pojoï¼ˆå®ä½“ç±»ä¸Šï¼‰</p></li><li><p>@Controllerï¼šwebå±‚ </p></li><li><p>@Serviceï¼šserviceå±‚ </p></li><li><p>@Repositoryï¼šdaoå±‚</p></li></ul></li><li><p>@valueï¼šå±æ€§æ³¨å…¥ï¼Œå¯åœ¨å®šä¹‰å˜é‡ä¸Šæ–¹å’Œsetæ–¹æ³•ä¸Šæ–¹æ³¨å…¥ï¼Œè¡¨ç¤ºä¸ºè¯¥å±æ€§èµ‹å€¼</p><p>â€‹                ç›¸å½“äºï¼š<property name="name" value="ç‹‚ç¥"/></p></li><li><p>@scopeï¼šä½œç”¨åŸŸï¼ŒåŒ…æ‹¬singletonå’Œprototypeç­‰</p><ul><li><pre><code>        singletonï¼šé»˜è®¤çš„ï¼ŒSpringä¼šé‡‡ç”¨å•ä¾‹æ¨¡å¼åˆ›å»ºè¿™ä¸ªå¯¹è±¡ã€‚å…³é—­å·¥å‚ ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½ä¼šé”€æ¯ã€‚ </code></pre></li><li><pre><code>        prototypeï¼šå¤šä¾‹æ¨¡å¼ã€‚å…³é—­å·¥å‚ ï¼Œæ‰€æœ‰çš„å¯¹è±¡ä¸ä¼šé”€æ¯ã€‚å†…éƒ¨çš„åƒåœ¾å›æ”¶æœºåˆ¶ä¼šå›æ”¶</code></pre></li></ul></li><li><p>@Configuration:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¿™ä¸ªä¹Ÿä¼šè¢«Springå®¹å™¨æ‰˜ç®¡ï¼Œæ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼Œå› ä¸ºä»–æœ¬èº«å°±æ˜¯ä¸€ä¸ª@Componentï¼Œ</span></span><br><span class="line"><span class="comment">// @Configurationä»£è¡¨è¿™æ˜¯ä¸€ä¸ªé…ç½®ç±» ï¼Œå°±å’Œæˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„beans.xml</span></span><br></pre></td></tr></table></figure></li><li><p>@Import(KuangConfig2.class)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¯¼å…¥åˆ«çš„é…ç½®æ–‡ä»¶ï¼ˆä½¿ç”¨äº†æ³¨è§£<span class="meta">@Configuration</span>:ï¼‰</span><br></pre></td></tr></table></figure></li><li><p>@ComponentScan(â€œcom.kuangâ€)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//æ‰«æç»„ä»¶ï¼Œç›¸å½“äºxmlæ–‡ä»¶ä¸­çš„  </span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.kuang&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>@Bean:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ³¨å†Œä¸€ä¸ªBeanï¼Œå°±åƒä½†ä¸æˆ‘ä»¬ä¹‹å‰å†™çš„ä¸€ä¸ªbeanæ ‡ç­¾</span></span><br><span class="line"><span class="comment">//è¿™ä¸ªæ–¹æ³•çš„åå­—ï¼Œå°±ç›¸å½“äºbeanæ ‡ç­¾ä¸­çš„idå±æ€§</span></span><br><span class="line"><span class="comment">//è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼ï¼Œå°±ç›¸å½“äºbeanæ ‡ç­¾ä¸­çš„classå±æ€§</span></span><br></pre></td></tr></table></figure></li></ul><h1 id="springboot"><a href="#springboot" class="headerlink" title="springboot"></a>springboot</h1><ul><li><pre><code class="java">@ConfigurationProperties(prefix = &quot;person&quot;)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  å°†é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„æ¯ä¸€ä¸ªå±æ€§çš„å€¼ï¼Œæ˜ å°„åˆ°è¿™ä¸ªç»„ä»¶ä¸­ï¼› </span><br><span class="line"></span><br><span class="line">  å‘Šè¯‰SpringBootå°†æœ¬ç±»ä¸­çš„æ‰€æœ‰å±æ€§å’Œé…ç½®æ–‡ä»¶ä¸­ç›¸å…³çš„é…ç½®è¿›è¡Œç»‘å®š å‚æ•° prefix = â€œpersonâ€ : </span><br><span class="line"></span><br><span class="line">  å°†é…ç½®æ–‡ä»¶ä¸­çš„personä¸‹é¢çš„æ‰€æœ‰å±æ€§ä¸€ä¸€å¯¹åº”</span><br><span class="line"></span><br><span class="line">- ```java</span><br><span class="line">  @Validated //æ•°æ®æ ¡éªŒ</span><br></pre></td></tr></table></figure></code></pre></li><li><pre><code class="java">@Email(message=&quot;é‚®ç®±æ ¼å¼é”™è¯¯&quot;)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  é…åˆ@Validatedä½¿ç”¨ï¼Œåœ¨å­—æ®µä¸Šä½¿ç”¨ï¼Œè¦æ±‚å…¶å¿…é¡»ä¸ºé‚®ä»¶æ ¼å¼ï¼Œå¦åˆ™æŠ¥é”™ï¼ˆé‚®ç®±æ ¼å¼é”™è¯¯ï¼‰</span><br><span class="line"></span><br><span class="line">- jsr303æ£€éªŒ</span><br><span class="line"></span><br><span class="line">  ```java</span><br><span class="line">  @NotNull(message=&quot;åå­—ä¸èƒ½ä¸ºç©º&quot;)</span><br><span class="line">  private String userName;get</span><br><span class="line">  @Max(value=120,message=&quot;å¹´é¾„æœ€å¤§ä¸èƒ½æŸ¥è¿‡120&quot;)</span><br><span class="line">  private int age;</span><br><span class="line">  @Email(message=&quot;é‚®ç®±æ ¼å¼é”™è¯¯&quot;)</span><br><span class="line">  private String email;</span><br><span class="line">  </span><br><span class="line">  ç©ºæ£€æŸ¥</span><br><span class="line">  @Null       éªŒè¯å¯¹è±¡æ˜¯å¦ä¸ºnull</span><br><span class="line">  @NotNull    éªŒè¯å¯¹è±¡æ˜¯å¦ä¸ä¸ºnull, æ— æ³•æŸ¥æ£€é•¿åº¦ä¸º0çš„å­—ç¬¦ä¸²</span><br><span class="line">  @NotBlank   æ£€æŸ¥çº¦æŸå­—ç¬¦ä¸²æ˜¯ä¸æ˜¯Nullè¿˜æœ‰è¢«Trimçš„é•¿åº¦æ˜¯å¦å¤§äº0,åªå¯¹å­—ç¬¦ä¸²,ä¸”ä¼šå»æ‰å‰åç©ºæ ¼.</span><br><span class="line">  @NotEmpty   æ£€æŸ¥çº¦æŸå…ƒç´ æ˜¯å¦ä¸ºNULLæˆ–è€…æ˜¯EMPTY.</span><br><span class="line">      </span><br><span class="line">  Booelanæ£€æŸ¥</span><br><span class="line">  @AssertTrue     éªŒè¯ Boolean å¯¹è±¡æ˜¯å¦ä¸º true  </span><br><span class="line">  @AssertFalse    éªŒè¯ Boolean å¯¹è±¡æ˜¯å¦ä¸º false  </span><br><span class="line">      </span><br><span class="line">  é•¿åº¦æ£€æŸ¥</span><br><span class="line">  @Size(min=, max=) éªŒè¯å¯¹è±¡ï¼ˆArray,Collection,Map,Stringï¼‰é•¿åº¦æ˜¯å¦åœ¨ç»™å®šçš„èŒƒå›´ä¹‹å†…  </span><br><span class="line">  @Length(min=, max=) string is between min and max included.</span><br><span class="line">  </span><br><span class="line">  æ—¥æœŸæ£€æŸ¥</span><br><span class="line">  @Past       éªŒè¯ Date å’Œ Calendar å¯¹è±¡æ˜¯å¦åœ¨å½“å‰æ—¶é—´ä¹‹å‰  </span><br><span class="line">  @Future     éªŒè¯ Date å’Œ Calendar å¯¹è±¡æ˜¯å¦åœ¨å½“å‰æ—¶é—´ä¹‹å  </span><br><span class="line">  @Pattern(value)    éªŒè¯ String å¯¹è±¡æ˜¯å¦ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„è§„åˆ™</span><br><span class="line">  </span><br></pre></td></tr></table></figure></code></pre></li><li><pre><code class="java">@Repository  </code></pre></li></ul><h1 id="else"><a href="#else" class="headerlink" title="else"></a>else</h1><ol><li>å®ç°å¼‚æ­¥<ul><li>@Asyncï¼šåœ¨æ–¹æ³•ä¸ŠåŠ ï¼Œå‘Šè¯‰springè¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„æ–¹æ³•</li><li>@EnableAsyncï¼šåœ¨SpringbootApplicationä¸Šé¢åŠ ï¼Œå¼€å¯å¼‚æ­¥æ³¨è§£åŠŸèƒ½</li></ul></li><li>å®šæ—¶æ‰§è¡Œä»»åŠ¡<ul><li>@Scheduledï¼ˆï¼‰ï¼šåœ¨æ–¹æ³•ä¸ŠåŠ ï¼Œä½¿ç”¨cronè¡¨è¾¾å¼</li><li>cronè¡¨è¾¾å¼ï¼š<ul><li>ç§’ åˆ† æ—¶ æ—¥ æœˆ å‘¨å‡ </li><li>@Scheduled(cron &#x3D; â€œ0 * * * * 0-7â€)ï¼šæ¯å¤©ä»»ä½•æ—¶å€™çš„ç¬¬0ç§’</li><li>å¯åœ¨çº¿ç”Ÿæˆ</li></ul></li><li>@EnableSchedulingï¼šåœ¨SpringbootApplicationä¸Šé¢åŠ ï¼Œå¼€å¯å®šæ—¶åŠŸèƒ½çš„æ³¨è§£</li></ul></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;springmvc&quot;&gt;&lt;a href=&quot;#springmvc&quot; class=&quot;headerlink&quot; title=&quot;springmvc&quot;&gt;&lt;/a&gt;springmvc&lt;/h1&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://blog.jiascu.top/2022/03/03/hello-world/"/>
    <id>https://blog.jiascu.top/2022/03/03/hello-world/</id>
    <published>2022-03-03T12:52:23.253Z</published>
    <updated>2022-03-03T12:52:23.253Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for</summary>
      
    
    
    
    
  </entry>
  
</feed>
